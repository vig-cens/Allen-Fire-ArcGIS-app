System.register(["jimu-core","jimu-ui"],(function(e,t){var s={},i={};return{setters:[function(e){s.AppMode=e.AppMode,s.BaseVersionManager=e.BaseVersionManager,s.ButtonClickMessage=e.ButtonClickMessage,s.ExpressionPartType=e.ExpressionPartType,s.ExpressionResolverComponent=e.ExpressionResolverComponent,s.ExpressionResolverErrorCode=e.ExpressionResolverErrorCode,s.Immutable=e.Immutable,s.LinkType=e.LinkType,s.MessageManager=e.MessageManager,s.React=e.React,s.classNames=e.classNames,s.css=e.css,s.getAppStore=e.getAppStore,s.jsx=e.jsx},function(e){i.DistanceUnits=e.DistanceUnits,i.Icon=e.Icon,i.Link=e.Link,i.defaultMessages=e.defaultMessages,i.styleUtils=e.styleUtils,i.utils=e.utils}],execute:function(){e((()=>{var e={79244:e=>{"use strict";e.exports=s},14321:e=>{"use strict";e.exports=i}},t={};function o(s){var i=t[s];if(void 0!==i)return i.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,o),n.exports}o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var n={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(n),o.d(n,{__set_webpack_public_path__:()=>a,default:()=>p});var e,t=o(79244),s=o(14321);!function(e){e.Left="LEFT",e.Right="RIGHT"}(e||(e={}));class i extends t.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.0.0",description:"The first release.",upgrader:e=>{let t=e;return t.getIn(["styleConfig","name"])&&(t=t.set("styleConfig",t.styleConfig.without("name"))),t.getIn(["styleConfig","customStyle"])&&(t=t.set("styleConfig",t.styleConfig.without("customStyle"))),t.getIn(["styleConfig","themeStyle","quickStyleType"])&&(t=t.setIn(["styleConfig","themeStyle"],{quickStyleType:t.styleConfig.themeStyle.quickStyleType})),t=t.setIn(["styleConfig","useCustom"],!1),t}},{version:"1.1.0",description:"1.1.0",upgrader:e=>{let t=e;return t.getIn(["styleConfig","useCustom"])&&t.getIn(["styleConfig","customStyle","regular","border","width"])&&(t=t.setIn(["styleConfig","customStyle","regular","border","width"],s.utils.stringOfLinearUnit(t.getIn(["styleConfig","customStyle","regular","border","width"])))),t.getIn(["styleConfig","useCustom"])&&t.getIn(["styleConfig","customStyle","hover","border","width"])&&(t=t.setIn(["styleConfig","customStyle","hover","border","width"],s.utils.stringOfLinearUnit(t.getIn(["styleConfig","customStyle","hover","border","width"])))),t}},{version:"1.12.0",description:"fix icon picker config",upgrader:e=>{let t=e;if(t.getIn(["functionConfig","icon","data"])){const e={svg:t.getIn(["functionConfig","icon","data"]),properties:{filename:""}};t=t.setIn(["functionConfig","icon","data"],e)}return t}}]}}const r=new i;class l extends t.React.PureComponent{constructor(i){var o,n,r,l,p;super(i),this.lastClickTimestamp=null,this.getTextFromProps=()=>{var e,t,i,o;return"string"==typeof(null===(t=null===(e=this.props.config)||void 0===e?void 0:e.functionConfig)||void 0===t?void 0:t.text)?null===(o=null===(i=this.props.config)||void 0===i?void 0:i.functionConfig)||void 0===o?void 0:o.text:this.props.intl.formatMessage({id:"variableButton",defaultMessage:s.defaultMessages.variableButton})},this.getTipExpression=()=>{var e,s;return this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.toolTipExpression&&this.props.config.functionConfig.toolTipExpression||(0,t.Immutable)({name:"",parts:[{type:t.ExpressionPartType.String,exp:`"${(null===(s=null===(e=this.props.config)||void 0===e?void 0:e.functionConfig)||void 0===s?void 0:s.toolTip)||""}"`}]})},this.getTextExpression=()=>{var e,s;return this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.textExpression&&this.props.config.functionConfig.textExpression||(0,t.Immutable)({name:"",parts:[{type:t.ExpressionPartType.String,exp:`"${(null===(s=null===(e=this.props.config)||void 0===e?void 0:e.functionConfig)||void 0===s?void 0:s.text)||this.getTextFromProps()}"`}]})},this.getUrlExpression=()=>this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam.expression||null,this.onTextExpResolveChange=e=>{if(e.isSuccessful)this.setState({text:e.value});else{let s="";e.value===t.ExpressionResolverErrorCode.Failed&&(s=this.state.textExpression&&this.state.textExpression.name),this.setState({text:s})}},this.onTipExpResolveChange=e=>{e.isSuccessful?this.setState({toolTip:e.value}):this.setState({toolTip:""})},this.onUrlExpResolveChange=e=>{if(e.isSuccessful)this.setState({url:e.value});else{let s="";e.value===t.ExpressionResolverErrorCode.Failed&&(s=this.state.urlExpression&&this.state.urlExpression.name),this.setState({url:s})}},this.getWhetherUseQuickStyle=e=>!!(e&&e.styleConfig&&e.styleConfig.themeStyle&&e.styleConfig.themeStyle.quickStyleType),this.getIconStyle=(e,i)=>{const o=e||{},n=i||{};return t.css`
      & img, & svg{
        color: ${o.color};
        fill: ${o.color};
        width: ${o.size}${s.DistanceUnits.PIXEL};
        height: ${o.size}${s.DistanceUnits.PIXEL};
      }
      &:hover{
        img, svg{
          color: ${n.color};
          fill: ${n.color};
          width: ${n.size}${s.DistanceUnits.PIXEL};
          height: ${n.size}${s.DistanceUnits.PIXEL};
        }
      }
    `},this.removeUndefinedStyle=e=>{if(!e)return e;const t={};return Object.keys(e).forEach((s=>{("string"==typeof e[s]&&!e[s].includes("undefined")||"number"==typeof e[s])&&(t[s]=e[s])})),t},this.getLinkComponent=()=>{var i,o,n;const r=this.props.config,l=r.functionConfig.linkParam,p=this.state.text,a=this.state.toolTip,u=null===(n=null===(o=null===(i=r.functionConfig)||void 0===i?void 0:i.icon)||void 0===o?void 0:o.data)||void 0===n?void 0:n.properties,c=(null==u?void 0:u.isUploaded)?null==u?void 0:u.originalName:null==u?void 0:u.filename;let g,f,d=this.state.toolTip||p||c;if(r.styleConfig&&r.styleConfig.customStyle){const e=r.styleConfig.customStyle.regular,i=r.styleConfig.customStyle.hover;if(r.styleConfig.useCustom){const o=s.styleUtils.toCSSStyle(e&&e.without("iconProps").asMutable({deep:!0})),n=s.styleUtils.toCSSStyle(i&&i.without("iconProps").asMutable({deep:!0})),r=Object.assign(Object.assign({},o),n);if(this.props.active&&this.props.appMode!==t.AppMode.Run){const s=(0,t.getAppStore)().getState().widgetsState[this.props.id]||(0,t.Immutable)({});g={style:s.isConfiguringHover?Object.assign(Object.assign({},this.removeUndefinedStyle(o)),this.removeUndefinedStyle(r)):o,hoverStyle:r},f=this.getIconStyle(s.isConfiguringHover?Object.assign(Object.assign({},null==e?void 0:e.iconProps),null==i?void 0:i.iconProps):null==e?void 0:e.iconProps,null==i?void 0:i.iconProps)}else g={style:o,hoverStyle:r},f=this.getIconStyle(e&&e.iconProps,i&&i.iconProps)}}const h=this.getWhetherUseQuickStyle(r)?{type:r.styleConfig.themeStyle.quickStyleType}:{type:"default"};let y,m,v;l&&l.linkType&&(m=l.openType,v={linkType:l.linkType},l.linkType===t.LinkType.WebAddress?v.value=this.state.url:(v.value=l.value,y=this.props.queryObject));const x=r.functionConfig.icon,C=this.props.isRTL,S=x&&(!x.position||x.position===e.Left)&&(0,t.jsx)(s.Icon,{icon:x.data.svg,className:(0,t.classNames)({"mr-2 ml-0":!!p&&!C,"ml-2 mr-0":!!p&&C,"mx-0":!p}),"aria-hidden":!0}),E=x&&x.position&&x.position===e.Right&&(0,t.jsx)(s.Icon,{icon:x.data.svg,className:(0,t.classNames)({"ml-2 mr-0":!!p&&!C,"mr-2 ml-0":!!p&&C,"mx-0":!p}),"aria-hidden":!0});"_blank"===m&&(d=`${d}, ${this.props.intl.formatMessage({id:"openInNewWindow"})}`);const b=this.props.autoWidth&&this.props.autoHeight,T=x&&!p;return(0,t.jsx)(s.Link,Object.assign({to:v,target:m,queryObject:y,title:a,className:"widget-button-link text-truncate w-100 h-100 p-0 d-flex align-items-center justify-content-center",role:"button",customStyle:g},h,{css:f,"aria-label":d}),(0,t.jsx)("span",{className:(0,t.classNames)("text-truncate widget-button-text d-flex align-items-center",{"auto-size-icon":b&&T})},C?E:S,(0,t.jsx)("span",{className:"text-truncate"},p),C?S:E))},this.onClick=e=>{const s=(new Date).getTime();this.lastClickTimestamp&&s-this.lastClickTimestamp<200||(this.lastClickTimestamp=s,e.exbEventType="linkClick",t.MessageManager.getInstance().publishMessage(new t.ButtonClickMessage(this.props.id)))},this.state={text:this.getTextFromProps(),toolTip:(null===(n=null===(o=this.props.config)||void 0===o?void 0:o.functionConfig)||void 0===n?void 0:n.toolTip)||"",url:(null===(p=null===(l=null===(r=this.props.config)||void 0===r?void 0:r.functionConfig)||void 0===l?void 0:l.linkParam)||void 0===p?void 0:p.value)||"",textExpression:this.props.useDataSourcesEnabled&&this.getTextExpression(),tipExpression:this.props.useDataSourcesEnabled&&this.getTipExpression(),urlExpression:this.props.useDataSourcesEnabled&&this.getUrlExpression()},this.domNode=t.React.createRef()}componentDidUpdate(e,t){this.props.useDataSourcesEnabled||this.props.config===e.config&&!e.useDataSourcesEnabled||this.setState({text:this.getTextFromProps(),toolTip:this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.toolTip,url:this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam.value}),!this.props.useDataSourcesEnabled||this.props.config===e.config&&e.useDataSourcesEnabled||this.setState({textExpression:this.getTextExpression(),tipExpression:this.getTipExpression(),urlExpression:this.getUrlExpression()})}render(){const e=this.props.useDataSourcesEnabled,s=this.getLinkComponent();return(0,t.jsx)("div",{className:"jimu-widget widget-button w-100 h-100",css:(this.props.theme,t.css`
    &>a {
      display: flex !important;
      justify-content: center;
    }

    .auto-size-icon {
      line-height: 1;
    }

  `),ref:this.domNode,onClick:this.onClick,onTouchEnd:this.onClick,onKeyUp:e=>{" "!==e.key&&"Enter"!==e.key||this.onClick(e)}},s,(0,t.jsx)("div",{style:{display:"none"}},e&&(0,t.jsx)("div",null,(0,t.jsx)(t.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.textExpression,onChange:this.onTextExpResolveChange,widgetId:this.props.id}),(0,t.jsx)(t.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.tipExpression,onChange:this.onTipExpResolveChange,widgetId:this.props.id}),(0,t.jsx)(t.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.urlExpression,onChange:this.onUrlExpResolveChange,widgetId:this.props.id}))))}}l.mapExtraStateProps=(e,t)=>{var s;let i=!1;const o=e.appRuntimeInfo.selection;if(o&&e.appConfig.layouts[o.layoutId]){const s=e.appConfig.layouts[o.layoutId].content[o.layoutItemId];i=s&&s.widgetId===t.id}return{active:e.appContext.isInBuilder&&i,appMode:e.appRuntimeInfo.appMode,queryObject:e.queryObject,isRTL:e.appContext.isRTL,browserSizeMode:e.browserSizeMode,uri:null===(s=e.appConfig.widgets[t.id])||void 0===s?void 0:s.uri}},l.versionManager=r;const p=l;function a(e){o.p=e}})(),n})())}}}));