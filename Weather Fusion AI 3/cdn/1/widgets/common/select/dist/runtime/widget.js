System.register(["jimu-core","jimu-ui","jimu-ui/basic/sql-expression-runtime","jimu-arcgis","jimu-theme"],(function(e,t){var a={},n={},o={},s={},r={};return{setters:[function(e){a.CONSTANTS=e.CONSTANTS,a.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceSelectionMode=e.DataSourceSelectionMode,a.DataSourceStatus=e.DataSourceStatus,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.MessageManager=e.MessageManager,a.QueryScope=e.QueryScope,a.React=e.React,a.ReactDOM=e.ReactDOM,a.SqlExpressionMode=e.SqlExpressionMode,a.WidgetVersionManager=e.WidgetVersionManager,a.appActions=e.appActions,a.classNames=e.classNames,a.css=e.css,a.dataSourceUtils=e.dataSourceUtils,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.jsx=e.jsx,a.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,a.moduleLoader=e.moduleLoader,a.observeStore=e.observeStore,a.utils=e.utils,a.uuidv1=e.uuidv1},function(e){n.Alert=e.Alert,n.Button=e.Button,n.Checkbox=e.Checkbox,n.DataActionList=e.DataActionList,n.DataActionListStyle=e.DataActionListStyle,n.Dropdown=e.Dropdown,n.DropdownButton=e.DropdownButton,n.DropdownItem=e.DropdownItem,n.DropdownMenu=e.DropdownMenu,n.Label=e.Label,n.Loading=e.Loading,n.NumericInput=e.NumericInput,n.Popper=e.Popper,n.Progress=e.Progress,n.SVG=e.SVG,n.Select=e.Select,n.Switch=e.Switch,n.WidgetPlaceholder=e.WidgetPlaceholder,n.defaultMessages=e.defaultMessages},function(e){o.SqlExpressionRuntime=e.SqlExpressionRuntime,o.getShownClauseNumberByExpression=e.getShownClauseNumberByExpression},function(e){s.JimuMapViewComponent=e.JimuMapViewComponent,s.LayerTypes=e.LayerTypes,s.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){r.useTheme=e.useTheme}],execute:function(){e((()=>{var e={32772:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M19.5 0H6v4.5h1V1h5v5.133l3.638 6.367H11.3v1h8.2zm-2.71 12.5h1.71V7.022l-3.35 2.606zM14.648 8.75 18.5 5.755V1H13v4.867z" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M11.89 10.006 1 4.165v12.318l2.897-3.357 3.401 6.517 3.367-1.95-3.426-6.564zM2 13.793V5.837l7.11 3.813-3.35.808 3.575 6.85-1.633.947-3.6-6.897z" clip-rule="evenodd"></path></svg>'},71690:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7 14v-1h2v1zM9 12v-1H7v1zM10 13h4v1h-4zM14 11h-4v1h4z"></path><path fill="#000" fill-rule="evenodd" d="M15 6a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1zM6 9V7h9v2zm9 6v-5H6v5zM0 10.5V12a1 1 0 0 0 1 1h1.5v-1H1v-1.5zM2.5 1H1a1 1 0 0 0-1 1v1.5h1V2h1.5zM0 8.5h1v-3H0zM4.5 1v1h3V1zm5 0v1H11v1.5h1V2a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>'},25813:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.95 3a2.5 2.5 0 0 1-4.9 0H.5a.5.5 0 0 1 0-1h3.55a2.5 2.5 0 0 1 4.9 0h6.55a.5.5 0 0 1 0 1zM6.5 4a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m7.45 4.5a2.5 2.5 0 0 1-4.9 0H.5a.5.5 0 0 1 0-1h8.55a2.5 2.5 0 0 1 4.9 0h1.55a.5.5 0 0 1 0 1zm-2.45 1a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m-7 6.5a2.5 2.5 0 0 0 2.45-2h8.55a.5.5 0 0 0 0-1H6.95a2.5 2.5 0 0 0-4.9 0H.5a.5.5 0 0 0 0 1h1.55a2.5 2.5 0 0 0 2.45 2M3 13.5a1.5 1.5 0 1 0 3 0 1.5 1.5 0 0 0-3 0" clip-rule="evenodd"></path></svg>'},96300:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.52.52 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.51.51 0 0 1-.73 0L1 7.5l4.743-4.846a.51.51 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'},4583:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path fill="#000" fill-rule="evenodd" d="M0 12v-1.5h1V12h1.5v1H1a1 1 0 0 1-1-1M1 1h1.5v1H1v1.5H0V2a1 1 0 0 1 1-1m0 7.5H0v-3h1zM4.5 2V1h3v1zm5 0V1H11a1 1 0 0 1 1 1v1.5h-1V2zm4.813 14.02-3.535-3.535-3.536 3.535-.707-.707 3.536-3.535-3.536-3.536.707-.707 3.536 3.536 3.535-3.536.707.707-3.535 3.536 3.535 3.535z" clip-rule="evenodd"></path></svg>'},13424:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path stroke="#000" d="M1 3.5h5M1 9.5h14M1 14.5h14M14 3.5H9l2.5 3z"></path></svg>'},14907:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 5.5C16 2.462 13.456 0 10.318 0 7.933 0 5.828 1.435 5 3.56l.886.323.078-.187c.737-1.667 2.438-2.78 4.354-2.78 2.615 0 4.735 2.053 4.735 4.584s-2.12 4.583-4.735 4.583c-.98 0-1.915-.288-2.703-.82l-.54.753.22.142a5.8 5.8 0 0 0 3.023.842C13.456 11 16 8.538 16 5.5M.25 3l8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.91 5.771 1.154-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},56509:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m10.308.302-.589.808 3.84 2.796L9 6.555l5.013 3.736.597-.801-3.796-2.832 4.576-2.657zM.25 3l8.642 4.969-3.423.738 2.724 5.45-2.887 1.667-2.724-5.45-2.35 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},9155:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M14 4a2 2 0 1 1-4 0 2 2 0 0 1 4 0M.25 3l8.642 4.969-3.423.738 2.724 5.45-2.887 1.667-2.724-5.45-2.35 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},31579:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 11V0L6 2.982v2.162h.91l-.001-1.49 8.182-2.44v8.882H8.434V11zM.25 3l8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.91 5.771 1.154-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},60882:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 11V0H5v3.5h1V1h9v9H8.5v1zM.25 3l8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.91 5.771 1.154-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},66364:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNOC44OTIxOSA3Ljk2ODU2TDAuMjUwMDg4IDNMMC4yMzE5MzQgMTIuOTY4NkwyLjU4Mjk3IDEwLjM3NEw1LjMwNjcxIDE1LjgyMzdMOC4xOTM0NiAxNC4xNTdMNS40Njk3MiA4LjcwNzM0TDguODkyMTkgNy45Njg1NlpNMS4yMzYzMyAxMC4zNzAxTDEuMjQ2MzMgNC43MjYwN0w2LjEzOTMzIDcuNTM5MDdMMy45MTgwMyA4LjAxOTE5TDYuODI3MzMgMTMuNzkwMUw1LjY3MjMzIDE0LjQ1NzFMMi43NjMzMyA4LjY4NTg2TDEuMjM2MzMgMTAuMzcwMVoiIGZpbGw9ImJsYWNrIi8+DQo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTExIDAuNjg3NUw2IDMuNzgxMjVMMTEgNi44NzVMMTYgMy43ODEyNUwxMSAwLjY4NzVaTTE0LjcyNSA1LjgyNzYxTDE0LjM0NjMgNS41OTMxN0wxNC45ODM3IDUuMTk4NTVMMTYgNS44Mjc2MUwxMSA4LjkyMTM2TDYgNS44Mjc2MUw3LjAxNjg4IDUuMTk4NTVMNy42NTQzOCA1LjU5MzE3TDcuMjc1IDUuODI3NjFMMTEgOC4xMzI4TDE0LjcyNSA1LjgyNzYxWk0xNiA3Ljg5MDNMMTQuOTcwNiA3LjI1Mjk5TDE0LjMzMzEgNy42NDc2MkwxNC43MjUgNy44OTAzTDExIDEwLjE5NTVMNy4yNzUgNy44OTAzTDcuNjY3NSA3LjY0NzYyTDcuMDMgNy4yNTI5OUw2IDcuODkwM0wxMSAxMC45ODQxTDE2IDcuODkwM1pNMTEgMS40NzcwNUw3LjI3NTAyIDMuNzgxNTVMMTEgNi4wODY3NEwxNC43MjUgMy43ODE1NUwxMSAxLjQ3NzA1WiIgZmlsbD0iYmxhY2siLz4NCjwvc3ZnPg0K"},62686:e=>{"use strict";e.exports=s},79244:e=>{"use strict";e.exports=a},1888:e=>{"use strict";e.exports=r},14321:e=>{"use strict";e.exports=n},76117:e=>{"use strict";e.exports=o}},t={};function i(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,i),o.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="";var c={};return i.p=window.jimuConfig.baseUrl,(()=>{"use strict";i.r(c),i.d(c,{__set_webpack_public_path__:()=>Ke,default:()=>Ze});var e=i(79244),t=i(14321),a=i(45508),n=i.n(a),o=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(a[n[o]]=e[n[o]])}return a};const s=t=>{const a=window.SVG,{className:s}=t,r=o(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",s);return a?e.React.createElement(a,Object.assign({className:i,src:n()},r)):e.React.createElement("svg",Object.assign({className:i},r))},r={_widgetLabel:"Select",selectByData:"Select by data",selectingFeatures:"Selecting features",bufferUnit:"Buffer unit",selectByLocationFeatureCountTip:"There are {count} features inside this data.",attributeFilterBatchOnTip:"Apply all attribution for active layers",attributeFilterBatchOffTip:"Remove all attribution for active layers",allSelectable:"All selectable",noneSelectable:"None selectable",toggleAll:"Toggle all",buildCustomSQL:"Build custom SQL",customSQL:"Custom SQL",selectWidgetSelection:"{layerName} select widget selection",noLayersAvailableTip:"No layers are available to select.",openSettingPanelTip:"Please open the widget setting panel to update the configurations."};var l;!function(e){e.Intersects="Intersects",e.Contains="Contains",e.Crosses="Crosses",e.EnvelopeIntersects="EnvelopeIntersects",e.IndexIntersects="IndexIntersects",e.Overlaps="Overlaps",e.Touches="Touches",e.Within="Within"}(l||(l={}));const u={[l.Intersects]:"esriSpatialRelIntersects",[l.Contains]:"esriSpatialRelContains",[l.Crosses]:"esriSpatialRelCrosses",[l.EnvelopeIntersects]:"esriSpatialRelEnvelopeIntersects",[l.IndexIntersects]:"esriSpatialRelIndexIntersects",[l.Overlaps]:"esriSpatialRelOverlaps",[l.Touches]:"esriSpatialRelTouches",[l.Within]:"esriSpatialRelWithin"},d={[l.Intersects]:"spatialRelation_Intersect",[l.Contains]:"spatialRelation_Contain",[l.Crosses]:"spatialRelation_Cross",[l.EnvelopeIntersects]:"spatialRelation_EnvelopeIntersect",[l.IndexIntersects]:"spatialRelation_IndexIntersect",[l.Overlaps]:"spatialRelation_Overlap",[l.Touches]:"spatialRelation_Touch",[l.Within]:"spatialRelation_Within"};var p;!function(e){e.Miles="Miles",e.Kilometers="Kilometers",e.Feet="Feet",e.Meters="Meters",e.NauticalMiles="NauticalMiles"}(p||(p={}));const m={[p.Miles]:"miles",[p.Kilometers]:"kilometers",[p.Feet]:"feet",[p.Meters]:"meters",[p.NauticalMiles]:"nautical-miles"};var f;!function(e){e.Point="point",e.Polyline="polyline",e.Rectangle="rectangle",e.Circle="circle",e.Polygon="polygon"}(f||(f={}));var g,S=i(76117);function y(e,t,a,n){const o={};return a.forEach((a=>{const s=a.uid;if(n[s])return;const r=a.sqlExpression,i=I(t,r),c=j(null),l=D(""),u={uid:s,displayTitle:"",dataSource:null,jimuLayerView:null,supportCustomSQLBuilder:t,shouldRenderFilterIcon:i,imDisplaySqlExpression:r,checked:!e,isSelecting:!1,latestSelectTaskInfo:{version:0,selectionMode:null,appliedGeometryInfo:c,appliedSql:l},isAttributeFilterOn:!1,tryExecuteSelectingByGeometryInfoAndSqlUI:null,enableAttributeFilter:null,clearSelection:null};o[s]=u})),o}function v(t,a){const n=(0,e.uuidv1)(),o=t.id;let s=o;const r=t.getMainDataSource();r&&(s=r.id);const i={uid:n,sqlHint:"",sqlExpression:null,useDataSource:{dataSourceId:o,mainDataSourceId:s},jimuLayerViewId:a};return(0,e.Immutable)(i)}function h(e,t){const a=function(e,t){const a=[];return e.forEach((e=>{const n=e.uid,o=t[n];o&&a.push({dataSourceItem:e,runtimeInfo:o})})),a}(e,t),n=[];return a.forEach((e=>{const{dataSourceItem:t,runtimeInfo:a}=e;t&&a&&a.displayTitle&&(t.jimuLayerViewId?a.jimuLayerView&&n.push(a):a.dataSource&&n.push(a))})),n}function w(e,t){return h(e,t).filter((e=>e.checked))}function b(e,t){return h(e,t).filter((e=>e.checked&&!e.isSelecting))}function I(e,t){let a=!1;return e?a=!0:t&&(a=!!D(t.sql)||R(e,t)),a}function R(e,t){let a=!1;return!e&&t&&(a=(0,S.getShownClauseNumberByExpression)(t)>0),a}function M(t,a,n){let o="";if(t&&a&&n){const t=e.dataSourceUtils.getArcGISSQL(a,n);t&&(o=t.sql)}return D(o)}function x(e){return"number"==typeof e&&e>0}function D(e){let t=e||"";return"1=1"===t&&(t=""),t}function j(e){return void 0===e?null:e}!function(e){e.Placeholder="Placeholder",e.Loading="Loading",e.NoLayersTip="NoLayersTip",e.Normal="Normal"}(g||(g={}));var N=i(62686);const L=[e.DataSourceTypes.FeatureLayer,e.DataSourceTypes.SceneLayer,e.DataSourceTypes.BuildingComponentSubLayer,e.DataSourceTypes.OrientedImageryLayer,e.DataSourceTypes.ImageryLayer,e.DataSourceTypes.SubtypeGroupLayer,e.DataSourceTypes.SubtypeSublayer];(0,e.Immutable)(L);function C(e){return L.includes(e)}const k=[N.LayerTypes.FeatureLayer,N.LayerTypes.SceneLayer,N.LayerTypes.BuildingComponentSublayer,N.LayerTypes.OrientedImageryLayer,N.LayerTypes.ImageryLayer,N.LayerTypes.SubtypeGroupLayer,N.LayerTypes.SubtypeSublayer];function T(e){if(!e||!e.type)return!1;const t=e.type,a=t!==N.LayerTypes.BuildingComponentSublayer||t===N.LayerTypes.BuildingComponentSublayer&&e.view;return!!(k.includes(t)&&a)}function E(e,t){return!e&&t}function O(e,t){const a=t.slice();return e&&a.sort(((t,a)=>{const n=A(e,t),o=A(e,a);return n&&o?function(e,t){const a=e.split(".").map((e=>parseInt(e))),n=t.split(".").map((e=>parseInt(e)));for(;a.length>0&&n.length>0;){const e=a.shift(),t=n.shift();if(e<t)return-1;if(e>t)return 1}if(a.length>0)return 1;if(n.length>0)return-1;return 0}(n,o):0})),a}function A(e,t){let a="";if(e&&t){const n=t.jimuLayerViewId;if(n){const t=e.jimuLayerViews[n];t&&(a=t.hierarchyLevel)}}return a}function V(t){var a;if(!t)return null;const n=function(){var t,a,n;return window.jimuConfig.isBuilder?null===(a=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===a?void 0:a.appConfig:null===(n=(0,e.getAppStore)().getState())||void 0===n?void 0:n.appConfig}();return null===(a=null==n?void 0:n.widgets)||void 0===a?void 0:a[t]}var z=i(60882),P=i.n(z),B=i(31579),F=i.n(B),G=i(14907),U=i.n(G),q=i(56509),W=i.n(q),J=i(9155),H=i.n(J),$=i(66364),_=i.n($),Y=function(e,t,a,n){return new(a||(a=Promise))((function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,i)}c((n=n.apply(e,t||[])).next())}))};const Q=e.css`
  overflow: hidden;
  border-bottom: 1px solid var(--ref-palette-neutral-400);

  .dropdown-btn-container {
    position: relative;
    overflow: hidden;
    float: left;

    .api-modules-loading-progress {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      width: 100%;
      background-color: rgba(110,110,110,0.3);
      animation: esri-fade-in 500ms ease-in-out;
    }

    .api-modules-loading-progress:after {
      position: absolute;
      width: 20%;
      height: 2px;
      top: 0;
      content: "";
      opacity: 1;
      z-index: 0;
      background-color: var(--sys-color-primary-main);
      animation: looping-progresss-bar-ani 1500ms linear infinite;
      transition: opacity 500ms ease-in-out;
    }
  }

  .render-dropdown {
    .selected-tool-btn {
      border-right: 0;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }

    .select-dropdown-btn {
      font-size: 14px;
      border-left: 0;
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      padding-left: 6px;
      padding-right: 6px;
    }
  }

  .clear-all-btn {
    float: right;
  }
`,Z="data",K={polygon:{mode:"hybrid"}},X={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},ee={tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},te={style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}};function ae(a){var n,o;const{config:s,widgetId:i,mapWidgetId:c,autoControlWidgetId:l,activeJimuMapView:u,setSelectByLocationVisible:d,allImDataSourceItems:p,dataSourceItemRuntimeInfoMap:m}=a,{useMap:g,interactiveTools:S,spatialSelection:y}=s,v=null==y?void 0:y.enable,w=e.hooks.useTranslation(t.defaultMessages,r),I=e.React.useRef(!1),[R,M]=e.React.useState(null),x=e.React.useRef(null);x.current=u;const[D,j]=e.React.useState(null),N=e.React.useMemo((()=>(null==D?void 0:D.view)||null),[D]),L=e.React.useRef(null),[C,k]=e.React.useState(!1),[T,O]=e.React.useState(!1),A=e.React.useRef([]),V=e.React.useRef(null),z=e.React.useRef(null),B=e.React.useRef("macOS"===(null===(o=null===(n=window.jimuUA)||void 0===n?void 0:n.os)||void 0===o?void 0:o.name)),G=!(!R||!N),q=null==s?void 0:s.mapInfo,J=null==u?void 0:u.id,$=e.React.useMemo((()=>{let e=!1;if(J&&q){const t=q[J];e=!!t&&E(t.syncWithMap,t.enableAttributeSelection)}return e}),[q,J]),ae=e.React.useMemo((()=>{let e="esriSpatialRelIntersects";return S&&!1===S.partiallyWithin&&(e="esriSpatialRelContains"),e}),[S]),se=e.React.useMemo((()=>h(p,m)),[p,m]),re=e.React.useMemo((()=>b(p,m)),[p,m]),ie=e.React.useMemo((()=>({[f.Rectangle]:{order:1,label:w("SelectionByRectangle"),iconSrc:P()},[f.Polygon]:{order:2,label:w("SelectionByLasso"),iconSrc:F()},[f.Circle]:{order:3,label:w("SelectionByCircle"),iconSrc:U()},[f.Polyline]:{order:4,label:w("SelectionByLine"),iconSrc:W()},[f.Point]:{order:5,label:w("SelectionByPoint"),iconSrc:H()},[Z]:{order:6,label:w("selectByData"),iconSrc:_()}})),[w]),ce=e.React.useMemo((()=>{const e=[];return g&&S&&S.tools&&S.tools.length>0&&S.tools.forEach((t=>{e.push(t)})),v&&e.push(Z),e.sort(((e,t)=>ie[e].order-ie[t].order)),e}),[S,v,ie,g]),[le,ue]=e.React.useState(ce[0]),de=e.React.useMemo((()=>ce.filter((e=>e!==Z)).length>0),[ce]),pe=de&&!R,me=e.React.useMemo((()=>{let e="";if(le){const t=ie[le];t&&(e=t.iconSrc)}return e}),[ie,le]),fe=e.React.useCallback((e=>e!==Z&&!G),[G]),ge=e.React.useMemo((()=>{const a=[];return ce.forEach((n=>{n===Z&&ce.length>=2&&a.push((0,e.jsx)(t.DropdownItem,{key:"divider",divider:!0}));const o=n===le,s=ie[n].iconSrc,r=fe(n),i=(0,e.jsx)(t.DropdownItem,{key:n,active:o,disabled:r,onClick:()=>{ue(n)}},(0,e.jsx)(t.SVG,{src:s,className:"mr-2"}),ie[n].label);a.push(i)})),a}),[ce,le,ie,fe]);e.React.useEffect((()=>{const e=B.current,t=t=>{"Shift"===t.key?V.current={eventDate:new Date,isKeyDown:!0}:(e&&"Meta"===t.key||!e&&"Control"===t.key)&&(z.current={eventDate:new Date,isKeyDown:!0})},a=t=>{"Shift"===t.key?V.current={eventDate:new Date,isKeyDown:!1}:(e&&"Meta"===t.key||!e&&"Control"===t.key)&&(z.current={eventDate:new Date,isKeyDown:!1})};return document.addEventListener("keydown",t,!0),document.addEventListener("keyup",a,!0),()=>{document.removeEventListener("keydown",t,!0),document.removeEventListener("keyup",a,!0)}}),[]),e.React.useEffect((()=>{const e=x.current;e&&e!==D&&e.whenJimuMapViewLoaded().then((()=>{e===x.current&&j(e)}))}),[u,D]),e.React.useEffect((()=>{!de||R||I.current||(I.current=!0,(0,e.loadArcGISJSAPIModules)(["esri/widgets/Sketch/SketchViewModel","esri/layers/GraphicsLayer","esri/symbols/support/jsonUtils","esri/geometry/geometryEngine","esri/views/2d/interactive/editingTools","esri/views/3d/interactive/editingTools","esri/views/2d/layers/GraphicsLayerView2D","esri/views/3d/layers/GraphicsLayerView3D"]).then((e=>{const[t,a,n,o]=e;M({SketchViewModel:t,GraphicsLayer:a,jsonUtils:n,geometryEngine:o})})).catch((e=>{console.error("select widget loads api error",e)})))}),[R,I,de]);const Se=e.React.useMemo((()=>le&&le!==Z?le:null),[le]),ye=e.React.useMemo((()=>C&&le&&le!==Z?le:null),[C,le]);e.hooks.useEffectWithPreviousValues((t=>{const[a,n]=t;if(i){if(ye!==a&&c)if(ye&&l!==i){const t=e.appActions.requestAutoControlMapWidget(c,i);(0,e.getAppStore)().dispatch(t)}else if(!ye&&l===i){const t=e.appActions.releaseAutoControlMapWidget(c);(0,e.getAppStore)().dispatch(t)}l!==n&&l!==i&&ye&&k(!1)}}),[ye,l,i]),e.React.useEffect((()=>{if(le&&!ce.includes(le)){const e=ce.length>0?ce[0]:null;ue(e),k(!1)}else if(!le&&ce.length>0){const e=ce[0];ue(e),k(!1)}}),[ce,le]);const ve=!(!g||$||!Se),he=e.hooks.usePrevious(ye),we=null==R?void 0:R.geometryEngine,be=e.React.useRef(null),Ie=e.React.useCallback(((t,a,n)=>{if(!a)return void console.log("sketch graphic is null");if(!a.geometry)return void console.log("sketch graphic.geometry is null");ve||(n=e.DataSourceSelectionMode.New);let o=a.geometry;try{if("point"===o.type||"polyline"===o.type){const e=10*(null==t?void 0:t.resolution);if(e>0&&we){const t=we.buffer(o,e,"meters");t&&(o=t)}}}catch(e){console.error("geometryEngine.buffer() error of Select widget",e)}const s=e.dataSourceUtils.changeJSAPIGeometryTypeToRestAPIGeometryType(o.type),r={geometry:o.toJSON(),geometryType:s,spatialRel:ae};A.current=re;(A.current||[]).forEach((e=>Y(this,void 0,void 0,(function*(){e.tryExecuteSelectingByGeometryInfoAndSqlUI(n,r)}))))}),[ve,ae,re,we]);be.current=Ie,e.React.useEffect((()=>{const t=L.current;let a=t;if(t){let e=!1;if(ye)if(he===ye){const a=N||null,n=t.view||null;e=!a||a!==n}else e=!0;else e=!0;e&&(t&&oe(t),a=null)}const n=()=>{const e=L.current;if(e&&ye){const t=K[ye];t?e.create(ye,t):e.create(ye)}};if(R&&N&&ye&&!a){const t=N.on("key-down",(e=>{"Shift"===e.key&&e.stopPropagation()})),o=N.on("key-up",(e=>{"Shift"===e.key&&e.stopPropagation()})),{SketchViewModel:s,GraphicsLayer:r,jsonUtils:i}=R,c=new r;a=new s({view:N,layer:c,pointSymbol:i.fromJSON(X),polylineSymbol:i.fromJSON(ee),polygonSymbol:i.fromJSON(te)}),a.viewKeyDownHandle=t,a.viewKeyUpHandle=o,a.on("create",(t=>{if("complete"===t.state&&(n(),be.current)){const n=t.graphic,o=ne(V.current),s=ne(z.current);let r=e.DataSourceSelectionMode.New;r=o?s?e.DataSourceSelectionMode.SelectFromCurrent:e.DataSourceSelectionMode.AddToCurrent:s?e.DataSourceSelectionMode.RemoveFromCurrent:e.DataSourceSelectionMode.New,be.current(a.view,n,r)}}))}L.current=a,n()}),[ye,R,N,he]),e.React.useEffect((()=>{d(C&&le===Z)}),[C,le,d]),e.hooks.useUnmount((()=>{const e=L.current;e&&(oe(e),L.current=null)}));const Re=e.React.useMemo((()=>{let e="";if(le)if(le===Z)e="";else{let t="";t=le===f.Point?w("SelectionByPoint"):le===f.Rectangle?w("SelectionByRectangle"):le===f.Polygon?w("SelectionByLasso"):le===f.Circle?w("SelectionByCircle"):le===f.Polyline?w("SelectionByLine"):w("SelectLabel");const a=w("newSelection"),n=w("addToCurrentSelection"),o=w("removeFromCurrentSelection"),s=w("selectFromCurrentSelection"),r=w("drawShape"),i=w("draw"),c=B.current?"Cmd":"Ctrl",l=`\u2219 ${a} (${r})`;e=ve?`${t}\n${l}\n${`\u2219 ${n} (Shift + ${i})`}\n${`\u2219 ${o} (${c} + ${i})`}\n${`\u2219 ${s} (Shift + ${c} + ${i})`}`:`${t}\n${l}`}return e}),[ve,le,w]),Me=e.React.useCallback((()=>{O((e=>!e))}),[O]),xe=e.React.useCallback((()=>{k(!C)}),[C]),De=e.React.useCallback((()=>{se.forEach((e=>{e.clearSelection&&e.clearSelection()}))}),[se]),je=ge.length>=2;return(0,e.jsx)("div",{className:"w-100 p-4",css:Q},(0,e.jsx)("div",{className:(0,e.classNames)(["d-flex align-items-center dropdown-btn-container",{"render-dropdown":je}])},le&&(0,e.jsx)(t.Button,{className:"selected-tool-btn",icon:!0,disabled:fe(le),type:C?"primary":"default",title:Re,onClick:xe},(0,e.jsx)(t.SVG,{src:me})),je&&(0,e.jsx)(t.Dropdown,{activeIcon:!0,isOpen:T,toggle:Me},(0,e.jsx)(t.DropdownButton,{className:"select-dropdown-btn",type:T?"primary":"default"}),(0,e.jsx)(t.DropdownMenu,{alignment:"start",offset:[0,4]},ge)),pe&&(0,e.jsx)("div",{className:"api-modules-loading-progress"})),(0,e.jsx)(t.Button,{title:w("drawToolClearBtn"),className:"pl-4 pr-4 nowrap clear-all-btn",type:"default",icon:!0,onClick:De},(0,e.jsx)("span",{className:"nowrap"},w("drawToolClearBtn"))))}function ne(e){if(e){if(e.isKeyDown)return!0;return Date.now()-e.eventDate.getTime()<=500}return!1}function oe(e){e&&(e.viewKeyDownHandle&&(e.viewKeyDownHandle.remove(),e.viewKeyDownHandle=null),e.viewKeyUpHandle&&(e.viewKeyUpHandle.remove(),e.viewKeyUpHandle=null),e.destroyed||e.destroy())}var se=i(25813),re=i.n(se),ie=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(a[n[o]]=e[n[o]])}return a};const ce=t=>{const a=window.SVG,{className:n}=t,o=ie(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:s,src:re()},o)):e.React.createElement("svg",Object.assign({className:s},o))};var le=i(4583),ue=i.n(le),de=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(a[n[o]]=e[n[o]])}return a};const pe=t=>{const a=window.SVG,{className:n}=t,o=de(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:s,src:ue()},o)):e.React.createElement("svg",Object.assign({className:s},o))};var me=i(71690),fe=i.n(me),ge=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(a[n[o]]=e[n[o]])}return a};const Se=t=>{const a=window.SVG,{className:n}=t,o=ge(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:s,src:fe()},o)):e.React.createElement("svg",Object.assign({className:s},o))};var ye=function(e,t,a,n){return new(a||(a=Promise))((function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,i)}c((n=n.apply(e,t||[])).next())}))};class ve{constructor(e,t){this.ds=e,this.widgetId=t}clearSelection(){return ye(this,void 0,void 0,(function*(){const e=[];yield this.ds.selectRecords({widgetId:this.widgetId,records:e}),this.publishMessage(e)}))}selectRecords(t,a,n,o,s,r){return ye(this,void 0,void 0,(function*(){Object.values(a).includes(a)&&(a=e.DataSourceSelectionMode.New);let i=null;const c=this.widgetId,l=this.ds;if(a!==e.DataSourceSelectionMode.New||t.objectIds||t.geometry||t.where&&"1=1"!==t.where){const u=yield e.dataSourceUtils.selectBySelectionMode({widgetId:c,ds:l,query:t,selectionMode:a,signal:n,checkLayerVisibility:!1,jimuLayerView:o,progressCallback:s,updateSelectionIfAborted:r});u&&(i=u.records)}else i=[],l.selectRecords({widgetId:c,records:i});i&&this.publishMessage(i)}))}publishMessage(t){const a=new e.DataRecordsSelectionChangeMessage(this.widgetId,t,[this.ds.id]);e.MessageManager.getInstance().publishMessage(a)}}var he=i(96300),we=i.n(he),be=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(a[n[o]]=e[n[o]])}return a};const Ie=t=>{const a=window.SVG,{className:n}=t,o=be(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:s,src:we()},o)):e.React.createElement("svg",Object.assign({className:s},o))};var Re=function(e,t,a,n){return new(a||(a=Promise))((function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,i)}c((n=n.apply(e,t||[])).next())}))};const Me=e.css`
  position: absolute;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;

  .select-custom-sql-builder-header {
    padding: 16px;
  }

  .raw-sql-expression-builder {
    position: absolute;
    left: 16px;
    right: 16px;
    top: 53px;
    bottom: 16px;
    height: auto !important;
    overflow-x: auto;

    &.small-mode .sql-expression-builder .sql-expression-container {
      min-width: 240px;
    }
  }
`;function xe(a){const{isRTL:n,widgetId:o,widgetDomRef:s,dataSource:i,imSqlExpression:c,onBack:l}=a,u=null==s?void 0:s.current,d=e.hooks.useTranslation(t.defaultMessages,r),[p,m]=e.React.useState(null),[f,g]=e.React.useState(c),S=e.React.useCallback((()=>{l(f)}),[f,l]),y=e.React.useCallback((e=>{g(e)}),[g]);return e.React.useEffect((()=>{!function(){Re(this,void 0,void 0,(function*(){try{const t=yield e.moduleLoader.loadModules(["jimu-ui/advanced/sql-expression-builder"]);t&&t[0].SqlExpressionBuilder&&m(t[0].SqlExpressionBuilder)}catch(e){console.error("load SqlExpressionBuilder error",e)}}))}()}),[]),u?e.ReactDOM.createPortal((0,e.jsx)("div",{className:"select-custom-sql-builder surface-1 border-0",css:Me},(0,e.jsx)("div",{className:"select-custom-sql-builder-header"},(0,e.jsx)(t.Button,{type:"tertiary",size:"sm",icon:!0,onClick:S},(0,e.jsx)(Ie,{autoFlip:n})),(0,e.jsx)(t.Label,null,d("buildCustomSQL"))),p&&i&&(0,e.jsx)(p,{className:"raw-sql-expression-builder",dataSource:i,mode:e.SqlExpressionMode.Simple,widgetId:o,expression:f,noScrollForList:!0,queryScope:e.QueryScope.InRuntimeView,onChange:y})),u):null}var De=i(1888);function je(a){const n="black",o=(0,De.useTheme)(),s=e.React.useMemo((()=>e.css`
      display: inline-block;
      position: relative;
      width: 20px;
      height: 20px;
      background: transparent;

      .select-circle-progress {
        position: absolute;
        left: 0;
        top: 0;

        .progress-circle-bg {
          stroke: ${n};
          opacity: 0.3;
        }

        .progress-circle-progress {
          stroke: ${n};
          transition: none !important;
        }
      }

      .progress-stop {
        position: absolute;
        width: 6px;
        height: 6px;
        left: 7px;
        top: 7px;
        background: ${n};
      }

      .progress-mask {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        background: transparent;
      }
    `),[n]),i=e.hooks.useTranslation(t.defaultMessages,r),c=100*a.progress,l=parseFloat(c.toFixed(2)),u=i("selectingFeaturesTip");return(0,e.jsx)("div",{css:s,onClick:a.onClick,className:"select-progress",title:u},(0,e.jsx)(t.Progress,{className:"select-circle-progress",color:o.ref.palette.neutral[200],type:"circular",value:l,circleSize:20}),(0,e.jsx)("div",{className:"progress-stop"}),(0,e.jsx)("div",{className:"progress-mask"}))}var Ne=function(e,t,a,n){return new(a||(a=Promise))((function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,i)}c((n=n.apply(e,t||[])).next())}))};function Le(a){var n;const{isRTL:o,widgetId:s,widgetDomRef:i,enableDataAction:c,imDataSourceItem:l,itemRuntimeInfo:u,jimuMapView:d,updateDataSourceItemRuntimeInfoForUid:p,onDataRecordSetChange:m}=a,f=l.uid,g=l.useDataSource,y=l.sqlHint||"",v=l.sqlExpression,h=g.dataSourceId,w=l.jimuLayerViewId,b=u.displayTitle,L=u.dataSource,C=u.jimuLayerView,k=u.checked,T=u.imDisplaySqlExpression,E=(null===(n=u.latestSelectTaskInfo)||void 0===n?void 0:n.version)||0,O=u.shouldRenderFilterIcon,A=u.isAttributeFilterOn,V=u.isSelecting,z=u.supportCustomSQLBuilder,P=z,B=e.hooks.useTranslation(t.defaultMessages,r),[F,G]=e.React.useState([]),U=F.length,q=e.React.useRef(null),[W,J]=e.React.useState(!1),[H,$]=e.React.useState(!1),_=e.React.useRef(u);_.current=u;const[Y,Q]=e.React.useState(0),Z=e.React.useRef(null),K=e.React.useRef(0),X=e.React.useMemo((()=>R(z,v)),[z,v]),ee=e.React.useMemo((()=>(z?B("customSQL"):y)||""),[y,z,B]),te=e.React.useMemo((()=>{var t,a,n,o,s;let r=null;if(L&&F.length>0){const i=L.getLabel()||"",c=B("selectWidgetSelection",{layerName:i});r={dataSource:L,name:c,label:c,type:"selected",records:F};let l=!1;const u=L.getInfo&&(null===(a=null===(t=L.getInfo())||void 0===t?void 0:t.selectOptions)||void 0===a?void 0:a.widgetId);if(u){const t=null===(o=null===(n=(0,e.getAppStore)())||void 0===n?void 0:n.getState())||void 0===o?void 0:o.appConfig;if(t&&t.widgets){const e=t.widgets[u],a=null==e?void 0:e.uri;"widgets/arcgis/arcgis-map/"!==a&&"widgets/common/select/"!==a||(l=!0)}}const d=L.getAllUsedFields()||[];let p=[];if(C&&l){const e=C.view;e&&(null===(s=e.availableFields)||void 0===s?void 0:s.length)>0&&(p=e.availableFields.slice())}p||(p=[]);let m=[].concat(d).concat(p);if(m=Array.from(new Set(m)),m.includes("*")){m=m.filter((e=>"*"!==e));const e=L.getSchema();if(null==e?void 0:e.fields){const t=Object.keys(null==e?void 0:e.fields);t.length>0&&(m=t)}}m&&m.length>0&&(r.fields=m)}return r}),[L,C,F,B]),ae=e.React.useMemo((()=>te?[te]:[]),[te]),[ne,oe]=e.React.useState(!1),se=e.React.useMemo((()=>{const e=!w,t=x(E),a=O&&W&&X,n=O&&W&&H,o=(null==C?void 0:C.type)===N.LayerTypes.SubtypeSublayer;return ne||e||t||a||n||o}),[H,W,ne,w,E,O,X,C]),re=e.React.useCallback((()=>Ne(this,void 0,void 0,(function*(){let t=L;if(!t){const a=e.DataSourceManager.getInstance();if(t=a.getDataSource(g.dataSourceId),!t)try{t=yield a.createDataSourceByUseDataSource(g)}catch(e){t=null,console.error("create data source error",g.dataSourceId,e)}t&&p(f,{dataSource:t})}return t}))),[L,f,p,g]),ie=e.React.useCallback((()=>{var e,t;let a="";return L&&(a=L.getLabel()||(null===(e=L.getDataSourceJson())||void 0===e?void 0:e.sourceLabel)||""),a||C&&(a=null===(t=C.layer)||void 0===t?void 0:t.title),a||(a=""),a&&a!==b&&p(f,{displayTitle:a}),a}),[L,b,C,f,p]);e.React.useEffect((()=>{ie()}),[ie]),e.React.useEffect((()=>{if(!L){const t=e.DataSourceManager.getInstance().getDataSource(h);t&&p(f,{dataSource:t})}}),[L,h,f,p]),e.React.useEffect((()=>{se&&!L&&re()}),[L,re,se]),e.React.useEffect((()=>{if(w&&!C&&d&&0===w.indexOf(d.id)){function e(){return Ne(this,void 0,void 0,(function*(){let e=null;try{e=yield d.whenJimuLayerViewLoaded(w)}catch(t){e=null,console.error("jimuLayerViewLoaded error",w,t)}if(e){const t=e.isLayerVisible();p(f,{checked:t,jimuLayerView:e})}}))}e()}}),[C,w,d,f,p]),e.React.useEffect((()=>{m(f,te)}),[te,m,f]);const le=e.React.useCallback(((t,a)=>{var n,o,r,i;let c=L;if(a){const l=(null===(n=null==t?void 0:t.selectedIds)||void 0===n?void 0:n.length)>0?null==t?void 0:t.selectedIds:null,u=(null===(o=a.selectedIds)||void 0===o?void 0:o.length)>0?a.selectedIds:null,d=(null===(r=a.selectOptions)||void 0===r?void 0:r.widgetId)||"";if(l!==u&&d!==s){const t=Z.current;if(t){const e=`Select widget: selection changed by other widget ${d}, abort current on-the-fly selecting task`;t.ignoreAbortedSelection=!0,t.abort(e)}const a={isAttributeFilterOn:!1};if(null===(i=_.current)||void 0===i?void 0:i.latestSelectTaskInfo){const t={version:_.current.latestSelectTaskInfo.version,selectionMode:e.DataSourceSelectionMode.New,appliedGeometryInfo:j(null),appliedSql:D("")};a.latestSelectTaskInfo=t}p(f,a)}if(a.instanceStatus!==e.DataSourceStatus.Created&&L)p(f,{dataSource:null});else if(a.instanceStatus===e.DataSourceStatus.Created){const t=e.DataSourceManager.getInstance().getDataSource(h);t&&t!==L&&(c=t,p(f,{dataSource:t}))}}let l=[];c&&(l=c.getSelectedRecords()||[],G(l)),G(l),ie()}),[L,h,s,f,p,ie]),ue=e.React.useRef();ue.current=le,e.React.useEffect((()=>{let t=null;const a=(0,e.getAppStore)().getState();return a&&a.dataSourcesInfo&&(t=a.dataSourcesInfo[h]),ue.current&&ue.current(t,t),q.current=(0,e.observeStore)(((e,t)=>{ue.current&&ue.current(e,t)}),["dataSourcesInfo",h]),()=>{q.current&&"function"==typeof q.current&&q.current(),q.current=null}}),[h]),e.React.useEffect((()=>{const e=_.current;if(!e)return;if(!L)return;const t=e.latestSelectTaskInfo;if(!t)return;const a=t.version;if(!x(a))return;if(a<=K.current)return;Q(0),Z.current&&(Z.current.abort(`cancel selecting task ${K.current} because need to execute a new one`),Z.current=null);const n=a;K.current=n;const o=new AbortController;o.selectVersion=n,Z.current=o;const r=o.signal;let i=null;e.imDisplaySqlExpression&&(i=e.imDisplaySqlExpression.asMutable());const c={returnGeometry:!0,sqlExpression:i},l=t.appliedSql;l&&(c.where=l);const u=t.appliedGeometryInfo;u&&(c.geometry=u.geometry,c.geometryType=u.geometryType,c.spatialRel=u.spatialRel);const d=t.selectionMode,m=()=>_.current&&_.current.latestSelectTaskInfo.version===n,g=e=>{m()&&Q(e)},S=new ve(L,s),y=()=>{var e;const t=m(),a=null===(e=Z.current)||void 0===e?void 0:e.ignoreAbortedSelection;return t&&!a};!function(){Ne(this,void 0,void 0,(function*(){try{yield S.selectRecords(c,d,r,C,g,y)}catch(e){console.error("Select widget select records error",e)}Z.current&&Z.current.selectVersion===n&&(Z.current=null),m()&&(p(f,{isSelecting:!1}),Q(1))}))}()}),[E,L,C,f,p,s]),e.React.useEffect((()=>{const e=I(z,v);p(f,{shouldRenderFilterIcon:e,imDisplaySqlExpression:v})}),[z,v,f,p]);const de=e.React.useCallback(((e,t)=>Ne(this,void 0,void 0,(function*(){const a=_.current;if(!a)return;let n=a.dataSource;if(n||(n=yield re()),!n)return;t=j(t);const o=M(a.isAttributeFilterOn,a.imDisplaySqlExpression,n),s=a.latestSelectTaskInfo;if(s.version>0){const a=e===s.selectionMode,n=t===s.appliedGeometryInfo,r=o===s.appliedSql;if(a&&n&&r)return}const r=s.version+1;p(f,{latestSelectTaskInfo:{version:r,selectionMode:e,appliedGeometryInfo:t,appliedSql:o},isSelecting:!0})}))),[re,f,p]),me=e.React.useRef();me.current=de;const fe=e.React.useCallback((e=>{e=!!e,O&&p(f,{isAttributeFilterOn:e})}),[O,f,p]),ge=e.React.useCallback((()=>Ne(this,void 0,void 0,(function*(){let t=L;if(t||(t=yield re()),!t)return;new ve(t,s).clearSelection();const a=_.current.latestSelectTaskInfo.version+1,n=j(null),o=D(""),r={version:a,selectionMode:e.DataSourceSelectionMode.New,appliedGeometryInfo:n,appliedSql:o};p(f,{latestSelectTaskInfo:r,isAttributeFilterOn:!1,isSelecting:!0})}))),[L,re,f,p,s]),ye=e.React.useRef(!0);e.React.useEffect((()=>{const t=_.current;if(!t)return;const a=ye.current;if(ye.current=!1,!L&&!a)return void oe(!0);const n=t.latestSelectTaskInfo;M(A,T,L)!==n.appliedSql&&me.current&&me.current(e.DataSourceSelectionMode.New,n.appliedGeometryInfo)}),[L,T,A]),e.React.useEffect((()=>{p(f,{tryExecuteSelectingByGeometryInfoAndSqlUI:de})}),[de,f,p]),e.React.useEffect((()=>{p(f,{enableAttributeFilter:fe})}),[fe,f,p]),e.React.useEffect((()=>{p(f,{clearSelection:ge})}),[ge,f,p]);const he=e.React.useCallback(((e,t)=>{p(f,{checked:t})}),[p,f]),we=e.React.useCallback((()=>{J(!W)}),[J,W]),be=e.React.useCallback((()=>{ge()}),[ge]),Ie=e.React.useCallback((()=>{const e=Z.current;e&&e.abort()}),[Z]),Re=e.React.useCallback((()=>{$(!0)}),[$]),Me=e.React.useCallback(((e,t)=>{fe(t)}),[fe]),De=e.React.useCallback((e=>{const t=I(z,e);p(f,{shouldRenderFilterIcon:t,imDisplaySqlExpression:e})}),[z,p,f]),Le=e.React.useCallback((e=>{De(e),$(!1)}),[De,$]),Ce=e.React.useMemo((()=>{let t=38;O&&(t+=26),c&&(t+=26);const a=`${t}px`;let n=4;n+=V?20:4+10*U.toString().length+4;const o=`${n}px`;return e.css`
    .select-ds-list-item-top-row {
      position: relative;

      .ds-list-label-container {
        width: calc(100% - ${a});
        flex-basis: calc(100% - ${a});
        flex-shrink: 0;
        flex-grow: 0;

        .ds-list-label {
          max-width: calc(100% - ${o});
          flex-basis: auto;
          flex-shrink: 0;
          flex-grow: 0;

          .layer-name {
            width: calc(100% - 20px);
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
          }
        }

        .selection-count-container {
          width: ${o};
          flex-basis: ${o};
          flex-shrink: 0;
          flex-grow: 0;

          .selection-count {
            display: inline;
            border-radius: 4px;
            background: var(--ref-palette-neutral-300);
            padding: 1px 4px 0px 4px;
            line-height: 16px;
            font-size: 12px;
          }
        }
      }

      .ds-list-icons {
        box-sizing: border-box;
        flex-direction: row-reverse;
        width: ${a};
        flex-basis: ${a};
        flex-shrink: 0;
        flex-grow: 0;
      }
    }

    .select-sql-hint {
      word-break: break-all;
    }

    .sql-expr-runtime-disabled {
      touch-action: none;
      pointer-events: none;
    }
  `}),[c,V,U,O]);return b?(0,e.jsx)("div",{className:(0,e.classNames)(["select-ds-list-item w-100 mt-2",{"filer-panel-opened":W}]),css:Ce},(0,e.jsx)("div",{className:"select-ds-list-item-top-row w-100 d-flex align-items-center"},(0,e.jsx)("div",{className:"ds-list-label-container d-flex align-items-center"},(0,e.jsx)(t.Label,{className:"ds-list-label d-flex align-items-center mb-0"},(0,e.jsx)(t.Checkbox,{checked:k,className:"mr-1",onChange:he}),(0,e.jsx)("span",{className:"layer-name",title:b},b)),(0,e.jsx)("div",{className:"selection-count-container d-flex align-items-center pl-1"},!V&&U>0&&(0,e.jsx)("div",{className:"selection-count"},U),V&&(0,e.jsx)(je,{progress:Y,onClick:Ie}))),(0,e.jsx)("div",{className:"ds-list-icons d-flex align-items-center"},c&&(0,e.jsx)(t.DataActionList,{widgetId:s,dataSets:ae,disableDataSourceLevelActions:!0,buttonType:"tertiary",listStyle:t.DataActionListStyle.Dropdown,hideGroupTitle:!0}),(0,e.jsx)(t.Button,{title:B("clearSelection"),type:"tertiary",size:"sm",icon:!0,onClick:be},(0,e.jsx)(pe,{size:16})),O&&(0,e.jsx)(t.Button,{title:B("attributeSelection"),type:W?"primary":"tertiary",size:"sm",icon:!0,onClick:we},(0,e.jsx)(Se,{width:16,height:16})))),O&&(0,e.jsx)("div",{className:(0,e.classNames)(["filter-panel w-100",{"d-none":!W}])},(0,e.jsx)("div",{className:"d-flex w-100 align-items-center mt-3"},(0,e.jsx)("label",{className:"w-100 pb-0 pr-1 select-sql-hint"},ee),P&&(0,e.jsx)(t.Button,{title:B("customSQL"),type:"tertiary",size:"sm",icon:!0,onClick:Re},(0,e.jsx)(ce,null)),(0,e.jsx)(t.Switch,{disabled:V,checked:A,onChange:Me})),X&&L&&(0,e.jsx)(S.SqlExpressionRuntime,{className:(0,e.classNames)([{"sql-expr-runtime-disabled":V}]),widgetId:s,dataSource:L,expression:T,onChange:De}),H&&L&&(0,e.jsx)(xe,{isRTL:o,widgetId:s,widgetDomRef:i,dataSource:L,imSqlExpression:T,onBack:Le}))):null}var Ce=i(13424),ke=i.n(Ce),Te=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(a[n[o]]=e[n[o]])}return a};const Ee=t=>{const a=window.SVG,{className:n}=t,o=Te(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:s,src:ke()},o)):e.React.createElement("svg",Object.assign({className:s},o))};function Oe(a){const{isRTL:n,widgetId:o,widgetDomRef:s,jimuMapView:i,enableDataAction:c,allImDataSourceItems:l,notConfigDataSourceItems:u,configDataSourceItems:d,dataSourceItemRuntimeInfoMap:p,updateDataSourceItemRuntimeInfoForUid:m}=a,f=e.hooks.useTranslation(t.defaultMessages,r),[g,S]=e.React.useState(!1),[y,v]=e.React.useState({}),h=e.React.useRef(null),b=e.React.useMemo((()=>function(e,t){const a=[];return e.forEach((e=>{const n=e.uid,o=t[n];o&&a.push(o)})),a}(l,p)),[p,l]),I=e.React.useCallback((()=>{S((e=>!e))}),[S]),R=e.React.useCallback((()=>{S(!1)}),[S]),M=e.React.useCallback((()=>{S(!1),b.forEach((e=>{e.checked||m(e.uid,{checked:!0})}))}),[b,m]),x=e.React.useCallback((()=>{S(!1),b.forEach((e=>{e.checked&&m(e.uid,{checked:!1})}))}),[b,m]),D=e.React.useCallback((()=>{S(!1),b.forEach((e=>{m(e.uid,{checked:!e.checked})}))}),[b,m]),j=e.React.useCallback(((e,t)=>{v((a=>Object.assign({},a,{[e]:t})))}),[v]),N=e.React.useCallback((e=>e.filter((e=>{const t=e.uid;return!!p[t]}))),[p]),L=e.React.useMemo((()=>N(u)),[u,N]),C=e.React.useMemo((()=>N(d)),[d,N]),k=e.React.useMemo((()=>{const e=w(l,p),t={};e.forEach((e=>{const a=null==e?void 0:e.uid;a&&(t[a]=!0)}));const a=[];return Object.keys(y).forEach((e=>{if(t[e]){const t=y[e];t&&a.push(t)}})),a}),[l,p,y]),T=e.React.useMemo((()=>e.css`
      .select-layers-btn {
        margin-left: -4px;
      }

      .layers-header-tip {
        font-size: 0.875rem;
        color: var(--ref-palette-neutral-1100);
        font-weight: 600;
      }
    `),[]);return(0,e.jsx)("div",{className:"data-attribute-select p-4",css:T},(0,e.jsx)("div",{className:"w-100 d-flex align-items-center"},(0,e.jsx)(t.Button,{className:"select-layers-btn mr-1",type:"tertiary",size:"sm",icon:!0,ref:h,onClick:I},(0,e.jsx)(Ee,{width:16,height:16})),(0,e.jsx)(t.Label,{className:"layers-header-tip mb-0 w-100"}," ",f("layers")," "),c&&(0,e.jsx)(t.DataActionList,{widgetId:o,dataSets:k,disableDataSourceLevelActions:!0,buttonType:"tertiary",listStyle:t.DataActionListStyle.Dropdown,hideGroupTitle:!0,alwaysShowBatchIcon:!0})),(0,e.jsx)("div",{className:"ds-list-items"},L.map((t=>{const a=t.uid,r=p[a];return(0,e.jsx)(Le,{key:a,isRTL:n,widgetId:o,widgetDomRef:s,jimuMapView:i,enableDataAction:c,imDataSourceItem:t,itemRuntimeInfo:r,updateDataSourceItemRuntimeInfoForUid:m,onDataRecordSetChange:j})}))),(0,e.jsx)("div",{className:"ds-list-items"},C.map((t=>{const a=t.uid,r=p[a];return(0,e.jsx)(Le,{key:a,isRTL:n,widgetId:o,widgetDomRef:s,jimuMapView:i,enableDataAction:c,imDataSourceItem:t,itemRuntimeInfo:r,updateDataSourceItemRuntimeInfoForUid:m,onDataRecordSetChange:j})}))),(0,e.jsx)(t.Popper,{reference:h,floating:!1,open:g,showArrow:!1,toggle:R},(0,e.jsx)("div",{className:"d-flex flex-column"},(0,e.jsx)(t.DropdownItem,{className:"justify-content-start",onClick:M},f("allSelectable")),(0,e.jsx)(t.DropdownItem,{className:"justify-content-start",onClick:x},f("noneSelectable")),(0,e.jsx)(t.DropdownItem,{className:"justify-content-start",onClick:D},f("toggleAll")))))}var Ae=function(e,t,a,n){return new(a||(a=Promise))((function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,i)}c((n=n.apply(e,t||[])).next())}))};function Ve(a){const{widgetId:n,visible:o,allImDataSourceItems:s,dataSourceItemRuntimeInfoMap:i,imSpatialSelection:c,updateDataSourceItemRuntimeInfoForUid:l}=a,f=c.buffer;let g=!1,S=0,y=null;f&&(g=f.enable,S=f.distance,y=f.unit),"number"!=typeof S&&(S=0),y||(y=p.Meters);const[v,h]=e.React.useState({}),[I,R]=e.React.useState(c.relationships&&c.relationships[0]),[M,x]=e.React.useState(""),[D,j]=e.React.useState(S),[L,C]=e.React.useState(y),[k,T]=e.React.useState(-1),[E,O]=e.React.useState(!1),A=e.React.useRef([]),V=e.hooks.useTranslation(t.defaultMessages,r);e.React.useEffect((()=>{"number"==typeof S&&j(S)}),[S]),e.React.useEffect((()=>{y&&C(y)}),[y]);const z=e.React.useMemo((()=>e.css`
      border-bottom: 1px solid var(--ref-palette-neutral-400);

      .select-by-location-title {
        font-size: 0.875rem;
        color: var(--ref-palette-neutral-1100);
        font-weight: 600;
      }

      .select-by-location-param-title {
        font-weight: 500;
      }

      .feature-count-info {
        background: var(--primary-100, #E6F2FF);
        border-color: var(--info-300, #60CEFF);
        border-width: 1px;
        border-style: solid;
        min-height: 32px;
      }
    `),[]),P=e.React.useMemo((()=>{if(!M)return null;return v[M]||e.DataSourceManager.getInstance().getDataSource(M)}),[v,M]),B=e.React.useMemo((()=>{let e=null;return P&&(e=P.getMainDataSource()),e}),[P]),F=e.React.useMemo((()=>w(s,i).length),[s,i]),G=e.React.useMemo((()=>b(s,i)),[s,i]),U=G.length,q=e.React.useMemo((()=>{let e=I&&P&&!E&&F>0&&F===U;return e=!!e,e}),[E,F,U,I,P]),W=e.React.useCallback((()=>{A.current=G;const e=A.current||[];O(!0),e.forEach((e=>{const t=e.uid;l(t,{isSelecting:!0})}))}),[A,G,l]),J=e.React.useCallback((t=>{const a=A.current||[];A.current=[],O(!1),a.forEach((a=>Ae(this,void 0,void 0,(function*(){a.tryExecuteSelectingByGeometryInfoAndSqlUI(e.DataSourceSelectionMode.New,t)}))))}),[A,O]),H=e.React.useCallback((()=>{const e=A.current||[];A.current=[],O(!1),e.forEach((e=>{const t=e.uid;l(t,{isSelecting:!1})}))}),[A,O,l]),$=e.React.useCallback((()=>{if(!I)return;if(!P)return;W();const t=function(e,t,a,n){return Ae(this,void 0,void 0,(function*(){const o={outFields:[],returnGeometry:!0,outSR:102100},s=yield e.ds.queryAll(o),r=yield(0,N.loadArcGISJSAPIModules)(["esri/geometry/support/jsonUtils","esri/geometry/geometryEngineAsync"]),[i,c]=r,l=[];s&&s.records.length>0&&s.records.forEach((e=>{const t=e.getGeometry();if(t)if(t.declaredClass)l.push(t);else{const e=i.fromJSON(t);l.push(e)}}));let u=null;if(l.length>0)if(t&&a>0&&n){const e=m[n],t=!0,o=yield c.buffer(l,[a],e,t);u=Array.isArray(o)?o[0]:o}else u=1===l.length?l[0]:yield c.union(l);return u}))}(new ve(P,n),g,D,L);t.then((t=>{if(!t)return void H();const a=e.dataSourceUtils.changeJSAPIGeometryTypeToRestAPIGeometryType(t.type),n=u[I],o={geometry:t.toJSON(),geometryType:a,spatialRel:n};J(o)})).catch((e=>{console.error("can not get buffered union geometry",e),H()}))}),[D,L,g,H,J,W,I,P,n]);e.React.useEffect((()=>{T(-1),P&&P.queryCount({}).then((e=>{if(P.id===M){const t=(null==e?void 0:e.count)||0;T(t)}})).catch((e=>{console.error("query count error for location data source",e)}))}),[P,M]);const _=e.React.useCallback((e=>{if(P&&P.id===M&&ze(P)){const t=(null==e?void 0:e.length)||0;T(t)}}),[P,M]),Y=e.React.useCallback((e=>{const t=e.target.value;R(t)}),[R]),Q=e.React.useCallback((e=>{const t=e.target.value;x(t)}),[x]),Z=e.React.useCallback((e=>{e&&h((t=>{const a=e.id;return Object.assign({},t,{[a]:e})}))}),[h]),K=e.React.useCallback((e=>{j(e)}),[j]),X=e.React.useCallback((e=>{const t=e.target.value;C(t)}),[C]),ee=c.useDataSources,te=e.React.useMemo((()=>{const e=[];return ee.forEach((t=>{const a=t.dataSourceId,n=v[a];n&&e.push(n)})),e}),[v,ee]);e.React.useEffect((()=>{if(!M&&ee.length>0&&te.length>0){const e=ee[0]&&ee[0].dataSourceId;if(e){te.find((t=>t.id===e))&&x(e)}}}),[ee,te,M]);const ae=V("selectByData"),ne=V("apply"),oe=V("relationship"),se=V("selectingFeatures"),re=V("theBufferDistance"),ie=V("bufferUnit"),ce=V("selectByLocationFeatureCountTip",{count:k});return(0,e.jsx)("div",{className:(0,e.classNames)(["select-by-location p-4",{"d-none":!o}]),css:z},(0,e.jsx)("div",{className:"d-flex w-100 align-items-center mb-2"},(0,e.jsx)("label",{className:"select-by-location-title w-100 mb-0",title:ae},ae),(0,e.jsx)(t.Button,{className:"nowrap",type:"primary",disabled:!q,size:"sm",onClick:$},ne)),(0,e.jsx)("div",{className:"relationship-param w-100 d-flex flex-column align-items-center mb-2"},(0,e.jsx)("label",{className:"select-by-location-param-title w-100 mb-2",title:oe},oe),(0,e.jsx)(t.Select,{className:"relationship-select w-100",size:"sm",value:I,"aria-label":oe,onChange:Y},c.relationships.map((t=>(0,e.jsx)("option",{key:t,value:t},V(d[t])))))),(0,e.jsx)("div",{className:"data-view-param w-100 d-flex flex-column align-items-center mb-2"},(0,e.jsx)("label",{className:"select-by-location-param-title w-100 mb-2",title:se},se),(0,e.jsx)(t.Select,{className:"selecting-features-select w-100",size:"sm",value:M,"aria-label":se,onChange:Q},te.map((t=>(0,e.jsx)("option",{key:t.id,value:t.id},t.getLabel()||"")))),ee.map((t=>(0,e.jsx)(e.DataSourceComponent,{key:t.dataSourceId,useDataSource:t,onDataSourceCreated:Z})))),P&&B&&ze(P)&&(0,e.jsx)(e.DataSourceComponent,{dataSource:B,onSelectionChange:_}),g&&(0,e.jsx)("div",{className:"distance-unit-param w-100 d-flex flex-column align-items-center"},(0,e.jsx)("label",{className:"select-by-location-param-title w-100 mb-2",title:re},re),(0,e.jsx)("div",{className:"d-flex w-100 justify-content-between"},(0,e.jsx)(t.NumericInput,{className:"distance-input w-45 mr-1","aria-label":re,size:"sm",value:D,min:0,onChange:K}),(0,e.jsx)(t.Select,{className:"unit-select w-55",size:"sm",value:L,"aria-label":ie,onChange:X},Object.values(p).map((t=>(0,e.jsx)("option",{key:t,value:t},V(`unit_${t}`))))))),k>=0&&(0,e.jsx)(t.Alert,{type:"info",withIcon:!0,text:ce,className:"w-100 mt-3","aria-live":"polite",buttonType:"default",closable:!1,form:"basic",open:!0,size:"medium"}))}function ze(t){return!!t&&(t.isDataView&&t.dataViewId===e.CONSTANTS.SELECTION_DATA_VIEW_ID)}function Pe(t){const{isRTL:a,className:n,widgetProps:o,widgetDomRef:s,dataSourceItemRuntimeInfoMap:r,mixinDataSourceItemRuntimeInfoMap:i,updateDataSourceItemRuntimeInfoForUid:c,removeNotUsedDataSourceItemRuntimeInfoMap:l,updateWidgetDisplayMode:u}=t,d=e.React.useRef();d.current=l;const{widgetId:p,config:m,dataSourceCount:f,autoControlWidgetId:S}=o,{dataAttributeInfo:w,spatialSelection:b}=m,{allowGenerated:I,dataSourceItems:R}=w,M=!1!==o.enableDataAction,x=!!(null==b?void 0:b.enable),[D,j]=e.React.useState(!1),[N,L]=e.React.useState((0,e.Immutable)([])),k=e.React.useMemo((()=>N.concat(R)),[R,N]),T=e.React.useRef(k);T.current=k,e.React.useEffect((()=>{let e=null;if(k.length>0){e=h(k,r).length>0?g.Normal:g.Loading}else e=g.Placeholder;u(e)}),[k,r,u]),e.React.useEffect((()=>{if(!I)return void(0!==N.length&&L((0,e.Immutable)([])));const t=(0,e.getAppStore)().getState().dataSourcesInfo||(0,e.Immutable)({}),a=e.DataSourceManager.getInstance(),n=N.map((e=>e.useDataSource.dataSourceId)).asMutable(),o=[];Object.keys(t).forEach((t=>{if(t.includes("view_in_table"))return;const n=a.getDataSource(t);if(n){const t=n.isAssociatedFeatureLayer,a=n.getDataSourceJson(),s=null==a?void 0:a.isOutputFromWidget;n.isInAppConfig()||n.isDataView||n.isLocal||s||t||C(n.type)&&n.type!==e.DataSourceTypes.SubtypeGroupLayer&&o.push(n.id)}}));const{added:s,deleted:c,saved:l}=e.utils.diffArrays(!0,n,o);if(0===s.length&&0===c.length)return;const u=N.filter((e=>{const t=e.useDataSource.dataSourceId;return l.includes(t)})),d=[];if(s.length>0){s.forEach((e=>{const t=a.getDataSource(e);if(t){const e=v(t);d.push(e)}}));const e=y(!1,!0,d,r);i(e)}const p=u.concat(d);L(p)}),[f,I,N,i,L,r]),e.React.useEffect((()=>{const e=R.filter((e=>{const t=e.uid;return!r[t]}));if(e.length>0){const t=y(!1,!1,e,r);i(t)}}),[R,r,i]),e.React.useEffect((()=>{const e=setTimeout((()=>{if(T.current){const e=[];T.current.forEach((t=>{e.push(t.uid)})),d.current&&d.current(e)}}),100);return()=>{clearTimeout(e)}}),[k]);const E=["select-use-data-source-entry"];n&&E.push(n);const O=E.join(" ");return e.React.createElement("div",{className:O},e.React.createElement(ae,{config:m,widgetId:p,mapWidgetId:"",autoControlWidgetId:S,activeJimuMapView:null,setSelectByLocationVisible:j,allImDataSourceItems:k,dataSourceItemRuntimeInfoMap:r}),x&&e.React.createElement(Ve,{widgetId:p,visible:D,allImDataSourceItems:k,dataSourceItemRuntimeInfoMap:r,imSpatialSelection:b,updateDataSourceItemRuntimeInfoForUid:c}),e.React.createElement(Oe,{isRTL:a,widgetId:p,widgetDomRef:s,jimuMapView:null,enableDataAction:M,allImDataSourceItems:k,notConfigDataSourceItems:N,configDataSourceItems:R,dataSourceItemRuntimeInfoMap:r,updateDataSourceItemRuntimeInfoForUid:c}))}var Be=function(e,t,a,n){return new(a||(a=Promise))((function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,i)}c((n=n.apply(e,t||[])).next())}))};function Fe(t){const{isRTL:a,className:n,widgetProps:o,widgetDomRef:s,dataSourceItemRuntimeInfoMap:r,mixinDataSourceItemRuntimeInfoMap:i,updateDataSourceItemRuntimeInfoForUid:c,clearAllDataSourceItemRuntimeInfoMap:l,removeNotUsedDataSourceItemRuntimeInfoMap:u,removeGeneratedJimuLayerViewDataSourceItemRuntimeInfoMap:d,updateWidgetDisplayMode:p}=t;e.React.useRef().current=r;const m=e.React.useRef();m.current=l;const f=e.React.useRef();f.current=u;const S=e.React.useRef();S.current=d;const{widgetId:w,config:b,dataSourceCount:I,mapWidgetId:R,autoControlWidgetId:M}=o,{spatialSelection:x}=b,D=b.mapInfo||function(){const t={};return(0,e.Immutable)(t)}(),j=!1!==o.enableDataAction,L=!!(null==x?void 0:x.enable),[k,A]=e.React.useState(!1),[z,P]=e.React.useState(null),B=e.React.useRef(z);B.current=z;const F=z?z.id:"",G=e.React.useMemo((()=>{let t=null;return D&&F&&(t=D[F]),t||(t=function(){const t={syncWithMap:!0,allowGenerated:!0,enableAttributeSelection:!1,dataSourceItems:void 0};return(0,e.Immutable)(t)}()),t}),[F,D]),U=!!G.syncWithMap,q=e.React.useRef(U);q.current=U;const W=U,J=e.React.useRef(W);J.current=W;const H=function(e,t){return!!e||t}(U,G.allowGenerated),$=e.React.useRef(H);$.current=H;const _=E(U,G.enableAttributeSelection);e.React.useRef(_).current=_;const[Y,Q]=e.React.useState((0,e.Immutable)([])),Z=e.React.useRef(),K=e.React.useCallback((()=>{if(!W&&!H||!z)return void(0!==Y.length&&Q((0,e.Immutable)([])));const t=e.DataSourceManager.getInstance(),a=Y.map((e=>e.useDataSource.dataSourceId)).asMutable(),n=[];Ge(z,W,H).forEach((t=>{const a=t.getLayerDataSource();if(a&&C(a.type)&&a.type!==e.DataSourceTypes.SubtypeGroupLayer){const e=a.getDataSourceJson();(null==e?void 0:e.isOutputFromWidget)||n.push(a.id)}}));const{added:o,saved:s}=e.utils.diffArrays(!0,a,n),r=Y.filter((e=>{const t=e.useDataSource.dataSourceId;return s.includes(t)})),i=[];o.length>0&&o.forEach((e=>{const a=t.getDataSource(e);if(a){const e=z.getJimuLayerViewByDataSourceId(a.id),t=v(a,null==e?void 0:e.id);i.push(t)}}));const c=r.concat(i).asMutable(),l=O(z,c),u=(0,e.Immutable)(l);Q(u)}),[z,H,W,Y]);Z.current=K,e.React.useEffect((()=>{const e=Y.filter((e=>{const t=e.uid;return!r[t]}));if(e.length>0){let t=!1;t=!!_;const a=y(!0,t,e,r);i(a)}}),[r,_,Y,i]);const X=e.React.useCallback((e=>{qe(Ge(e,J.current,$.current)).finally((()=>{Z.current&&Z.current()}))}),[]),ee=e.React.useRef();ee.current=X,e.React.useEffect((()=>{m.current&&m.current(),ee.current&&B.current&&ee.current(B.current)}),[U]),e.React.useEffect((()=>{ee.current&&B.current&&ee.current(B.current)}),[H]),e.React.useEffect((()=>{S.current&&S.current()}),[_]),e.React.useEffect((()=>{m.current&&m.current(),ee.current&&ee.current(z);const e=e=>Be(this,void 0,void 0,(function*(){if(e&&Ue(e,J.current,$.current)&&e.type!==N.LayerTypes.SubtypeGroupLayer){yield qe([e]);const t=e.getLayerDataSource();t&&C(t.type)&&Z.current&&Z.current()}})),t=e=>Be(this,void 0,void 0,(function*(){if(!q.current)return;const t=e.filter((e=>T(e)));if(t.length>0){const e=t.filter((e=>Ue(e,J.current,$.current)));e.length>0&&(yield qe(e)),Z.current&&Z.current()}})),a=e=>Be(this,void 0,void 0,(function*(){e&&e.fromRuntime&&Z.current&&Z.current()}));return z&&(z.addJimuLayerViewCreatedListener(e),z.addJimuLayerViewsVisibleChangeListener(t),z.addJimuLayerViewRemovedListener(a)),()=>{z&&(z.removeJimuLayerViewCreatedListener(e),z.removeJimuLayerViewsVisibleChangeListener(t),z.removeJimuLayerViewRemovedListener(a))}}),[z]),e.React.useEffect((()=>{Z.current&&Z.current()}),[I]);const te=e.React.useMemo((()=>{let t=null;if(G&&!U){const e=G.dataSourceItems;e&&e.length>0&&(t=e)}return t||(t=(0,e.Immutable)([])),t}),[G,U]),ne=e.React.useMemo((()=>Y.concat(te)),[te,Y]),oe=e.React.useRef(ne);oe.current=ne;const se=Y.length,re=e.React.useMemo((()=>{var e,t;let a=0;if(R){const n=V(R);(null===(e=n.useDataSources)||void 0===e?void 0:e.length)>0&&(a=null===(t=n.useDataSources)||void 0===t?void 0:t.length)}return a}),[R]);e.React.useEffect((()=>{let e=null;if(R){let t=0;if(D&&Object.values(D).forEach((e=>{if(e&&!e.syncWithMap&&e.dataSourceItems){const a=e.dataSourceItems.length;a>0&&(t+=a)}})),0===se&&0===t&&0===re)e=g.NoLayersTip;else if(F)if(ne.length>0){e=h(ne,r).length>0?g.Normal:g.Loading}else e=g.NoLayersTip;else e=g.Loading}else e=g.Placeholder;p(e)}),[F,ne,r,se,re,D,R,p]),e.React.useEffect((()=>{const e=te.filter((e=>{const t=e.uid;return!r[t]}));if(e.length>0){const t=y(!0,!1,e,r);i(t)}}),[te,r,i]),e.React.useEffect((()=>{const e=setTimeout((()=>{if(oe.current){const e=[];oe.current.forEach((t=>{e.push(t.uid)})),f.current&&f.current(e)}}),100);return()=>{clearTimeout(e)}}),[ne]);const ie=e.React.useCallback((e=>{P(e)}),[P]),ce=["select-use-map-entry"];n&&ce.push(n);const le=ce.join(" ");return e.React.createElement("div",{className:le},R&&e.React.createElement(N.JimuMapViewComponent,{useMapWidgetId:R,onActiveViewChange:ie}),e.React.createElement(ae,{config:b,widgetId:w,mapWidgetId:R,autoControlWidgetId:M,activeJimuMapView:z,setSelectByLocationVisible:A,allImDataSourceItems:ne,dataSourceItemRuntimeInfoMap:r}),L&&e.React.createElement(Ve,{widgetId:w,visible:k,allImDataSourceItems:ne,dataSourceItemRuntimeInfoMap:r,imSpatialSelection:x,updateDataSourceItemRuntimeInfoForUid:c}),e.React.createElement(Oe,{isRTL:a,widgetId:w,widgetDomRef:s,jimuMapView:z,enableDataAction:j,allImDataSourceItems:ne,notConfigDataSourceItems:Y,configDataSourceItems:te,dataSourceItemRuntimeInfoMap:r,updateDataSourceItemRuntimeInfoForUid:c}))}function Ge(e,t,a){const n=[];return e&&Object.values(e.jimuLayerViews).forEach((e=>{e&&Ue(e,t,a)&&n.push(e)})),n}function Ue(e,t,a){return!!(e&&T(e)&&function(e){var t,a,n;if(e){const o=e.getJimuMapView(),s=(null===(n=null===(a=null===(t=null==o?void 0:o.view)||void 0===t?void 0:t.map)||void 0===a?void 0:a.layers)||void 0===n?void 0:n.toArray())||[],r=function(e){let t=null;if(e){const a=e.getJimuMapView();if(a){const n=a.getParentJimuLayerViews(e.id);t=n.length>0?n[n.length-1]:e}}return t}(e),i=null==r?void 0:r.layer;if((null==s?void 0:s.length)>0&&i)return s.includes(i)}return!1}(e)&&e.isLayerVisible())&&(e.fromRuntime?a:t)}function qe(e){const t=e.map((e=>{const t=e.getLayerDataSource();if(t)return Promise.resolve(t);return function(e){return new Promise((t=>{e.then((e=>{t(e)})).catch((()=>{t(null)}))}))}(e.createLayerDataSource())}));return Promise.all(t)}var We=i(32772),Je=i.n(We);function He(e){const t=[];e.dataAttributeInfo&&e.dataAttributeInfo.dataSourceItems&&e.dataAttributeInfo.dataSourceItems.length>0&&e.dataAttributeInfo.dataSourceItems.forEach((e=>{const a=e.useDataSource.asMutable();t.push(a)})),e.mapInfo&&Object.values(e.mapInfo).forEach((e=>{const a=null==e?void 0:e.dataSourceItems;a&&a.length>0&&a.forEach((e=>{if(null==e?void 0:e.useDataSource){const a=e.useDataSource.asMutable();t.push(a)}}))})),e.spatialSelection&&e.spatialSelection.useDataSources&&e.spatialSelection.useDataSources.length>0&&e.spatialSelection.useDataSources.forEach((e=>{const a=e.asMutable();t.push(a)}));const a=[],n=[];if(t.forEach((e=>{const t=e.dataSourceId;a.includes(t)||(a.push(t),n.push(e))})),0!==n.length||!e.useMap)return n}class $e extends e.WidgetVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.15.0",description:"remove useless useDataSources from Select widget",upgradeFullInfo:!0,upgrader:e=>{var t,a,n;const o=null==e?void 0:e.widgetJson,s=null==o?void 0:o.config;if(!s)return e;let r=s;if(r.useMap)(null===(a=null===(t=r.dataAttributeInfo)||void 0===t?void 0:t.dataSourceItems)||void 0===a?void 0:a.length)>0&&(r=r.setIn(["dataAttributeInfo","dataSourceItems"],[]));else{const e=null===(n=r.mapInfo)||void 0===n?void 0:n.jimuMapViews;e&&Object.keys(e).length>0&&(r=r.setIn(["mapInfo","jimuMapViews"],{}))}if(s===r)return e;const i=He(r),c=o.set("config",r).set("useDataSources",i),l=Object.assign({},e);return l.widgetJson=c,l}},{version:"1.16.0",description:"Select widget supports syncWithMap option",upgradeFullInfo:!0,upgrader:e=>{const t=null==e?void 0:e.widgetJson,a=null==t?void 0:t.config;if(!a)return e;let n=a;const o=a.mapInfo;if(n=n.set("mapInfo",{}),o&&Object.keys(o).length>0){const e=!!o.allowGenerated,t=!!o.enableAttributeSelection,a=o.jimuMapViews;if(a){const o={};Object.keys(a).forEach((n=>{const s=a[n]||[];o[n]={syncWithMap:!1,allowGenerated:e,enableAttributeSelection:t,dataSourceItems:s}})),n=n.set("mapInfo",o)}}const s=He(n);let r=t.set("config",n).set("useDataSources",s);n.useMap||(r=r.set("useMapWidgetIds",null));const i=Object.assign({},e);return i.widgetJson=r,i}}]}}const _e=new $e,Ye=e.css`
  position: relative;
  overflow-x: hidden;
  overflow-y: auto;

  .nowrap {
    white-space: nowrap;
    text-wrap: nowrap;
  }

  .no-layers-panel-content {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding-left: 50px;
    padding-right: 50px;
  }

  :has(.select-custom-sql-builder) {
    .select-use-data-source-entry, .select-use-map-entry {
      display: none;
    }
  }
`,Qe=a=>{var n;const{isRTL:o,widgetId:i,config:c}=a,{useMap:l}=c,u=e.hooks.useTranslation(t.defaultMessages,r),d=e.React.useRef(),[p,m]=e.React.useState(g.Placeholder),f=e.React.useRef(p);f.current=p;const S=e.React.useRef(!1),y=e.React.useRef(null),[v,h]=e.React.useState({}),w=e.React.useCallback((e=>{if(e!==f.current){if(e===g.Loading){if(S.current)return;S.current=!0,y.current||(y.current=setTimeout((()=>{f.current===g.Loading&&m(g.NoLayersTip)}),2e4))}m(e)}}),[]);e.React.useEffect((()=>()=>{y.current&&clearTimeout(y.current)}),[]);const b=e.React.useCallback((e=>{e&&0!==Object.keys(e).length&&h((t=>Object.assign({},t,e)))}),[h]),I=e.React.useCallback(((e,t)=>{h((a=>{const n=a[e];if(!n)return a;const o=Object.assign({},n,t),s=Object.assign({},a);return s[e]=o,s}))}),[h]),R=e.React.useCallback((()=>{h((()=>({})))}),[h]),M=e.React.useRef();M.current=R;const x=e.React.useCallback((e=>{h((t=>{const a=[];if(Object.keys(t).forEach((t=>{e.includes(t)||a.push(t)})),a.length>0){const e=Object.assign({},t);return a.forEach((t=>{delete e[t]})),e}return t}))}),[h]),D=e.React.useCallback((()=>{h((e=>{const t=[];if(Object.keys(e).forEach((a=>{var n;const o=e[a];(null===(n=null==o?void 0:o.jimuLayerView)||void 0===n?void 0:n.fromRuntime)&&t.push(a)})),t.length>0){const a=Object.assign({},e);return t.forEach((e=>{delete a[e]})),a}return e}))}),[h]);e.hooks.useEffectWithPreviousValues((e=>{const t=e[0]||!1;l!==t&&M.current&&M.current()}),[l]);const j=p!==g.Placeholder,N=(0,e.classNames)(["jimu-widget widget-select border-0"],{"surface-1":j});return(0,e.jsx)("div",{ref:d,className:N,css:Ye},!l&&(0,e.jsx)(Pe,{isRTL:o,className:p===g.Normal?"":"d-none",widgetProps:a,widgetDomRef:d,dataSourceItemRuntimeInfoMap:v,mixinDataSourceItemRuntimeInfoMap:b,updateDataSourceItemRuntimeInfoForUid:I,removeNotUsedDataSourceItemRuntimeInfoMap:x,updateWidgetDisplayMode:w}),l&&(0,e.jsx)(Fe,{isRTL:o,className:p===g.Normal?"":"d-none",widgetProps:a,widgetDomRef:d,dataSourceItemRuntimeInfoMap:v,mixinDataSourceItemRuntimeInfoMap:b,updateDataSourceItemRuntimeInfoForUid:I,clearAllDataSourceItemRuntimeInfoMap:R,removeNotUsedDataSourceItemRuntimeInfoMap:x,removeGeneratedJimuLayerViewDataSourceItemRuntimeInfoMap:D,updateWidgetDisplayMode:w}),p===g.NoLayersTip&&(0,e.jsx)("div",{className:"no-layers-panel w-100 h-100 d-flex align-items-center"},(0,e.jsx)("div",{className:"no-layers-panel-content w-100 h-100"},(0,e.jsx)(s,{width:24,height:24}),(0,e.jsx)("div",{className:"mt-2 mb-2"},u("noLayersAvailableTip")),(null===(n=window.jimuConfig)||void 0===n?void 0:n.isInBuilder)&&(0,e.jsx)("div",null,u("openSettingPanelTip")))),p===g.Loading&&(0,e.jsx)(t.Loading,{type:"SECONDARY"}),p===g.Placeholder&&(0,e.jsx)(t.WidgetPlaceholder,{widgetId:i,icon:Je(),message:u("_widgetLabel")}))};Qe.mapExtraStateProps=(t,a)=>{var n,o;let s=!1,r=0,i="",c="";const l=function(e,t){var a,n,o;if(e&&!e.useMap&&(null===(n=null===(a=e.dataAttributeInfo)||void 0===a?void 0:a.dataSourceItems)||void 0===n?void 0:n.length)>0){const a=null===(o=e.dataAttributeInfo)||void 0===o?void 0:o.dataSourceItems,n=function(e,t){let a=e;if(e&&e.length>0){const n=[];t&&t.length>0&&t.forEach((e=>{const t=null==e?void 0:e.dataSourceId;t&&n.push(t)}));let o=!1;const s=e.filter((e=>{const t=null==e?void 0:e.useDataSource,a=null==t?void 0:t.dataSourceId,s=a&&n.includes(a);return s||(o=!0),s}));a=o?s:e}return a||(a=e),a}(a,t);n&&n!==a&&(e=e.setIn(["dataAttributeInfo","dataSourceItems"],n))}return e}(a.config,a.useDataSources)||a.config;(null===(n=t.appContext)||void 0===n?void 0:n.isRTL)&&(s=!0),t.dataSourcesInfo&&Object.values(t.dataSourcesInfo).forEach((t=>{t&&t.instanceStatus===e.DataSourceStatus.Created&&r++}));const u=a.useMapWidgetIds;return u&&u.length>0&&(i=u[0]),t.mapWidgetsInfo&&i&&(c=(null===(o=t.mapWidgetsInfo[i])||void 0===o?void 0:o.autoControlWidgetId)||""),{isRTL:s,dataSourceCount:r,mapWidgetId:i,autoControlWidgetId:c,config:l}},Qe.versionManager=_e;const Ze=Qe;function Ke(e){i.p=e}})(),c})())}}}));