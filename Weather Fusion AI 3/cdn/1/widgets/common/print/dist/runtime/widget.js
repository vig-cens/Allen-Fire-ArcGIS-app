System.register(["jimu-core","jimu-ui","jimu-arcgis","jimu-theme"],(function(e,t){var l={},o={},i={},n={};return{setters:[function(e){l.AllDataSourceTypes=e.AllDataSourceTypes,l.ArcGISDataSourceTypes=e.ArcGISDataSourceTypes,l.BaseVersionManager=e.BaseVersionManager,l.DataSourceComponent=e.DataSourceComponent,l.DataSourceManager=e.DataSourceManager,l.DataSourceStatus=e.DataSourceStatus,l.Immutable=e.Immutable,l.React=e.React,l.ReactRedux=e.ReactRedux,l.ServiceManager=e.ServiceManager,l.SessionManager=e.SessionManager,l.UtilityManager=e.UtilityManager,l.WidgetState=e.WidgetState,l.appActions=e.appActions,l.appConfigUtils=e.appConfigUtils,l.classNames=e.classNames,l.css=e.css,l.defaultMessages=e.defaultMessages,l.esri=e.esri,l.getAppStore=e.getAppStore,l.hooks=e.hooks,l.jsx=e.jsx,l.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,l.lodash=e.lodash,l.moduleLoader=e.moduleLoader,l.polished=e.polished},function(e){o.Alert=e.Alert,o.Button=e.Button,o.Checkbox=e.Checkbox,o.Icon=e.Icon,o.Loading=e.Loading,o.LoadingType=e.LoadingType,o.Nav=e.Nav,o.NavItem=e.NavItem,o.NavLink=e.NavLink,o.Navbar=e.Navbar,o.NumericInput=e.NumericInput,o.Option=e.Option,o.Popper=e.Popper,o.Radio=e.Radio,o.SVG=e.SVG,o.Select=e.Select,o.TextInput=e.TextInput,o.WidgetPlaceholder=e.WidgetPlaceholder,o.defaultMessages=e.defaultMessages,o.getFallbackPlacementsModifier=e.getFallbackPlacementsModifier},function(e){i.JimuMapViewComponent=e.JimuMapViewComponent,i.MapViewManager=e.MapViewManager,i.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){n.getAppThemeVariables=e.getAppThemeVariables,n.getThemeColorValue=e.getThemeColorValue}],execute:function(){e((()=>{var e={68108:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#C5C5C5" fill-rule="evenodd" d="M2.4.8V4h-.8A1.6 1.6 0 0 0 0 5.6v3.2a1.6 1.6 0 0 0 1.136 1.532c.249.075.464-.143.464-.403 0-.182-.154-.323-.32-.396A.8.8 0 0 1 .8 8.8V5.6a.8.8 0 0 1 .8-.8h12.8a.8.8 0 0 1 .8.8v3.2a.8.8 0 0 1-.48.733c-.166.073-.32.214-.32.396 0 .26.215.478.464.403A1.6 1.6 0 0 0 16 8.8V5.6A1.6 1.6 0 0 0 14.4 4h-.8V.8a.8.8 0 0 0-.8-.8H3.2a.8.8 0 0 0-.8.8m10.4 0H3.2V4h9.6z" clip-rule="evenodd"></path><path fill="#C5C5C5" d="M5.2 10.4a.4.4 0 0 0 0 .8h5.6a.4.4 0 0 0 0-.8zM5.2 12.8a.4.4 0 0 0 0 .8h3.2a.4.4 0 0 0 0-.8z"></path><path fill="#C5C5C5" fill-rule="evenodd" d="M2.4 15.2V8.8H2A.4.4 0 0 1 2 8h12a.4.4 0 0 1 0 .8h-.4v6.4a.8.8 0 0 1-.8.8H3.2a.8.8 0 0 1-.8-.8m10.4-6.4v6.4H3.2V8.8z" clip-rule="evenodd"></path><path fill="#C5C5C5" d="M12 6c0-.22.18-.4.4-.4h.8a.4.4 0 0 1 0 .8h-.8A.4.4 0 0 1 12 6"></path></svg>'},55886:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 12 12"><path fill="#000" fill-rule="evenodd" d="M10.167 0H1.833A.845.845 0 0 0 1 .857v10.286c0 .473.373.857.833.857h8.334c.46 0 .833-.384.833-.857V.857A.845.845 0 0 0 10.167 0M2 11V1h8v10zm1.6-8h4.8c.331 0 .6.224.6.5s-.269.5-.6.5H3.6c-.331 0-.6-.224-.6-.5s.269-.5.6-.5m4.8 3H3.6c-.331 0-.6.224-.6.5s.269.5.6.5h4.8c.331 0 .6-.224.6-.5S8.731 6 8.4 6" clip-rule="evenodd"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},29435:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M14.938 8A7 7 0 0 1 1.01 9H0a8.001 8.001 0 0 0 15.938-1A8 8 0 0 0 1.02 3.98L1 .702a.5.5 0 1 0-1 .006L.031 5.9l5.128-.826a.5.5 0 0 0-.16-.987L1.819 4.6A7 7 0 0 1 14.938 8"></path></svg>'},22167:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M4 4.796 4.796 4 8.02 7.224l3.184-3.184.796.796L8.816 8.02l3.144 3.144-.796.796L8.02 8.816 4.836 12l-.796-.796L7.224 8.02z"></path><path fill="#000" fill-rule="evenodd" d="m0 4 4-4h8l4 4v8l-4 4H4l-4-4zm1 .414L4.414 1h7.172L15 4.414v7.172L11.586 15H4.414L1 11.586z" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=i},79244:e=>{"use strict";e.exports=l},1888:e=>{"use strict";e.exports=n},14321:e=>{"use strict";e.exports=o}},t={};function r(l){var o=t[l];if(void 0!==o)return o.exports;var i=t[l]={exports:{}};return e[l](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var l in t)r.o(t,l)&&!r.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var a={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(a),r.d(a,{__set_webpack_public_path__:()=>zt,default:()=>Vt});var e=r(79244),t=r(14321),l=r(62686);const o="CIMMarkerNorthArrow",i={color:"#000",size:"4px"};var n,s;!function(e){e.CurrentMapExtent="CURRENT MAP EXTENT",e.CurrentMapScale="CURRENT MAP SCALE",e.SetMapScale="SET MAP SCALE"}(n||(n={})),function(e){e.Point="POINT",e.Inch="INCH",e.Centimeter="CENTIMETER",e.Millimeter="MILLIMETER"}(s||(s={}));const u={layoutOptions:{customTextElements:[],hasAuthorText:!0,hasCopyrightText:!0,hasLegend:!0,hasTitleText:!0},mapSurroundInfos:[],pageSize:null,pageUnits:null,webMapFrameSize:null},d={scalePreserved:!1,outScale:36978595.474472,layoutOptions:{titleText:"ArcGIS Web Map"},exportOptions:{dpi:96},printExtentType:n.CurrentMapExtent,attributionVisible:!1,forceFeatureAttributes:!0,wkid:102100,wkidLabel:"WGS_1984_Web_Mercator_Auxiliary_Sphere",enableTitle:!0,legendEnabled:!0,enableMapPrintExtents:!0,enableOutputSpatialReference:!0,enableQuality:!0,enableFeatureAttribution:!0,enableMapSize:!0,overrideCommonSetting:!1,enableAuthor:!0,enableCopyright:!0,enableLegend:!0,enableScalebarUnit:!0,enableCustomTextElements:!0};var c,p,v,m,y,h,f,g,x;!function(e){e.LayoutTemplate="Layout Template",e.ReportTemplate="Report Template"}(c||(c={})),function(e){e.Classic="CLASSIC",e.Compact="COMPACT"}(p||(p={})),function(e){e.OrganizationService="ORGANIZATION SERVICE",e.Customize="CUSTOMIZE"}(v||(v={})),function(e){e.OrganizationTemplate="ORGANIZATION TEMPLATE",e.Customize="CUSTOMIZE"}(m||(m={})),function(e){e.Loading="LOADING",e.Success="SUCCESS",e.Error="ERROR"}(y||(y={})),function(e){e.PrintTemplate="PRINT TEMPLATE",e.PrintResult="PRINT RESULT"}(h||(h={})),function(e){e.ServiceLayout="Service Layout",e.CustomLayout="Custom Layout"}(f||(f={})),function(e){e.RPTT="RPTT",e.RPTX="RPTX"}(g||(g={})),function(e){e.ServiceReport="Service Report",e.CustomReport="Custom Report"}(x||(x={}));var b=r(68108),w=r.n(b);const S={_widgetLabel:"Print",printPlaceholder:"Select or switch to a webmap to enable print.",chooseMapTip:"Please select a map with 2D data.",chooseUseUtility:"Please select utility.",printTemplate:"Print template",printResult:"Print result",previewPrint:"Preview print extents",fileFormat:"File format",mapPrintingExtents:"Map printing extents",outputSpatialReference:"Output spatial reference",printQuality:"Print quality",featureAttribution:"Feature attribution",selectEditableSettings:"Select editable settings",currentMapExtent:"Current map extent",currentMapScale:"Current map scale",setMapScale:"Set map scale",useCurrentScale:"Use current scale",wellKnownId:"Enter a well-known ID ({wkid})",allowEditing:"Select settings that allow editing at runtime",includeAttribution:"Include attribution",includeAttributes:"Include attributes",includeLegend:"Include legend",templateConfiguration:"Template configuration",templateName:"Template name",printLayout:"Layout",MapOnlyOptions:"Map-only options",LayoutOptions:"Layout options",mapSize:"Map size",spatialReference:"Output spatial reference {WKID}",printAuthor:"Author",printCopyright:"Copyright",scaleBarUnit:"Scalebar unit",mapAttribution:"Map attribution",resultEmptyMessage:"Your printed files will appear here.",northArrow:"North arrow",includeNorthArrow:"Include north arrow",resultsNumber:"Results {number}"};var I=function(e,t,l,o){return new(l||(l=Promise))((function(i,n){function r(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}s((o=o.apply(e,t||[])).next())}))};const T=t=>I(void 0,void 0,void 0,(function*(){return W(t).then((t=>e.ServiceManager.getInstance().fetchArcGISServerInfo(t).then((e=>Promise.resolve(null==e?void 0:e.owningSystemUrl)),(e=>Promise.reject(e)))))})),j=(e,t,l)=>I(void 0,void 0,void 0,(function*(){return W(t).then((t=>G(t,l,e)))}));const O=(e,t,l)=>I(void 0,void 0,void 0,(function*(){const o=A(null==t?void 0:t.utilityId);return te(e).then((i=>{let n=l;return G(e,c.LayoutTemplate).then((r=>I(void 0,void 0,void 0,(function*(){let a;if(i.supportCustomReport||i.supportReport){const l=(yield G(e,c.ReportTemplate))||[],o=N(l);n=n.set("reportTemplateChoiceList",o).set("defaultReportTemplate",null==i?void 0:i.defaultReportTemplate).set("defaultCustomReportItem",null==i?void 0:i.defaultCustomReportItem),a=yield R(l,i,t)}const s=yield C(i,t),u={templateTaskInfo:r,templatesInTask:null==i?void 0:i.templates,reportOption:a,defaultLayoutOptionInfo:s,printTemplateType:null==l?void 0:l.printTemplateType,printServiceType:o},d=L(u),p=P(null==i?void 0:i.templates,d);return n=n.set("printCustomTemplate",d).set("useUtility",t).set("formatList",null==i?void 0:i.formatList).set("defaultFormat",null==i?void 0:i.defaultFormat).set("layoutChoiceList",p).set("supportCustomLayout",i.supportCustomLayout||!1).set("supportReport",i.supportReport||!1).set("supportCustomReport",i.supportCustomReport||!1).setIn(["commonSetting","forceFeatureAttributes"],i.supportReport||i.supportCustomReport||!1),Promise.resolve(n)}))))}))})),C=(e,t)=>I(void 0,void 0,void 0,(function*(){var l;const o={layoutTypes:f.ServiceLayout};if((null==e?void 0:e.supportCustomLayout)&&(null==e?void 0:e.defaultCustomLayoutItem)){const i=yield j(null===(l=null==e?void 0:e.defaultCustomLayoutItem)||void 0===l?void 0:l.id,t,c.ReportTemplate),n=null==i?void 0:i[0];o.customLayoutItem=null==e?void 0:e.defaultCustomLayoutItem,o.templateInfo=n}return Promise.resolve(o)})),R=(e,t,l)=>I(void 0,void 0,void 0,(function*(){var o,i,n,r,a;if(!(null==t?void 0:t.supportCustomReport)||!(null==t?void 0:t.supportReport))return null;const s={reportTypes:x.ServiceReport};if((null==t?void 0:t.supportReport)&&(null==t?void 0:t.defaultReportTemplate)){let l;null==e||e.forEach((e=>{(null==e?void 0:e.reportTemplate)===(null==t?void 0:t.defaultReportTemplate)&&(l=null==e?void 0:e.reportOptions)})),s.report=null==t?void 0:t.defaultReportTemplate,s.reportOptions=l}if((null==t?void 0:t.supportCustomReport)&&(null==t?void 0:t.defaultCustomReportItem)){const e=yield j(null===(o=null==t?void 0:t.defaultCustomReportItem)||void 0===o?void 0:o.id,l,c.ReportTemplate),u=null===(i=null==e?void 0:e[0])||void 0===i?void 0:i.reportOptions;s.customReportItem={id:null===(n=null==t?void 0:t.defaultCustomReportItem)||void 0===n?void 0:n.id,title:(null===(r=null==e?void 0:e[0])||void 0===r?void 0:r.reportTemplate)||(null===(a=null==t?void 0:t.defaultCustomReportItem)||void 0===a?void 0:a.id)},s.reportOptions=u,s.reportTypes=x.CustomReport}return Promise.resolve(s)})),N=e=>{if(!e)return[];return e.filter((e=>function(e){if(!e)return null;let t=g.RPTX;const l=(null==e?void 0:e.reportSectionOverrides)||{};return Object.keys(l).forEach((e=>{const o=l[e];((null==o?void 0:o.fieldElements)||(null==o?void 0:o.fieldLabelElements))&&(t=g.RPTT)})),t}(null==e?void 0:e.reportOptions)===g.RPTX))},M=(e,t)=>{var l,o;if(!t)return e;const i=null===(l=null==t?void 0:t.customTextElements)||void 0===l?void 0:l.map((e=>{const t={};for(const l in e)t[l]=!0;return t})),n=E(t);return e.hasAuthorText=null==t?void 0:t.hasAuthorText,e.hasCopyrightText=null==t?void 0:t.hasCopyrightText,e.hasLegend=null==t?void 0:t.hasLegend,e.hasTitleText=null==t?void 0:t.hasTitleText,e.layoutOptions.customTextElements=(null==t?void 0:t.customTextElements)||[],e.layoutOptions.elementOverrides=n,e.customTextElementEnableList=i||[],e.enableNorthArrow=!!q(n),e.enableLegend=e.hasLegend,e.enableAuthor=e.hasAuthorText,e.enableCopyright=e.hasCopyrightText,e.enableScalebarUnit=!0,e.hasLegend&&(null==e?void 0:e.layoutOptions)&&(e.layoutOptions.legendLayers=[]),(null===(o=e.layoutOptions)||void 0===o?void 0:o.scalebarUnit)||(e.layoutOptions.scalebarUnit="Miles"),e},L=e=>{const{templateTaskInfo:t,templatesInTask:l,reportOption:o,defaultLayoutOptionInfo:i,printServiceType:n,printTemplateType:r}=e,a=l?Y(l,n,r):[];return null==a?void 0:a.map((e=>{var l;let n;if(t&&0!==(null==t?void 0:t.length)?t.forEach((t=>{e.label===t.layoutTemplate&&(n=t)})):n=u,(null==e?void 0:e.layout)&&(e.layout=z(null==e?void 0:e.layout)),(null==e?void 0:e.format)&&(e.format=null===(l=null==e?void 0:e.format)||void 0===l?void 0:l.toLowerCase()),(null==n?void 0:n.webMapFrameSize)&&(e.mapFrameSize=null==n?void 0:n.webMapFrameSize,e.mapFrameUnit=null==n?void 0:n.pageUnits),(e=M(e,null==n?void 0:n.layoutOptions)).mapFrameUnit=null==n?void 0:n.pageUnits,e.selectedFormatList=[null==e?void 0:e.format],o&&((null==o?void 0:o.customReportItem)&&(e.customReportItem=null==o?void 0:o.customReportItem),(null==o?void 0:o.report)&&(e.report=null==o?void 0:o.report),(null==o?void 0:o.reportOptions)&&(e.reportOptions=null==o?void 0:o.reportOptions),(null==o?void 0:o.reportTypes)&&(e.reportTypes=null==o?void 0:o.reportTypes)),i){(null==i?void 0:i.layoutTypes)&&(e.layoutTypes=null==i?void 0:i.layoutTypes),(null==i?void 0:i.customLayoutItem)&&(e.customLayoutItem=null==i?void 0:i.customLayoutItem);const t=null==i?void 0:i.templateInfo;t&&((null==t?void 0:t.layoutOptions)&&(e.layoutOptions=null==t?void 0:t.layoutOptions),(null==t?void 0:t.pageUnits)&&(e.mapFrameUnit=null==t?void 0:t.pageUnits),(null==t?void 0:t.webMapFrameSize)&&(e.mapFrameSize=null==t?void 0:t.webMapFrameSize))}return e}))},E=e=>{const t=(null==e?void 0:e.mapSurroundInfos)||[],l={};return null==t||t.forEach((e=>{e.type===`${o}`&&(e.visible=!0),l[e.name]=e})),l},P=(e,t)=>(null==e?void 0:e.map((e=>{e.layoutTemplate=z(null==e?void 0:e.layout);const l=F(null==e?void 0:e.layout);return null==t||t.forEach((t=>{(null==e?void 0:e.layout)===(null==t?void 0:t.layout)&&(e.mapFrameSize=null==t?void 0:t.mapFrameSize,e.mapFrameUnit=null==t?void 0:t.mapFrameUnit,e.hasAuthorText=null==t?void 0:t.hasAuthorText,e.hasCopyrightText=null==t?void 0:t.hasCopyrightText,e.hasLegend=null==t?void 0:t.hasLegend,e.hasTitleText=null==t?void 0:t.hasTitleText,!l&&(e.layoutOptions=null==t?void 0:t.layoutOptions),e.customTextElementEnableList=null==t?void 0:t.customTextElementEnableList,e.enableNorthArrow=t.enableNorthArrow,e.enableLegend=t.hasLegend,e.enableAuthor=t.hasAuthorText,e.enableCopyright=t.hasCopyrightText,e.enableScalebarUnit=!0,e.enableNorthArrow=null==t?void 0:t.enableNorthArrow)})),e})))||[],A=t=>{const l=e.UtilityManager.getInstance().getUtilityJson(t);return"org"===(null==l?void 0:l.source)?v.OrganizationService:v.Customize};var k,U=function(e,t,l,o){return new(l||(l=Promise))((function(i,n){function r(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}s((o=o.apply(e,t||[])).next())}))};!function(e){e.AsynchronousSubmit="esriExecutionTypeAsynchronous",e.SynchronousExecute="esriExecutionTypeSynchronous"}(k||(k={}));const D=(t,l)=>{let o=l;return(null==t?void 0:t.exportOptions)&&(o=o.set("exportOptions",Object.assign(Object.assign({},t.exportOptions||{}),(null==l?void 0:l.exportOptions)||{}))),(null==t?void 0:t.layoutOptions)&&(null==l?void 0:l.layoutOptions)&&(o=o.set("layoutOptions",Object.assign(Object.assign({},(null==t?void 0:t.layoutOptions)||{}),(null==l?void 0:l.layoutOptions)||{}))),(0,e.Immutable)(Object.assign(Object.assign({},t),o))},V=(e,t)=>{let l;return null==e||e.forEach(((e,o)=>{(null==e?void 0:e.templateId)===t&&(l=o)})),l},z=e=>e,F=e=>"map-only"===(e=>{var t,l;return null===(l=null===(t=null==e?void 0:e.replace(/\_/gi,"-"))||void 0===t?void 0:t.replace(/\s+/gi,"-"))||void 0===l?void 0:l.toLowerCase()})(e),$=(e,t)=>{let l=!1;return null==e||e.forEach((e=>{(null==e?void 0:e.templateId)===t&&(l=!0)})),l},W=t=>U(void 0,void 0,void 0,(function*(){return e.UtilityManager.getInstance().getUrlOfUseUtility(t).then((e=>Promise.resolve(e)))}));function G(t,l,o){return U(this,void 0,void 0,(function*(){const i={query:{"env:outSR":"","env:processSR":"",returnZ:!1,returnM:!1,returnTrueCurves:!1,returnFeatureCollection:!1,context:"",f:"json"},responseType:"json"},n=yield(r=t,I(void 0,void 0,void 0,(function*(){return e.ServiceManager.getInstance().fetchArcGISServerInfo(r).then((e=>Promise.resolve(null==e?void 0:e.owningSystemUrl)),(e=>Promise.reject(e)))})));var r;const a=n?e.SessionManager.getInstance().getSessionByUrl(n):null;if(o){const e={id:o};a&&(e.token=a.token),l===c.LayoutTemplate&&(a&&(i.query.token=a.token),i.query.Layout_Item_ID=JSON.stringify(e)),l===c.ReportTemplate&&(i.query.Report_Item_ID=JSON.stringify(e))}return function(t){return U(this,void 0,void 0,(function*(){var l;if(!t)return Promise.resolve(null);const o=`${null===(l=t.split("/GPServer"))||void 0===l?void 0:l[0]}/GPServer`,i=function(){var t,l;const o=(null===(t=(0,e.getAppStore)().getState().portalSelf)||void 0===t?void 0:t.helperServices)||{};return(null===(l=null==o?void 0:o.asyncPrintTask)||void 0===l?void 0:l.url)||null}(),n=(yield _(o))||{},{tasks:r,supportedOperations:a,executionType:s}=n;let u=s,d=null,c=null,p=null,v=null;if(null==r||r.forEach((e=>{((null==e?void 0:e.includes("Layout"))||(null==e?void 0:e.includes("Layout")))&&(d=`${o}/${e}`,c=`${d}/${a}`),((null==e?void 0:e.includes("Report"))||(null==e?void 0:e.includes("report")))&&(p=`${o}/${e}`,v=`${o}/${e}/${a}`)})),i===t){const e=yield function(e){return U(this,void 0,void 0,(function*(){const t=`${null==e?void 0:e.split("/arcgis/")[0]}/arcgis/rest/services/Utilities/PrintingTools/GPServer`,l=(yield _(t))||{},{tasks:o,supportedOperations:i,executionType:n}=l;let r=null,a=null,s=null;return null==o||o.forEach((e=>{((null==e?void 0:e.includes("Layout"))||(null==e?void 0:e.includes("Layout")))&&(s=e)})),r=`${t}/${s}`,a=`${r}/${i}`,{layoutTemplatesInfoTaskUrl:r,layoutTemplatesInfoRequestUrl:a,executionType:n}}))}(o);d=e.layoutTemplatesInfoTaskUrl,c=e.layoutTemplatesInfoRequestUrl,u=e.executionType}return Promise.resolve({url:o,layoutTemplatesInfoTaskUrl:d,layoutTemplatesInfoRequestUrl:c,reportTemplatesInfoTaskUrl:p,reportTemplatesInfoRequestUrl:v,executionType:s,layoutTemplateTaskExecutionType:u})}))}(t).then((t=>{const{layoutTemplatesInfoRequestUrl:o,reportTemplatesInfoRequestUrl:n,reportTemplatesInfoTaskUrl:r,executionType:a,layoutTemplatesInfoTaskUrl:s,layoutTemplateTaskExecutionType:u}=t,d=l===c.ReportTemplate?n:o,p=l===c.LayoutTemplate?u:a;return d?(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[t]=e;return t(d,i).then((e=>U(this,void 0,void 0,(function*(){var o,n,a;if(p===k.AsynchronousSubmit){const n=null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.jobId;return function(e,t,l,o){return U(this,void 0,void 0,(function*(){const i=`${e}/jobs/${t}/results/Output_JSON`;return new Promise(((e,t)=>{let n=0;const r=10,a=3e3,s=()=>{o(i,l).then((t=>{var l;(null===(l=null==t?void 0:t.data)||void 0===l?void 0:l.value)?e(t.data.value):(n++,n<r?setTimeout(s,a):e([]))})).catch((e=>{t(e)}))};s()}))}))}(l===c.ReportTemplate?r:s,n,i,t)}return Promise.resolve((null===(a=null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.results[0])||void 0===a?void 0:a.value)||[])}))),(e=>Promise.reject(e))).catch((e=>Promise.reject(e)))})):Promise.resolve(null)}))}))}function _(t){return U(this,void 0,void 0,(function*(){var l;if(!t)return Promise.resolve(null);const o=`${null===(l=t.split("/GPServer"))||void 0===l?void 0:l[0]}/GPServer`,i={query:{f:"json"},responseType:"json"};return(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[t]=e;return t(o,i).then((e=>{var t,l;const o=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.tasks,i=null===(l=null==e?void 0:e.data)||void 0===l?void 0:l.executionType,n=i===k.SynchronousExecute?"execute":"submitJob";return Promise.resolve({tasks:o,supportedOperations:n,executionType:i})}))}))}))}function B(t){return U(this,void 0,void 0,(function*(){return(0,e.loadArcGISJSAPIModules)(["esri/rest/support/LegendLayer"]).then((e=>{var l,o,i;const[n]=e,r=J((null===(i=null===(o=null===(l=null==t?void 0:t.view)||void 0===l?void 0:l.map)||void 0===o?void 0:o.layers)||void 0===i?void 0:i.toArray())||[],n);return Promise.resolve(r)}))}))}function J(e,t){if(!e)return[];let l=[];return null==e||e.forEach((e=>{var o,i,n;const r=(null==e?void 0:e.effect)&&(null==e?void 0:e.effect.length)>0,a="binning"===(null===(o=null==e?void 0:e.featureReduction)||void 0===o?void 0:o.type),s="pie-chart"===(null===(i=null==e?void 0:e.renderer)||void 0===i?void 0:i.type);if("graphics"!==e.type&&e.visible&&(null==e?void 0:e.legendEnabled)&&!r&&!a&&!s){const o=(null==e?void 0:e.subLayerIds)||null;if("group"===(null==e?void 0:e.type)){const o=J((null===(n=null==e?void 0:e.layers)||void 0===n?void 0:n._items)||[],t)||[];l=l.concat(o)}const i=new t({layerId:null==e?void 0:e.id,title:null==e?void 0:e.title,subLayerIds:o});l.push(i)}})),l}function q(e={}){var t;let l=null;for(const i in e)(null===(t=null==e?void 0:e[i])||void 0===t?void 0:t.type)===o&&(l=i);return l}function H(e){const{reportOptions:t,defaultCustomReportItem:l,defaultReportTemplate:o,supportCustomReport:i,supportReport:n,reportTypes:r}=e;if(!i&&!n)return!0;switch(r){case x.CustomReport:return t?Q(t):!l&&!o;case x.ServiceReport:return t?Q(t):!o}}function Q(e){if(!(null==e?void 0:e.reportSectionOverrides))return!1;const t=(null==e?void 0:e.reportSectionOverrides)||{};let l=!0;return Object.keys(t).forEach(((e,o)=>{var i,n;const r=t[e];if((null==r?void 0:r.exbDatasource)&&0!==(null===(i=null==r?void 0:r.exbDatasource)||void 0===i?void 0:i.length)){const e=X()||[],t=null===(n=null==r?void 0:r.exbDatasource)||void 0===n?void 0:n[0],o=(null==t?void 0:t.rootDataSourceId)||(null==t?void 0:t.mainDataSourceId);(null==e?void 0:e.includes(o))||(l=!1)}else l=!1})),l}const X=()=>{var t;const l=(0,e.getAppStore)().getState(),o=(null==l?void 0:l.appStateInBuilder)?null===(t=null==l?void 0:l.appStateInBuilder)||void 0===t?void 0:t.appConfig:null==l?void 0:l.appConfig,i=null==o?void 0:o.dataSources,n=[];return Object.keys(i).forEach((t=>{const l=i[t];(null==l?void 0:l.type)!==e.ArcGISDataSourceTypes.WebScene&&n.push(l.id)})),n.length>0?(0,e.Immutable)(n):void 0},Z=(e,t)=>{var l,o;if((null==e?void 0:e.exbDatasource)&&0!==(null===(l=null==e?void 0:e.exbDatasource)||void 0===l?void 0:l.length)&&t){let l=!0;const i=K(null==t?void 0:t[0])||[],n=null===(o=null==e?void 0:e.exbDatasource)||void 0===o?void 0:o[0],r=(null==n?void 0:n.rootDataSourceId)||(null==n?void 0:n.mainDataSourceId);return(null==i?void 0:i.includes(r))||(l=!1),l}return!0},K=t=>{var l,o,i;const n=(0,e.getAppStore)().getState(),r=(null==n?void 0:n.appStateInBuilder)?null===(l=null==n?void 0:n.appStateInBuilder)||void 0===l?void 0:l.appConfig:null==n?void 0:n.appConfig,a=null===(o=null==r?void 0:r.widgets)||void 0===o?void 0:o[t],s=[],u=e.DataSourceManager.getInstance();return null===(i=null==a?void 0:a.useDataSources)||void 0===i||i.forEach((t=>{const l=u.getDataSource(t.dataSourceId);(null==l?void 0:l.type)===e.ArcGISDataSourceTypes.WebMap&&s.push(t.dataSourceId)})),s.length>0?(0,e.Immutable)(s):void 0},Y=(t,l,o)=>{const i=t.map((t=>{var l;let o=(0,e.Immutable)(t);return o=o.set("layout",z(null==t?void 0:t.layout)),o=o.setIn(["layoutOptions","scalebarUnit"],"Miles").setIn(["layoutOptions","legendLayers"],null),o=o.set("reportTypes",x.ServiceReport).set("layoutTypes",f.ServiceLayout),F(null==o?void 0:o.layout)&&(o=o.set("exportOptions",Object.assign({width:800,height:1100},null==t?void 0:t.exportOptions))),null===(l=D((0,e.Immutable)(d),(0,e.Immutable)(o)))||void 0===l?void 0:l.asMutable({deep:!0})}));return ee(i,l,o)},ee=(e,t,l)=>{const o=((e,t)=>e===v.Customize||t===m.Customize?"custom":"org")(t,l);return e.map(((e,t)=>(e.templateId=`config_${o}_${t}`,e)))};function te(t){const l={query:{f:"json"},responseType:"json"};return(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[o]=e;return o(t,l).then((e=>function(e){return U(this,void 0,void 0,(function*(){let t=!1,l=!1;const o=(null==e?void 0:e.parameters)||[],i="web_map_as_json",n="output_file",r="layout_item_id",a="layout_template",s="report_template",u="report_item_id";let d=[],c=[],p="pdf",v=!1,m=!1,y=!1,h="",f="",g="",x="";return null==o||o.forEach((e=>{var t,l;if("Format"===e.name){const o=(null===(t=null==e?void 0:e.choiceList)||void 0===t?void 0:t.map((e=>null==e?void 0:e.toLowerCase())))||[];if(e.defaultValue)p=null===(l=e.defaultValue)||void 0===l?void 0:l.toLowerCase();else if((null==o?void 0:o.length)>0){const e=[];null==o||o.forEach((t=>{(t.include("pdf")||t.include("png"))&&e.push(t)})),p=(null==e?void 0:e[0])||o[0]}c=o}})),null==o||o.forEach((e=>{if("Layout_Template"===e.name){const t=e.choiceList,l=e.defaultValue;t?d=null==t?void 0:t.map((e=>oe(e,c,p))):d.push(oe(l,c,p))}e.name.toLowerCase()===a&&(h=(null==e?void 0:e.defaultValue)||""),e.name.toLowerCase()===r&&(v=!0,f=null==e?void 0:e.defaultValue),e.name.toLowerCase()===s&&(y=!0,g=(null==e?void 0:e.defaultValue)||""),e.name.toLowerCase()===u&&(m=!0,x=null==e?void 0:e.defaultValue),"string"==typeof e.name&&e.name.toLowerCase()===i&&(t=!0),"string"==typeof e.name&&e.name.toLowerCase()===n&&(l=!0)})),Promise.resolve({templates:d,formatList:c,defaultFormat:p,defaultReportTemplate:g,defaultCustomReportItem:x,hasWebmapParam:t,hasOutputParam:l,supportCustomLayout:v,supportReport:y,supportCustomReport:m,defaultLayout:h,defaultCustomLayoutItem:f})}))}(null==e?void 0:e.data)))}))}function le(t,l,o){var i,n,r,a;const s=e.UtilityManager.getInstance().utilityHasSignInError(t);let u=404===(null===(i=null==o?void 0:o.details)||void 0===i?void 0:i.httpStatus);400===(null===(n=null==o?void 0:o.details)||void 0===n?void 0:n.httpStatus)&&(null===(a=null===(r=null==o?void 0:o.details)||void 0===r?void 0:r.message)||void 0===a?void 0:a.includes("Item does not exist"))&&(u=!0),s||u?(l&&l(!0),e.UtilityManager.getInstance().reportUtilityState(t,!1,s)):(l&&l(!1),e.UtilityManager.getInstance().reportUtilityState(t,!0))}function oe(e,t,l){const o=F(e)?{}:{layoutOptions:{legend:!1}},i=l||t[0]||"PNG32";return Object.assign({label:e,layout:e,format:i},o)}var ie=r(30655),ne=r.n(ie),re=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(l[o[i]]=e[o[i]])}return l};const ae=t=>{const l=window.SVG,{className:o}=t,i=re(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:n,src:ne()},i)):e.React.createElement("svg",Object.assign({className:n},i))};var se=r(94064),ue=r.n(se),de=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(l[o[i]]=e[o[i]])}return l};const ce=t=>{const l=window.SVG,{className:o}=t,i=de(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:n,src:ue()},i)):e.React.createElement("svg",Object.assign({className:n},i))};var pe=r(29435),ve=r.n(pe),me=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(l[o[i]]=e[o[i]])}return l};const ye=t=>{const l=window.SVG,{className:o}=t,i=me(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:n,src:ve()},i)):e.React.createElement("svg",Object.assign({className:n},i))},he=t=>{const{label:l,className:o,children:i,flowWrap:n}=t,r=e.css`
    .title {
      font-size: 14px;
    }
  `;return(0,e.jsx)("div",{className:(0,e.classNames)("mb-2 align-items-center",{className:o,"d-flex":!n}),css:r},(0,e.jsx)("div",{className:(0,e.classNames)("title flex-grow-1",{"mb-2":n})},l),i)};var fe=function(e,t,l,o){return new(l||(l=Promise))((function(i,n){function r(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}s((o=o.apply(e,t||[])).next())}))};const ge=(e,t)=>{let l=1,o=e;return t.forEach((i=>{o===(null==i?void 0:i.title)&&(o=`${e} (${l})`,l++,ge(o,t))})),o},xe=e=>{const t=(e=>{var t;return e?null===(t=null==e?void 0:e.asMutable())||void 0===t?void 0:t.map((e=>e.resultId)):[]})(e);if(!t||0===(null==t?void 0:t.length))return"result_0";return`config_${be(t)+1}`},be=e=>{var t;if(!e||0===(null==e?void 0:e.length))return 0;const l=null==e?void 0:e.map((e=>{var t;const l=null===(t=null==e?void 0:e.split("_"))||void 0===t?void 0:t.pop();return l?Number(l):0}));return null===(t=null==l?void 0:l.sort(((e,t)=>t-e)))||void 0===t?void 0:t[0]};function we(e,t){return"print-extents-layer-"+e+"-"+t}function Se(e,t){return`print-report-layer-${t}-${e}`}function Ie(e){return fe(this,void 0,void 0,(function*(){if(e)return(0,l.loadArcGISJSAPIModules)(["esri/kernel"]).then((([t])=>W(e).then((e=>{const l=t.id.findCredential(e);return Promise.resolve(null==l?void 0:l.token)}))))}))}function Te(e,t,l,o){if(!(e&&t&&o&&l))return;const i=(null==t?void 0:t.reportSectionOverrides)||{};Object.keys(i).forEach((t=>fe(this,void 0,void 0,(function*(){var n,r,a;const s=i[t];if((null===(n=null==s?void 0:s.exbDatasource)||void 0===n?void 0:n.length)>0){const t=Z(s,o),i=null===(a=null===(r=null==s?void 0:s.exbDatasource)||void 0===r?void 0:r[0])||void 0===a?void 0:a.dataSourceId;if(!t&&e){const t=Se(i,l);e.view.map.findLayerById(t)&&e.removeLayerFromMap(t)}}}))))}function je(t,o,i,n){return fe(this,void 0,void 0,(function*(){const r=(null==t?void 0:t.reportSectionOverrides)||{};return yield Promise.all(Object.keys(r).map((t=>fe(this,void 0,void 0,(function*(){var a,s,u,d;const c=r[t];if((null===(a=null==c?void 0:c.exbDatasource)||void 0===a?void 0:a.length)>0){const a=Z(c,i),p=null===(u=null===(s=null==c?void 0:c.exbDatasource)||void 0===s?void 0:s[0])||void 0===u?void 0:u.dataSourceId;if(a){const l=(null===(d=e.DataSourceManager.getInstance().getDataSource(p).layer)||void 0===d?void 0:d.id)||"";r[t].sourceId=l}else{const i=Se(p,n);o&&(yield function(t,o,i){return fe(this,void 0,void 0,(function*(){const n=Se(o,i);if(t){const i=t.view.map.findLayerById(n),r=function(t){var l,o;return null===(o=null===(l=e.DataSourceManager.getInstance().getDataSource(t))||void 0===l?void 0:l.getDataSourceJson())||void 0===o?void 0:o.isOutputFromWidget}(o);if(!function(t){var l;const o=null===(l=e.DataSourceManager.getInstance().getDataSource(t))||void 0===l?void 0:l.getStatus();return o!==e.DataSourceStatus.NotCreated&&o!==e.DataSourceStatus.CreateError&&o!==e.DataSourceStatus.LoadError&&o!==e.DataSourceStatus.SaveError&&o!==e.DataSourceStatus.NotReady}(o))return;let a;a=i&&r?t.getJimuLayerViewByAPILayer(i):yield t.addLayerToMap(o,n),a&&(yield t.whenJimuLayerViewLoaded(a.id),a.layer.opacity=0,yield function(e,t){return fe(this,void 0,void 0,(function*(){var o,i,n,r;if(!(null===(i=null===(o=e.layer)||void 0===o?void 0:o.customParameters)||void 0===i?void 0:i.moveFeaturesToCenterWhenPrinting))return;const a=yield null===(n=null==e?void 0:e.layer)||void 0===n?void 0:n.queryFeatures({returnGeometry:!0}),s=(null==a?void 0:a.features)||[];if(0===s.length)return;const u=null===(r=t.view.extent)||void 0===r?void 0:r.center,d=null==e?void 0:e.layer;if("point"===d.geometryType){const[e]=yield(0,l.loadArcGISJSAPIModules)(["esri/Graphic"]),o={type:"point",x:u.x,y:u.y,spatialReference:t.view.spatialReference},i=s.map((t=>new e({attributes:(null==t?void 0:t.attributes)||{},geometry:o})));yield d.applyEdits({updateFeatures:i})}else if("polyline"===d.geometryType){const[e,o]=yield(0,l.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Polyline"]),i=new o({hasZ:!1,hasM:!1,paths:[[[t.view.extent.center.x,t.view.extent.center.y],[t.view.extent.center.x+5,t.view.extent.center.y+5]]],spatialReference:t.view.spatialReference}),n=s.map((t=>new e({attributes:(null==t?void 0:t.attributes)||{},geometry:i})));yield d.applyEdits({updateFeatures:n})}else if("polygon"===d.geometryType){const[e,o]=yield(0,l.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Polygon"]),i=new o({hasZ:!1,hasM:!1,rings:[[[t.view.extent.xmin,t.view.extent.ymin],[t.view.extent.xmin,t.view.extent.ymax],[t.view.extent.xmax,t.view.extent.ymax],[t.view.extent.xmin,t.view.extent.ymin]]],spatialReference:t.view.spatialReference}),n=s.map((t=>new e({attributes:(null==t?void 0:t.attributes)||{},geometry:i})));yield d.applyEdits({updateFeatures:n})}}))}(a,t),yield a.whenCurrentLayerViewNotUpdating(),yield function(e,t){return fe(this,void 0,void 0,(function*(){var o,i,n;if(!(null===(o=null==e?void 0:e.view)||void 0===o?void 0:o.queryFeatureCount)||!(null==e?void 0:e.whenCurrentLayerViewNotUpdating))return!1;yield e.whenCurrentLayerViewNotUpdating();const r=null===(i=null==t?void 0:t.view)||void 0===i?void 0:i.extent,a=null==e?void 0:e.layer,s=yield null===(n=null==e?void 0:e.layer)||void 0===n?void 0:n.queryFeatureCount({geometry:r});if(0===s&&"point"===a.geometryType){const e={type:"point",x:t.view.extent.center.x,y:t.view.extent.center.y,spatialReference:t.view.spatialReference},o={},i=new Date;o[a.objectIdField]=i.getTime(),yield(0,l.loadArcGISJSAPIModules)(["esri/Graphic"]).then((([t])=>{const l=new t({geometry:e,attributes:o});return a.applyEdits({addFeatures:[l]}).then((()=>Promise.resolve(!0)))}))}else if(0===s&&"polyline"===a.geometryType){const e={},o=new Date;e[a.objectIdField]=o.getTime(),yield(0,l.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Polyline"]).then((([l,o])=>{const i=new l({geometry:new o({hasZ:!1,hasM:!1,paths:[[[t.view.extent.center.x,t.view.extent.center.y],[t.view.extent.center.x+5,t.view.extent.center.y+5]]],spatialReference:t.view.spatialReference}),attributes:e});return a.applyEdits({addFeatures:[i]}).then((()=>Promise.resolve(!0)))}))}else{if(0!==s||"polygon"!==a.geometryType)return Promise.resolve(!0);{const e={},o=new Date;e[a.objectIdField]=o.getTime(),yield(0,l.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Polygon"]).then((([l,o])=>{const i=new l({geometry:new o({hasZ:!1,hasM:!1,rings:[[[t.view.extent.xmin,t.view.extent.ymin],[t.view.extent.xmin,t.view.extent.ymax],[t.view.extent.xmax,t.view.extent.ymax],[t.view.extent.xmin,t.view.extent.ymin]]],spatialReference:t.view.spatialReference}),attributes:e});return a.applyEdits({addFeatures:[i]}).then((()=>Promise.resolve(!0)))}))}}}))}(a,t),yield a.whenCurrentLayerViewNotUpdating())}}))}(o,p,n),r[t].sourceId=i)}delete r[t].exbDatasource}}))))),t&&(t.reportSectionOverrides=r),Promise.resolve(t||{})}))}function Oe(e){return fe(this,void 0,void 0,(function*(){var t,o,i,r;const{printTemplateProperties:a,mapView:s,locale:u,utility:d,isSupportReport:c,useMapWidgetIds:p,widgetId:v}=e;try{const e=!1===(null==a?void 0:a.hasTitleText),m=!1===(null==a?void 0:a.hasLegend);let y=a.without("enableTitle","enableAuthor","enableOutputSpatialReference","enableMapPrintExtents","enableQuality","enableMapSize","enableFeatureAttribution","enableCopyright","enableLegend","enableMapAttribution","enableCustomTextElements","hasAuthorText","hasCopyrightText","hasLegend","hasTitleText","selectedFormatList","mapFrameSize","mapFrameUnit","legendEnabled","templateId","printExtentType","customTextElementEnableList");switch(null==a?void 0:a.printExtentType){case n.CurrentMapExtent:y=y.set("scalePreserved",!1);break;case n.CurrentMapScale:y=y.set("outScale",null===(t=null==s?void 0:s.view)||void 0===t?void 0:t.scale).set("scalePreserved",!0);break;case n.SetMapScale:y=y.set("scalePreserved",!0)}let h=null==y?void 0:y.asMutable({deep:!0});if(e&&(null===(o=null==h?void 0:h.layoutOptions)||void 0===o||delete o.titleText),m&&(null===(i=null==h?void 0:h.layoutOptions)||void 0===i||delete i.legendLayers),(null===(r=null==a?void 0:a.layoutOptions)||void 0===r?void 0:r.legendLayers)?h.layoutOptions.legendLayers=yield B(s):h.layoutOptions.legendLayers=[],a.layoutTypes!==f.CustomLayout&&a.reportTypes!==x.CustomReport||(h=yield function(e,t){return fe(this,void 0,void 0,(function*(){const o=e;return(0,l.loadArcGISJSAPIModules)(["esri/portal/PortalItem"]).then((l=>{const[i]=l;return T(t).then((t=>{var l,n;if(e.layoutTypes===f.CustomLayout&&(null===(l=e.customLayoutItem)||void 0===l?void 0:l.id)){const l=new i({id:e.customLayoutItem.id,portal:t});o.layoutItem=l}if(e.reportTypes===x.CustomReport&&(null===(n=e.customReportItem)||void 0===n?void 0:n.id)){const l=new i({id:e.customReportItem.id,portal:t});o.reportItem=l}return delete o.customLayoutItem,delete o.customReportItem,delete o.layoutTypes,delete o.reportTypes,Promise.resolve(o)}))}),(e=>Promise.resolve(o))).catch((e=>Promise.resolve(o)))}))}(h,d)),c){const e=yield je(null==h?void 0:h.reportOptions,s,p,v);h.reportOptions=e}return h=function(e,t){var l;const o=(null===(l=e.layoutOptions)||void 0===l?void 0:l.customTextElements)||[];let i=!1;o.forEach((e=>{e.date&&(i=!0)})),i||o.push({Date:(new Date).toLocaleString(t)});return e.layoutOptions.customTextElements=o,e}(h,u),Promise.resolve(h)}catch(e){return console.error(e),c&&Te(s,null==a?void 0:a.reportOptions,v,p),Promise.resolve(null)}}))}function Ce(e,t,l){const o=Re(l);return e/(t?o.XDPI:o.YDPI)*2.54/100}function Re(e){return e?{XDPI:e,YDPI:e}:function(){const e={XDPI:null,YDPI:null},t=window.screen;if(null==t?void 0:t.XDPI)e.XDPI=null==t?void 0:t.deviceXDPI,e.YDPI=null==t?void 0:t.deviceYDPI;else{const t=document.createElement("div");t.style.cssText="width:1in;height:1in;position:absolute;left:0px;top:0px;z-index:99;visibility:hidden",document.body.appendChild(t),e.XDPI=t.offsetWidth,e.YDPI=t.offsetHeight,t.parentNode.removeChild(t)}return e}()}var Ne=r(1888);const{useState:Me,useEffect:Le,useRef:Ee}=e.React,Pe=l=>{var o,r,a,u;const{jimuMapView:d,id:c,selectedTemplate:p,className:v,config:m}=l,y=e.hooks.useTranslation(S,t.defaultMessages),h=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.widgetsRuntimeInfo)||void 0===t?void 0:t[c]})),f=Ee(null),g=Ee(null),x=Ee(null),b=Ee(null===(o=null==d?void 0:d.view)||void 0===o?void 0:o.extent),w=Ee(null===(r=null==d?void 0:d.view)||void 0===r?void 0:r.scale),I=e.css`
    .checkbox-con {
      color: var(--ref-palette-neutral-1100);
      font-size: ${e.polished.rem(14)};
      line-height: ${e.polished.rem(22)};
      margin: ${e.polished.rem(4)} 0 ${e.polished.rem(8)} 0;
    }
  `,[T,j]=Me(!1),[O,C]=Me(null===(a=null==d?void 0:d.view)||void 0===a?void 0:a.extent),[R,N]=Me(null===(u=null==d?void 0:d.view)||void 0===u?void 0:u.scale);Le((()=>{(null==h?void 0:h.controllerWidgetId)&&T&&((null==h?void 0:h.state)!==e.WidgetState.Opened?W():E())}),[h]),Le((()=>(x.current=e.lodash.debounce(E,400),(0,e.loadArcGISJSAPIModules)(["esri/layers/GraphicsLayer","esri/Graphic","esri/geometry/Polygon","esri/geometry/Extent","esri/geometry/Point","esri/geometry/support/WKIDUnitConversion"]).then((e=>{f.current=e})),W)),[]),Le((()=>{var e,t,l,o,i,n;const r=(null==p?void 0:p.templateId)!==(null===(e=g.current)||void 0===e?void 0:e.templateId),a=(null==p?void 0:p.printExtentType)!==(null===(t=g.current)||void 0===t?void 0:t.printExtentType),s=(null==p?void 0:p.outScale)!==(null===(l=g.current)||void 0===l?void 0:l.outScale),u=(null===(o=null==p?void 0:p.exportOptions)||void 0===o?void 0:o.dpi)!==(null===(n=null===(i=g.current)||void 0===i?void 0:i.exportOptions)||void 0===n?void 0:n.dpi),d=M();g.current=p,T&&(r||a||s||d||u)&&x.current()}),[p]),Le((()=>{T&&O&&x.current()}),[O,R,m.previewBackgroundColor,m.previewOutLine]),Le((()=>{var t,l;d?(L(),C((0,e.Immutable)(JSON.parse(JSON.stringify(null===(l=null===(t=null==d?void 0:d.view)||void 0===t?void 0:t.extent)||void 0===l?void 0:l.toJSON()))))):C(null)}),[d]);const M=()=>{var e,t,l,o,i,n;if(!F(null==p?void 0:p.layout))return!1;const r=(null===(e=null==p?void 0:p.exportOptions)||void 0===e?void 0:e.width)!==(null===(l=null===(t=g.current)||void 0===t?void 0:t.exportOptions)||void 0===l?void 0:l.width),a=(null===(o=null==p?void 0:p.exportOptions)||void 0===o?void 0:o.height)!==(null===(n=null===(i=g.current)||void 0===i?void 0:i.exportOptions)||void 0===n?void 0:n.height);return r||a},L=()=>{var t,l;null===(t=null==d?void 0:d.view)||void 0===t||t.watch("extent",(t=>{const l=JSON.parse(JSON.stringify(t.toJSON()));C((0,e.Immutable)(l)),b.current=t})),null===(l=null==d?void 0:d.view)||void 0===l||l.watch("scale",(e=>{N(e),w.current=e}))},E=e.hooks.useEventCallback((()=>{var e;const t=$(),l=f.current[1],o=(null==m?void 0:m.previewOutLine)||i,r=(null==m?void 0:m.previewBackgroundColor)||"rgba(0,216,237,0.3)",a=new l({geometry:(null===(e=g.current)||void 0===e?void 0:e.printExtentType)===n.CurrentMapExtent?k():A(),symbol:{type:"simple-fill",color:P(r),outline:{color:P(o.color,1),width:o.size}}});t.graphics.removeAll(),t.graphics.add(a)})),P=(t,l=.3)=>{if(!t)return null;let o;if(t.includes("var(")||t.includes("#")){const i=(0,Ne.getThemeColorValue)(t,(0,Ne.getAppThemeVariables)());o=e.polished.rgba(i,l)}if(t.includes("rgba")){const i=t.split("(")[1].split(")")[0].split(","),n=i[i.length-1];o=Number(n)>.6?e.polished.rgba(t,l):t}return o},A=()=>{var e,t,l,o,i;const{mapFrameSize:r,mapFrameUnit:a,layout:s}=null===(e=g.current)||void 0===e?void 0:e.asMutable({deep:!0}),u=z(),d=V(a),c=f.current[2],p=F(s),v=null===(t=null==b?void 0:b.current)||void 0===t?void 0:t.center,m=(null===(l=g.current)||void 0===l?void 0:l.printExtentType)===n.SetMapScale?null===(o=g.current)||void 0===o?void 0:o.outScale:w.current,y=p?D():{width:r[0],height:r[1]},h={x:p?1:d.x/(null==u?void 0:u.x),y:p?1:d.y/(null==u?void 0:u.y)},x={x:y.width,y:y.height},S=(null==v?void 0:v.x)-(null==x?void 0:x.x)/2*m*(null==h?void 0:h.x),I=(null==v?void 0:v.y)-(null==x?void 0:x.y)/2*m*(null==h?void 0:h.y),T=(null==v?void 0:v.x)+(null==x?void 0:x.x)/2*m*(null==h?void 0:h.x),j=(null==v?void 0:v.y)+(null==x?void 0:x.y)/2*m*(null==h?void 0:h.y),O=[[S,I],[S,j],[T,j],[T,I],[S,I]],C=new c({spatialReference:null===(i=null==b?void 0:b.current)||void 0===i?void 0:i.spatialReference});return C.addRing(O),C},k=()=>{var t,l,o,i,n,r;const a=f.current[3],{mapFrameSize:s,layout:u,exportOptions:c}=null===(t=g.current)||void 0===t?void 0:t.asMutable({deep:!0}),p=F(u),v=f.current[2];let m=(0,e.Immutable)(null===(l=b.current)||void 0===l?void 0:l.toJSON());const y=(null===(o=null==d?void 0:d.view)||void 0===o?void 0:o.width)/(null===(i=null==d?void 0:d.view)||void 0===i?void 0:i.height),h=p?(null==c?void 0:c.width)/(null==c?void 0:c.height):s[0]/s[1],x=(null==m?void 0:m.height)||(null===(n=null==d?void 0:d.view)||void 0===n?void 0:n.height),w=(null==m?void 0:m.width)||(null===(r=null==d?void 0:d.view)||void 0===r?void 0:r.width);if(y>h){const e=w/h,t=U(!1,e/x);m=m.set("height",e).set("ymin",null==t?void 0:t.mim).set("ymax",null==t?void 0:t.max)}else if(y<h){const e=x*h,t=U(!0,e/w);m=m.set("width",e).set("xmin",null==t?void 0:t.mim).set("xmax",null==t?void 0:t.max)}const S=new a({xmax:null==m?void 0:m.xmax,xmin:null==m?void 0:m.xmin,ymax:null==m?void 0:m.ymax,ymin:null==m?void 0:m.ymin,zmax:null==m?void 0:m.zmax,zmin:null==m?void 0:m.zmin,spatialReference:null==m?void 0:m.spatialReference});return v.fromExtent(S)},U=(e,t)=>{var l,o;const i=null===(l=b.current)||void 0===l?void 0:l.toJSON(),n=null===(o=null==b?void 0:b.current)||void 0===o?void 0:o.center,r=(e?(null==i?void 0:i.xmax)-(null==i?void 0:i.xmin):(null==i?void 0:i.ymax)-(null==i?void 0:i.ymin))*t;return{max:e?(null==n?void 0:n.x)+r/2:(null==n?void 0:n.y)+r/2,mim:e?(null==n?void 0:n.x)-r/2:(null==n?void 0:n.y)-r/2}},D=()=>{var e;const{exportOptions:t}=null===(e=g.current)||void 0===e?void 0:e.asMutable({deep:!0}),l=z();return{width:Ce(null==t?void 0:t.width,!0,null==t?void 0:t.dpi)*(null==l?void 0:l.x),height:Ce(null==t?void 0:t.height,!1,null==t?void 0:t.dpi)*(null==l?void 0:l.y)}},V=e=>{switch(null==e?void 0:e.toUpperCase()){case s.Centimeter:return{x:.01,y:.01};case s.Inch:return{x:.0254,y:.0254};case s.Millimeter:return{x:.001,y:.001};case s.Point:return{x:.0254/72,y:.0254/72};default:return{x:NaN,y:NaN}}},z=()=>{var e;const t=f.current[5];let l,o;const i=null===(e=null==b?void 0:b.current)||void 0===e?void 0:e.spatialReference;i&&(l=i.wkid,o=i.wkt);let n=null;if(l)n=t.values[t[l]];else if(o&&-1!==o.search(/^PROJCS/i)){const e=/UNIT\[([^\]]+)\]\]$/i.exec(o);e&&e[1]&&(n=parseFloat(e[1].split(",")[1]))}return{x:n,y:n}},$=()=>{var e;let t=null;const l=f.current[0],o=we(c,d.id);return(null===(e=d.view)||void 0===e?void 0:e.map)&&(t=d.view.map.findLayerById(o),t||(t=new l({id:o,listMode:"hide",title:o}),d.view.map.add(t))),t},W=()=>{var e,t;if(G()&&d.view||!p){const l=we(c,null==d?void 0:d.id),o=null===(t=null===(e=null==d?void 0:d.view)||void 0===e?void 0:e.map)||void 0===t?void 0:t.findLayerById(l);o&&o.graphics.removeAll()}},G=()=>!!F(null==p?void 0:p.layout)||!!(null==p?void 0:p.mapFrameSize);return(0,e.jsx)("div",{className:v,css:I},G()&&(0,e.jsx)("div",{title:y("showPrintArea"),className:"d-flex w-100 align-items-center checkbox-con",onClick:()=>{j(!T),T?W():E()}},(0,e.jsx)(t.Checkbox,{title:y("showPrintArea"),className:"lock-item-ratio","data-field":"mapSize",checked:T}),(0,e.jsx)("div",{className:"text-left ml-2 text-truncate"},y("showPrintArea"))))},Ae=e.css`
  & .alert-panel {
    background: none !important;
    border: none !important;
    padding: 0 !important;
  }
`,ke=l=>{const o=e.hooks.useTranslation(t.defaultMessages),{supportReport:i,supportCustomReport:n,outputDataSourceWarning:r}=l;return(0,e.jsx)("div",{css:Ae},(i||n)&&!!(null==r?void 0:r.label)&&(0,e.jsx)(he,null,(0,e.jsx)(t.Alert,{buttonType:"tertiary",className:"w-100",type:"warning",withIcon:!0,text:o("outputDataIsNotGenerated",{outputDsLabel:null==r?void 0:r.label,sourceWidgetName:null==r?void 0:r.widgets})})))};var Ue=function(e,t,l,o){return new(l||(l=Promise))((function(i,n){function r(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}s((o=o.apply(e,t||[])).next())}))};const De=new(0,e.esri.Sanitizer),{useState:Ve,useEffect:ze,useRef:Fe}=e.React,$e=l=>{var o,i,r,a,s,u,d,c;const p=e.hooks.useTranslation(S,t.defaultMessages,e.defaultMessages),v=Fe(null),m=Fe(null),y=Fe(!1),f=e.css`
    padding-bottom: ${e.polished.rem(16)};
    padding-top: ${e.polished.rem(16)};
    .setting-con {
      overflow-y: auto;
      padding-left: ${e.polished.rem(16)};
      padding-right: ${e.polished.rem(16)};
    }
    .print-button-con {
      padding-left: ${e.polished.rem(16)};
      padding-right: ${e.polished.rem(16)};
    }
    .no-right-padding .jimu-interactive-node{
      padding-right: 0;
    }
    .scalebar-unit {
      width: ${e.polished.rem(160)};
    }
    .collapse-button {
      padding-right: 0;
    }
    .map-size-con input {
      width: 100%;
    }
    .wkid-describtion {
      font-size: ${e.polished.rem(12)};
      color: var(--ref-palette-neutral-900);
    }
    .wkid-describtion-invalid {
      color: var(--sys-color-error-dark)
    }
    .outscale-con, .dpi-con {
      input {
        border-right: 0;
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
      }
      button {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
        height: ${e.polished.rem(26)};
        svg {
          margin-right: 0;
        }
      }
    }
    .radio-con, .checkbox-con {
      color: var(--ref-palette-neutral-1100);
      font-size: ${e.polished.rem(14)};
      line-height: ${e.polished.rem(22)};
      margin: ${e.polished.rem(4)} 0 ${e.polished.rem(8)} 0;
    }
  `,{templateList:g,jimuMapView:x,selectedTemplate:b,id:w,config:I,outputDataSourceWarning:T,confirmPrint:j,views:O,handleSelectedTemplateChange:C,setSelectedTemplateByIndex:R}=l,[N,M]=Ve((null===(o=null==b?void 0:b.layoutOptions)||void 0===o?void 0:o.titleText)||""),[L,E]=Ve((null==b?void 0:b.wkid)||""),[P,A]=Ve(null==b?void 0:b.outScale),[k,U]=Ve((null===(i=null==b?void 0:b.layoutOptions)||void 0===i?void 0:i.authorText)||""),[D,z]=Ve((null===(r=null==b?void 0:b.layoutOptions)||void 0===r?void 0:r.copyrightText)||""),[$,W]=Ve(null===(a=null==b?void 0:b.layoutOptions)||void 0===a?void 0:a.customTextElements),[G,_]=e.React.useState(null===(s=null==b?void 0:b.exportOptions)||void 0===s?void 0:s.dpi),[J,H]=e.React.useState(null===(u=null==b?void 0:b.exportOptions)||void 0===u?void 0:u.width),[Q,X]=e.React.useState(null===(d=null==b?void 0:b.exportOptions)||void 0===d?void 0:d.height),[Z,K]=Ve(!1),[Y,ee]=e.React.useState(null),[te,le]=Ve(null),[oe,ie]=Ve(!1),[ne,re]=Ve(!1);ze((()=>{var e,t,l,o,i,n,r,a,s,u,d,c;const p=q(null===(e=null==b?void 0:b.layoutOptions)||void 0===e?void 0:e.elementOverrides);M((null===(t=null==b?void 0:b.layoutOptions)||void 0===t?void 0:t.titleText)||""),U((null===(l=null==b?void 0:b.layoutOptions)||void 0===l?void 0:l.authorText)||""),z((null===(o=null==b?void 0:b.layoutOptions)||void 0===o?void 0:o.copyrightText)||""),W(null===(i=null==b?void 0:b.layoutOptions)||void 0===i?void 0:i.customTextElements),E(null==b?void 0:b.wkid),v.current=null==b?void 0:b.wkid,A(null==b?void 0:b.outScale),_(null===(n=null==b?void 0:b.exportOptions)||void 0===n?void 0:n.dpi),H(null===(r=null==b?void 0:b.exportOptions)||void 0===r?void 0:r.width),X(null===(a=null==b?void 0:b.exportOptions)||void 0===a?void 0:a.height),le(p),Be(Z),ie(!!(null===(s=null==b?void 0:b.layoutOptions)||void 0===s?void 0:s.legendLayers)),re(null===(c=null===(d=null===(u=null==b?void 0:b.layoutOptions)||void 0===u?void 0:u.elementOverrides)||void 0===d?void 0:d[p])||void 0===c?void 0:c.visible),(null==b?void 0:b.wkidLabel)?ee(null==b?void 0:b.wkidLabel):m.current&&se(null==b?void 0:b.wkid).then((e=>{ee(e)}))}),[b]);const se=t=>Ue(void 0,void 0,void 0,(function*(){if(y.current){const{getSRLabel:e}=m.current;return Promise.resolve(e(t))}return e.moduleLoader.loadModule("jimu-core/wkid").then((e=>{m.current=e,y.current=!0;const{getSRLabel:l}=m.current;return Promise.resolve(l(t))}))})),ue=t=>Ue(void 0,void 0,void 0,(function*(){if(y.current){const{isValidWkid:e}=m.current;return Promise.resolve(e(t))}return e.moduleLoader.loadModule("jimu-core/wkid").then((e=>{m.current=e,y.current=!0;const{isValidWkid:l}=m.current;return Promise.resolve(l(t))}))})),de=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,o=V(null==g?void 0:g.asMutable({deep:!0}),l);R(o)},pe=(e,t)=>{const l=b.setIn(e,t);C(l)},ve=()=>{pe(["forceFeatureAttributes"],!(null==b?void 0:b.forceFeatureAttributes))},me=()=>{pe(["attributionVisible"],!(null==b?void 0:b.attributionVisible))},fe=e=>Ue(void 0,void 0,void 0,(function*(){const e=oe?null:yield B(x);pe(["layoutOptions","legendLayers"],e),ie(!oe)})),ge=()=>{var e,t,l;const o=null===(l=null===(t=null===(e=null==b?void 0:b.layoutOptions)||void 0===e?void 0:e.elementOverrides)||void 0===t?void 0:t[te])||void 0===l?void 0:l.visible;pe(["layoutOptions","elementOverrides",te,"visible"],!o)},xe=e=>{pe(["layoutOptions","titleText"],e)},be=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;M(l)},we=e=>Ue(void 0,void 0,void 0,(function*(){if(!(yield ue(e))){E(v.current);const e=yield se(v.current);return ee(e),!1}v.current=e;const t=yield se(e),l=b.set("wkid",e).set("wkidLabel",t);C(l)})),Se=e=>Ue(void 0,void 0,void 0,(function*(){if(yield ue(e)){const t=yield se(e);ee(t)}else ee(p("invalidWKID"));E(e)})),Ie=e=>{pe(["outScale"],e)},Te=()=>{var e;const t=null===(e=null==x?void 0:x.view)||void 0===e?void 0:e.scale;A(t),pe(["outScale"],t)},je=e=>{A(e)},Oe=e=>{pe(["layoutOptions","authorText"],e)},Ce=e=>{if(e<1)return!1;_(parseInt(e))},Re=e=>{if(e<1)return!1;pe(["exportOptions","dpi"],parseInt(e))},Ne=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;U(l)},Me=e=>{pe(["layoutOptions","copyrightText"],e)},Le=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;z(l)},Ee=e=>{var t;if(!e||Number(e)<1)return H(null===(t=null==b?void 0:b.exportOptions)||void 0===t?void 0:t.width),!1;pe(["exportOptions","width"],e)},Ae=e=>{H(e)},$e=e=>{var t;if(!e||Number(e)<1)return X(null===(t=null==b?void 0:b.exportOptions)||void 0===t?void 0:t.height),!1;pe(["exportOptions","height"],e)},We=e=>{X(e)},Ge=e=>{const t=e.target.value;pe(["format"],t)},_e=e=>{const t=e.target.value;pe(["layoutOptions","scalebarUnit"],t)},Be=e=>{const t=Qe(),{showOutputSpatialReference:l}=t;e&&l&&!(null==b?void 0:b.wkidLabel)&&Ue(void 0,void 0,void 0,(function*(){const e=yield se(null==b?void 0:b.wkid);ee(e)}))},Je=()=>{Be(!Z),K(!Z)},qe=e=>{var t;if(e===n.SetMapScale){const l=null===(t=null==x?void 0:x.view)||void 0===t?void 0:t.scale;A(l),pe(["outScale"],l);const o=b.set("outScale",l).set("printExtentType",e);C(o)}else pe(["printExtentType"],e)},He=e=>{if(m.current){const{isValidWkid:t}=m.current;return t(e)}return!0},Qe=()=>{const e=F(null==b?void 0:b.layout),t=(null==b?void 0:b.hasAuthorText)&&(null==b?void 0:b.enableAuthor)&&!e,l=(null==b?void 0:b.hasCopyrightText)&&(null==b?void 0:b.enableCopyright)&&!e,o=(null==b?void 0:b.hasLegend)&&(null==b?void 0:b.enableLegend)&&!e,i=Xe()&&!e;return{showLayoutOption:t||l||o||i||(null==b?void 0:b.enableScalebarUnit),showAuthor:t,showCopyright:l,showLegend:o,showCustomTextElements:i,showTitle:null==b?void 0:b.enableTitle,showFeatureAttribution:null==b?void 0:b.enableFeatureAttribution,showMapAttribution:(null==b?void 0:b.enableMapAttribution)&&e,showQuality:null==b?void 0:b.enableQuality,showMapSize:(null==b?void 0:b.enableMapSize)&&e,showMapPrintExtents:null==b?void 0:b.enableMapPrintExtents,showScalebarUnit:(null==b?void 0:b.enableScalebarUnit)&&!e,showOutputSpatialReference:null==b?void 0:b.enableOutputSpatialReference,showNorthArrow:null==b?void 0:b.enableNorthArrow}},Xe=()=>{var e,t;const l=[];return null===(e=null==b?void 0:b.customTextElementEnableList)||void 0===e||e.forEach((e=>{for(const t in e)l.push(e[t])})),(null===(t=null==l?void 0:l.filter((e=>e)))||void 0===t?void 0:t.length)>0},Ze=()=>{var l;const o=Qe(),{showAuthor:i,showCopyright:n,showLegend:r,showLayoutOption:a,showFeatureAttribution:s,showQuality:u,showScalebarUnit:d,showNorthArrow:c}=o;return(0,e.jsx)("div",{role:"group","aria-label":p("LayoutOptions")},a&&(0,e.jsx)("div",{className:"mb-2"},p("LayoutOptions")),i&&(0,e.jsx)(he,{flowWrap:!0,label:p("printAuthor")},(0,e.jsx)(t.TextInput,{size:"sm",className:"w-100 dpi-input",value:k,onAcceptValue:Oe,onChange:Ne,"aria-label":p("printAuthor")})),n&&(0,e.jsx)(he,{flowWrap:!0,label:p("printCopyright")},(0,e.jsx)(t.TextInput,{size:"sm",className:"w-100 dpi-input",value:D,onAcceptValue:Me,onChange:Le,"aria-label":p("printCopyright")})),Ke(),r&&(0,e.jsx)(he,null,(0,e.jsx)("div",{title:p("includeLegend"),className:"w-100 align-items-center d-flex checkbox-con",onClick:fe},(0,e.jsx)(t.Checkbox,{title:p("includeLegend"),className:"lock-item-ratio",checked:oe}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1"},p("includeLegend")))),c&&(0,e.jsx)(he,null,(0,e.jsx)("div",{title:p("includeNorthArrow"),className:"w-100 align-items-center d-flex checkbox-con",onClick:ge},(0,e.jsx)(t.Checkbox,{title:p("includeNorthArrow"),className:"lock-item-ratio",checked:ne}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1"},p("includeNorthArrow")))),d&&(0,e.jsx)(he,{label:p("scaleBarUnit"),flowWrap:!1},(0,e.jsx)(t.Select,{value:null===(l=null==b?void 0:b.layoutOptions)||void 0===l?void 0:l.scalebarUnit,onChange:_e,size:"sm",className:"scalebar-unit","aria-label":p("scaleBarUnit")},function(e){return[{value:"Miles",label:e("unitsLabelMiles")},{value:"Kilometers",label:e("unitsLabelKilometers")},{value:"Meters",label:e("unitsLabelMeters")},{value:"Feet",label:e("unitsLabelFeet")}]}(p).map(((l,o)=>(0,e.jsx)(t.Option,{key:`unit${o}`,value:l.value,title:l.label},l.label))))),u&&(0,e.jsx)(he,{label:p("printQuality"),flowWrap:!0},(0,e.jsx)("div",{className:"d-flex align-items-center w-100 dpi-con"},(0,e.jsx)(t.NumericInput,{size:"sm",className:"flex-grow-1 no-right-padding",value:G,min:1,onAcceptValue:Re,onChange:Ce,showHandlers:!1,"aria-label":p("printQuality")}),(0,e.jsx)(t.Button,{disabled:!0,size:"sm",title:"DPI"},"DPI"))),s&&(0,e.jsx)(he,null,(0,e.jsx)("div",{title:p("includeAttributes"),className:"w-100 align-items-center d-flex checkbox-con",onClick:ve},(0,e.jsx)(t.Checkbox,{title:p("includeAttributes"),className:"lock-item-ratio","data-field":"mapSize",checked:null==b?void 0:b.forceFeatureAttributes}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1"},p("includeAttributes")))))},Ke=()=>{const l=[];return null==$||$.forEach(((o,i)=>{var n,r;for(const a in o){if(!(null===(r=null===(n=null==b?void 0:b.customTextElementEnableList)||void 0===n?void 0:n[i])||void 0===r?void 0:r[a]))continue;const s=(0,e.jsx)(he,{flowWrap:!0,className:"align-item-center",label:a,key:`${a}_${i}`},(0,e.jsx)(t.TextInput,{size:"sm",className:"flex-grow-1",value:o[a]||"",onAcceptValue:e=>{Ye(i,a,e)},onChange:e=>{et(i,a,e)},"aria-label":a}));l.push(s)}})),l},Ye=(e,t,l)=>{const o=$[e].set(t,l),i=null==$?void 0:$.asMutable({deep:!0});i.splice(e,1,o),pe(["layoutOptions","customTextElements"],i)},et=(t,l,o)=>{var i;const n=null===(i=null==o?void 0:o.target)||void 0===i?void 0:i.value,r=$[t].set(l,n),a=null==$?void 0:$.asMutable({deep:!0});a.splice(t,1,r),W((0,e.Immutable)(a))},tt=()=>{const l=Qe(),{showFeatureAttribution:o,showMapAttribution:i,showQuality:n}=l;return(0,e.jsx)("div",null,o&&(0,e.jsx)(he,{className:"mb-1"},(0,e.jsx)("div",{title:p("includeAttributes"),className:"w-100 align-items-center mt-1 d-flex checkbox-con",onClick:ve},(0,e.jsx)(t.Checkbox,{title:p("includeAttributes"),className:"lock-item-ratio","data-field":"mapSize",checked:null==b?void 0:b.forceFeatureAttributes}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1"},p("includeAttributes")))),i&&(0,e.jsx)(he,null,(0,e.jsx)("div",{title:p("includeAttribution"),className:"w-100 align-items-center d-flex checkbox-con",onClick:me},(0,e.jsx)(t.Checkbox,{title:p("includeAttribution"),className:"lock-item-ratio","data-field":"mapSize",checked:null==b?void 0:b.attributionVisible}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1"},p("includeAttribution")))),n&&(0,e.jsx)(he,{label:p("printQuality"),flowWrap:!0},(0,e.jsx)("div",{className:"d-flex align-items-center w-100 dpi-con"},(0,e.jsx)(t.NumericInput,{size:"sm",className:"flex-grow-1 no-right-padding",value:G,onAcceptValue:Re,onChange:Ce,showHandlers:!1,min:1,"aria-label":p("printQuality")}),(0,e.jsx)(t.Button,{disabled:!0,size:"sm",title:"DPI"},"DPI"))))},lt=()=>De.sanitize(p("spatialReference",{WKID:'<a target="_blank" href="https://developers.arcgis.com/rest/services-reference/enterprise/using-spatial-references.htm">WKID</a>'}));return(0,e.jsx)("div",{className:(0,e.classNames)("w-100 h-100",{invisible:O!==h.PrintTemplate}),css:f},(0,e.jsx)("div",{className:"w-100 h-100 d-flex flex-column"},(0,e.jsx)("div",{className:"flex-grow-1 w-100 setting-con"},(0,e.jsx)("div",{className:"w-100 h-100"},(()=>{var l,o,i,n,r;const a=Qe(),{showTitle:s}=a;return(0,e.jsx)("div",{className:"base-setting-con"},(0,e.jsx)(he,{flowWrap:!0,label:p("template")},(0,e.jsx)(t.Select,{value:null==b?void 0:b.templateId,onChange:de,size:"sm","aria-label":p("template")},null==g?void 0:g.map(((l,o)=>(0,e.jsx)(t.Option,{key:null==l?void 0:l.templateId,value:null==l?void 0:l.templateId,title:null==l?void 0:l.label},null==l?void 0:l.label))))),(0,e.jsx)(ke,{supportCustomReport:null==I?void 0:I.supportCustomReport,supportReport:null==I?void 0:I.supportReport,outputDataSourceWarning:T}),s&&(0,e.jsx)(he,{flowWrap:!0,label:p("title")},(0,e.jsx)(t.TextInput,{size:"sm",className:"w-100",value:N,"aria-label":p("title"),onAcceptValue:xe,onChange:be})),(null===(l=null==b?void 0:b.selectedFormatList)||void 0===l?void 0:l.length)>1&&(0,e.jsx)(he,{flowWrap:!0,label:p("fileFormat")},(0,e.jsx)(t.Select,{value:null===(o=null==b?void 0:b.format)||void 0===o?void 0:o.toLowerCase(),onChange:Ge,size:"sm","aria-label":p("fileFormat")},!(null===(i=null==b?void 0:b.selectedFormatList)||void 0===i?void 0:i.includes(null==b?void 0:b.format))&&(0,e.jsx)(t.Option,{className:"sr-only",key:`${null==b?void 0:b.format}0`,value:null===(n=null==b?void 0:b.format)||void 0===n?void 0:n.toLowerCase(),title:null==b?void 0:b.format},null==b?void 0:b.format),null===(r=null==b?void 0:b.selectedFormatList)||void 0===r?void 0:r.map(((l,o)=>(0,e.jsx)(t.Option,{key:`format${o}`,value:l,title:l},l))))))})(),(0,e.jsx)("div",null,F(null==b?void 0:b.layout)&&(()=>{const l=Qe(),{showMapSize:o}=l;return(0,e.jsx)("div",null,o&&(0,e.jsx)("div",{className:"d-flex align-items-center"},(0,e.jsx)("div",{className:"flex-grow-1"},(0,e.jsx)("div",{className:"mb-1"},p("width")),(0,e.jsx)(t.NumericInput,{size:"sm",className:"w-100 map-size-con",value:J,onAcceptValue:Ee,onChange:Ae,showHandlers:!1,"aria-label":p("width")})),(0,e.jsx)("div",{className:"flex-grow-1 ml-2"},(0,e.jsx)("div",{className:"mb-1"},p("height")),(0,e.jsx)(t.NumericInput,{size:"sm",className:"w-100 map-size-con",value:Q,onAcceptValue:$e,onChange:We,showHandlers:!1,"aria-label":p("height")}))))})(),(()=>{const l=F(null==b?void 0:b.layout),o=Qe(),{showLayoutOption:i,showFeatureAttribution:r,showMapAttribution:a,showQuality:s,showMapSize:u,showMapPrintExtents:d,showScalebarUnit:c,showOutputSpatialReference:v}=o,m=i||r||a||s||u||d||c||v;return(0,e.jsx)("div",null,m&&(0,e.jsx)("div",{className:"d-flex align-items-center",role:"group","aria-label":p("advance")},(0,e.jsx)("div",{className:"flex-grow-1"},p("advance")),(0,e.jsx)(t.Button,{className:"collapse-button",size:"sm",type:"tertiary",onClick:Je,title:p(Z?"collapse":"expand")},Z?(0,e.jsx)(ce,null):(0,e.jsx)(ae,null))),Z&&(0,e.jsx)("div",null,d&&(0,e.jsx)(he,{flowWrap:!0,label:p("mapPrintingExtents")},(0,e.jsx)("div",{role:"group","aria-label":p("mapPrintingExtents")},(0,e.jsx)("div",{title:p("currentMapExtent"),className:"d-flex align-items-center radio-con mt-1 checkbox-con",onClick:()=>{qe(n.CurrentMapExtent)}},(0,e.jsx)(t.Radio,{title:p("currentMapExtent"),checked:(null==b?void 0:b.printExtentType)===n.CurrentMapExtent,className:"mr-2"})," ",p("currentMapExtent")),(0,e.jsx)("div",{title:p("currentMapScale"),className:"d-flex align-items-center radio-con checkbox-con",onClick:()=>{qe(n.CurrentMapScale)}},(0,e.jsx)(t.Radio,{title:p("currentMapScale"),checked:(null==b?void 0:b.printExtentType)===n.CurrentMapScale,className:"mr-2"})," ",p("currentMapScale")),(0,e.jsx)("div",{title:p("setMapScale"),className:"d-flex align-items-center radio-con checkbox-con",onClick:()=>{qe(n.SetMapScale)}},(0,e.jsx)(t.Radio,{title:p("setMapScale"),checked:(null==b?void 0:b.printExtentType)===n.SetMapScale,className:"mr-2"})," ",p("setMapScale")),(null==b?void 0:b.printExtentType)===n.SetMapScale&&(0,e.jsx)("div",{className:"w-100 d-flex align-items-center outscale-con"},(0,e.jsx)(t.NumericInput,{size:"sm",className:"flex-grow-1 dpi-input no-right-padding",value:P,onAcceptValue:Ie,onChange:je,showHandlers:!1,"aria-label":p("setMapScale")}),(0,e.jsx)(t.Button,{size:"sm",onClick:Te,title:p("useCurrentScale")},(0,e.jsx)(ye,null))))),v&&(0,e.jsx)(he,{flowWrap:!0,label:(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:lt()}})},(0,e.jsx)(t.NumericInput,{size:"sm",className:"w-100 dpi-input no-right-padding",value:L,onAcceptValue:we,onChange:Se,showHandlers:!1,"aria-label":p("spatialReference",{WKID:""}),"aria-describedby":"print-wkid-describtion"}),(0,e.jsx)("div",{id:"print-wkid-describtion",title:Y,"aria-label":Y,className:(0,e.classNames)("text-truncate mt-1 wkid-describtion",{"wkid-describtion-invalid":!He(Number(L))})},Y)),!l&&Ze(),l&&tt()))})()))),(0,e.jsx)("div",{className:"print-button-con"},(null==I?void 0:I.enablePreview)&&(0,e.jsx)(Pe,{id:w,jimuMapView:x,className:"w-100",scale:P,selectedTemplate:b,scalebarUnit:null===(c=null==b?void 0:b.layoutOptions)||void 0===c?void 0:c.scalebarUnit,printExtentType:null==b?void 0:b.printExtentType,config:I}),(0,e.jsx)(t.Button,{className:"w-100 mt-2",type:"primary",onClick:()=>{j(b)}},p("_widgetLabel")))))};var We=r(62838),Ge=r.n(We),_e=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(l[o[i]]=e[o[i]])}return l};const Be=t=>{const l=window.SVG,{className:o}=t,i=_e(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:n,src:Ge()},i)):e.React.createElement("svg",Object.assign({className:n},i))};var Je=r(55886),qe=r.n(Je),He=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(l[o[i]]=e[o[i]])}return l};const Qe=t=>{const l=window.SVG,{className:o}=t,i=He(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:n,src:qe()},i)):e.React.createElement("svg",Object.assign({className:n},i))};var Xe=r(22167),Ze=r.n(Xe),Ke=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(l[o[i]]=e[o[i]])}return l};const Ye=t=>{const l=window.SVG,{className:o}=t,i=Ke(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:n,src:Ze()},i)):e.React.createElement("svg",Object.assign({className:n},i))},{useEffect:et,useState:tt}=e.React,lt=l=>{const o=e.hooks.useTranslation(S,t.defaultMessages),i=e.css`
    & {
      overflow: auto;
      padding: ${e.polished.rem(16)} ${e.polished.rem(16)} ${e.polished.rem(16)} ${e.polished.rem(16)};
    }
    .result-button {
      padding-left: 0;
      padding-right: 0;
    }
    a {
      padding: 0;
    }
    .print-loading-con {
      width: 16px;
      height: 16px;
      margin-right: ${e.polished.rem(4)};
    }
    a.result-button{
      &:hover {
        color: var(--sys-color-primary-main);
        background: none;
        text-decoration: underline;
      }
    }
    .error-link, .error-link:hover {
      color: var(--ref-palette-neutral-1200);
      & svg {
        color: var(--sys-color-error-dark);
      }
    }
  `,{printResultList:n,config:r,deleteResultItem:a}=l,[s,u]=tt(null);et((()=>{Ie(r.useUtility).then((e=>{u(e)}))}),[r.useUtility]);const d=l=>{switch(l.state){case y.Loading:return(0,e.jsx)("div",{className:"print-loading-con position-relative"},(0,e.jsx)(t.Loading,{width:16,height:16,type:t.LoadingType.Donut}));case y.Success:return(0,e.jsx)(Qe,null);case y.Error:return(0,e.jsx)("span",{title:o("uploadImageError")},(0,e.jsx)(Ye,null))}};return(0,e.jsx)("div",{className:"w-100 h-100",css:i},0===(null==n?void 0:n.length)&&(0,e.jsx)("div",null,o("resultEmptyMessage")),n.map(((l,i)=>(0,e.jsx)("div",{className:"d-flex align-items-center mb-2 w-100",key:null==l?void 0:l.resultId},(0,e.jsx)(t.Button,{href:s?`${null==l?void 0:l.url}?token=${s}`:null==l?void 0:l.url,disabled:!(null==l?void 0:l.url),target:"_blank",size:"sm","aria-label":null==l?void 0:l.title,title:(null==l?void 0:l.state)!==y.Error?null==l?void 0:l.title:"",type:"tertiary",className:(0,e.classNames)("flex-grow-1 d-flex align-items-center result-button",{"error-link":(null==l?void 0:l.state)===y.Error})},d(l),(0,e.jsx)("div",{className:"ml-2 flex-grow-1 text-left",title:(null==l?void 0:l.state)===y.Error?null==l?void 0:l.title:""},null==l?void 0:l.title)),(0,e.jsx)(t.Button,{icon:!0,size:"sm",type:"tertiary",onClick:()=>{a(i)},title:o("remove")},(0,e.jsx)(Be,null))))))};var ot=function(e,t,l,o){return new(l||(l=Promise))((function(i,n){function r(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}s((o=o.apply(e,t||[])).next())}))};const it=t=>ot(void 0,void 0,void 0,(function*(){var o;const{printTemplateProperties:i,useUtility:n,isSupportReport:r,widgetId:a,useMapWidgetIds:s,jimuMapView:u,reportOptions:d,toggleUtilityErrorRemind:c}=t,p=null===(o=t.mapView)||void 0===o?void 0:o.timeExtent,v=function(t,l){const o=null==l?void 0:l.dataSourceId;if(!t||!o)return t;let i=!0;const n=(0,e.getAppStore)().getState().appConfig.widgets;if(Object.keys(n).forEach((t=>{var l,r;const a=n[t];if("widgets/common/timeline/"===a.uri){const t=((null==a?void 0:a.useDataSources)||[]).filter((e=>e.rootDataSourceId===o||e.mainDataSourceId===o));(null==t?void 0:t.length)>0&&(null===(l=a.config)||void 0===l?void 0:l.dataSourceType)!==e.AllDataSourceTypes.Map&&(null===(r=a.config)||void 0===r?void 0:r.dataSourceType)!==e.AllDataSourceTypes.WebMap&&(i=!1)}})),i){let e;return(l.getAllJimuLayerViews().map((e=>e.layer))||[]).forEach((t=>{(null==t?void 0:t.timeExtent)&&(e=null==t?void 0:t.timeExtent)})),e&&(t.timeExtent=e),t}return t}(t.mapView,u),m=yield(y=(0,e.Immutable)(n),I(void 0,void 0,void 0,(function*(){const t=yield T(y);return t?e.SessionManager.getInstance().getSessionByUrl(t):null})));var y;return W(n).then((e=>(0,l.loadArcGISJSAPIModules)(["esri/rest/support/PrintParameters","esri/rest/support/PrintTemplate","esri/rest/print","esri/geometry/SpatialReference"]).then((l=>{var o;const[y,h,f,g]=l,x=new h(i),b={view:rt(v),template:x};i.wkid!==(null===(o=null==v?void 0:v.spatialReference)||void 0===o?void 0:o.wkid)&&(b.outSpatialReference=new g({wkid:i.wkid}));const w=new y(b),S={timeout:12e4,token:null==m?void 0:m.token};return(null==m?void 0:m.token)&&(S.token=m.token),f.execute(e,w,S).then((e=>(le(null==n?void 0:n.utilityId,c),r&&Te(u,d,a,s),nt(t.mapView,p),rt(v,!0),Promise.resolve(e))),(e=>(r&&Te(u,d,a,s),le(null==n?void 0:n.utilityId,c,e),nt(t.mapView,p),rt(v,!0),Promise.reject(e)))).catch((e=>(r&&Te(u,d,a,s),le(null==n?void 0:n.utilityId,c,e),nt(t.mapView,p),rt(v,!0),Promise.reject(e))))}))))}));function nt(e,t){e.timeExtent=t}function rt(e,t=!1){return e.map.layers.toArray().forEach((e=>{var l,o,i,n;if(null===(l=null==e?void 0:e.id)||void 0===l?void 0:l.includes("jimu-draw-groupLayer")){(null===(o=null==e?void 0:e.layers)||void 0===o?void 0:o.toArray()).forEach((e=>{var l;null===(l=e.graphics)||void 0===l||l.forEach((e=>{var l;(null===(l=null==e?void 0:e.attributes)||void 0===l?void 0:l.jimuDrawId)&&(e.geometry.hasZ=t)}))}))}(null===(i=null==e?void 0:e.id)||void 0===i?void 0:i.includes("bookmark-layer-"))&&(null===(n=null==e?void 0:e.graphics)||void 0===n||n.forEach((e=>{var l;(null===(l=null==e?void 0:e.attributes)||void 0===l?void 0:l.jimuDrawId)&&(e.geometry.hasZ=t)})))})),e}const at=e.css`
  & .utility-err-remind-con {
    bottom: 0;
  }
`,st=l=>{const o=e.hooks.useTranslation(t.defaultMessages,e.defaultMessages),{utilityId:i,toggleUtilityErrorRemind:n}=l,r=e.ReactRedux.useSelector((e=>{var t,l,n;const r=null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.utilityStates;return!0===(null===(l=null==r?void 0:r[i])||void 0===l?void 0:l.isSignInError)?o("signInErrorDefault"):!1===(null===(n=null==r?void 0:r[i])||void 0===n?void 0:n.success)?o("utilityNotAvailable"):void 0}));return(0,e.jsx)("div",{className:"position-relative w-100",css:at},(0,e.jsx)("div",{className:"position-absolute w-100 utility-err-remind-con"},(0,e.jsx)(t.Alert,{buttonType:"tertiary",className:"w-100",type:"warning",withIcon:!0,closable:!0,onClose:()=>{n(!1)},text:r})))};var ut=function(e,t,l,o){return new(l||(l=Promise))((function(i,n){function r(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}s((o=o.apply(e,t||[])).next())}))};const{useState:dt,useRef:ct,useEffect:pt}=e.React,vt=e.css`
  .classic-setting-con {
    height: 0;
  }
  .nav-bar-con {
    height: ${e.polished.rem(40)};
    border: none !important;
    border-bottom: 1px solid var(--ref-palette-neutral-300) !important;
    padding: 0;
    .navbar-nav button.nav-link:not(.active), .navbar-nav button.nav-link:hover:not(.active) {
      color: var(--ref-palette-neutral-1100);
    }
    .loading-con {
      min-width: 16px;
      height: 16px;
      margin-top: -1px;
    }
    .jimu-nav-link-wrapper .jimu-badge-wrapper {
      & {
        display: block;
      }
      .badge-dot {
        top: ${e.polished.rem(4)};
        right: ${e.polished.rem(4)};
      }
    }
  }
`,mt=o=>{var i;const n=e.hooks.useTranslation(S,t.defaultMessages),r=ct([]),a=ct([]),s=ct(null),{config:u,jimuMapView:d,templateList:c,id:p,locale:v,useMapWidgetIds:m,outputDataSourceWarning:f,showUtilityErrorRemind:g,handleSelectedTemplateIndexChange:x,toggleUtilityErrorRemind:b}=o,[w,I]=dt(h.PrintTemplate),[T,j]=dt((0,e.Immutable)([])),[O,C]=dt(null);pt((()=>{L(0)}),[]),pt((()=>{var t;if(O&&$(c,null==O?void 0:O.templateId)){const l=V(null==c?void 0:c.asMutable({deep:!0}),null==O?void 0:O.templateId),o=null===(t=E(null==c?void 0:c[l]))||void 0===t?void 0:t.asMutable({deep:!0});R(o),s.current=(0,e.Immutable)(o)}O&&$(c,null==O?void 0:O.templateId)||L(0)}),[c,u]);const R=t=>{var l;let o=null==O?void 0:O.asMutable({deep:!0});for(const e in o)e.includes("enable")&&delete o[e];const i=N(t,null===(l=s.current)||void 0===l?void 0:l.asMutable({deep:!0}));i.length>0&&i.forEach((l=>{const i=M(t,l);o=(0,e.Immutable)(o).setIn(l.split("."),i).asMutable({deep:!0})})),o.customTextElementEnableList=null==t?void 0:t.customTextElementEnableList,o.selectedFormatList=null==t?void 0:t.selectedFormatList;const n=(0,e.Immutable)(Object.assign(Object.assign({},t),o));P(n)},N=(e,t)=>{const l=[],o=(e,t,i)=>{for(const n in e){const r=e[n],a=null==t?void 0:t[n],s=i?`${i}.${n}`:n;"object"==typeof r&&"object"==typeof a&&(null!==r&&null!==a)?o(r,a,s):r!==a&&l.push(s)}};return o(e,t,""),l},M=(e,t)=>{const l=t.split(".");let o=e;for(const e of l)o=null==o?void 0:o[e];return o},L=e=>{if(0===(null==c?void 0:c.length))return!1;const t=E(null==c?void 0:c[e]);s.current=t,x(e),P(t)},E=t=>t?t=(null==t?void 0:t.overrideCommonSetting)?D((0,e.Immutable)(null==u?void 0:u.commonSetting),(0,e.Immutable)(t)):D((0,e.Immutable)(t),(0,e.Immutable)(null==u?void 0:u.commonSetting)):null,P=e=>{C(e)},A=t=>{I(t),t===h.PrintResult&&(a.current=(0,e.Immutable)(r.current).asMutable())},k=e=>{const t=we(p,d.id),l=d.view.map.findLayerById(t);l&&(l.visible=e)},U=(t,l,o)=>{let i;o&&(t.url=o),t.state=l;const n=r.current;n.forEach(((e,l)=>{e.resultId===t.resultId&&(i=l)})),(i||0===i)&&(n.splice(i,1,t),j((0,e.Immutable)(n)),r.current=n)};return(0,e.jsx)("div",{className:"w-100 h-100 d-flex flex-column",css:vt},(()=>{var l;const o=(()=>{var e,t;return(null===(t=null===(e=null==r?void 0:r.current)||void 0===e?void 0:e.filter((e=>e.state===y.Loading)))||void 0===t?void 0:t.length)>0})()&&w===h.PrintTemplate,i=null===(l=null==r?void 0:r.current)||void 0===l?void 0:l.length,a=!o&&i>0?`(${i})`:"";return(0,e.jsx)(t.Navbar,{className:"nav-bar-con w-100",border:!1,light:!0},(0,e.jsx)(t.Nav,{className:"w-100 h-100",underline:!0,navbar:!0,justified:!0,fill:!0},(0,e.jsx)(t.NavItem,{title:n("printTemplate"),onClick:()=>{A(h.PrintTemplate)},className:"link-con"},(0,e.jsx)(t.NavLink,{tag:"button",active:w===h.PrintTemplate},n("printTemplate"))),(0,e.jsx)(t.NavItem,{title:n("printResult"),onClick:()=>{A(h.PrintResult)}},(0,e.jsx)(t.NavLink,{className:"align-middle",tag:"button",active:w===h.PrintResult},(0,e.jsx)("div",{className:"d-inline-block"},n("resultsNumber",{number:a})),o&&(0,e.jsx)("div",{className:"loading-con position-relative ml-1 d-inline-block align-middle"},(0,e.jsx)(t.Loading,{width:16,height:16,type:t.LoadingType.Donut}))))))})(),(0,e.jsx)("div",{className:"flex-grow-1 w-100 classic-setting-con overflow-hidden"},(0,e.jsx)("div",{className:(0,e.classNames)("w-100 h-100",{"sr-only":w!==h.PrintTemplate})},(0,e.jsx)($e,{id:p,config:u,jimuMapView:d,selectedTemplate:O,templateList:c,outputDataSourceWarning:f,confirmPrint:t=>ut(void 0,void 0,void 0,(function*(){var o;const i={resultId:xe((0,e.Immutable)(r.current)),url:null,title:ge(null===(o=null==t?void 0:t.layoutOptions)||void 0===o?void 0:o.titleText,(0,e.Immutable)(r.current)),state:y.Loading},n=r.current,a=(null==u?void 0:u.supportCustomReport)||(null==u?void 0:u.supportReport);n.push(i),r.current=n,j((0,e.Immutable)(n)),k(!1);const s={printTemplateProperties:O,mapView:d,locale:v,utility:u.useUtility,useMapWidgetIds:m,widgetId:p,isSupportReport:a},c=yield Oe(s);if(!c)return void U(i,y.Error);let h;a&&(h=l.MapViewManager.getInstance().getJimuMapViewById(d.id));const f=h||d;it({useUtility:null==u?void 0:u.useUtility,mapView:null==f?void 0:f.view,printTemplateProperties:c,toggleUtilityErrorRemind:b,jimuMapView:d,useMapWidgetIds:m,widgetId:p,isSupportReport:a,reportOptions:null==O?void 0:O.reportOptions}).then((e=>{k(!0),U(i,y.Success,null==e?void 0:e.url)}),(e=>{k(!0),U(i,y.Error)}))})),views:w,handleSelectedTemplateChange:P,setSelectedTemplateByIndex:L}),g&&(0,e.jsx)(st,{utilityId:null===(i=null==u?void 0:u.useUtility)||void 0===i?void 0:i.utilityId,toggleUtilityErrorRemind:b})),w===h.PrintResult&&(0,e.jsx)(lt,{config:u,printResultList:T,deleteResultItem:t=>{var l,o;const i=r.current;i.splice(t,1),j((0,e.Immutable)(i)),r.current=null===(l=(0,e.Immutable)(i))||void 0===l?void 0:l.asMutable({deep:!0}),a.current=null===(o=(0,e.Immutable)(i))||void 0===o?void 0:o.asMutable({deep:!0})}})))};var yt=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(l[o[i]]=e[o[i]])}return l};const ht=t=>{const l=window.SVG,{className:o}=t,i=yt(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:n,src:w()},i)):e.React.createElement("svg",Object.assign({className:n},i))},ft=t=>{const l=e.css`
    &.print-loading-con {
      @keyframes loading {
        0% {transform: rotate(0deg); };
        100% {transform: rotate(360deg)};
      }
      width: ${e.polished.rem(16)};
      height: ${e.polished.rem(16)};
      border: 1px solid var(--ref-palette-neutral-800);
      border-radius: 50%;
      border-top: 1px solid var(--ref-palette-neutral-1100);
      box-sizing: border-box;
      animation:loading 2s infinite linear;
      margin-right: ${e.polished.rem(4)};
    }
  `;return(0,e.jsx)("div",{css:l,className:"print-loading-con"})},{useEffect:gt,useState:xt}=e.React,bt=l=>{const o=e.hooks.useTranslation(S,t.defaultMessages),{printResult:i,useUtility:n,restPrint:r}=l,[a,s]=xt(null),u=e.css`
    .error-link, .error-link:hover {
      color: var(--ref-palette-neutral-1200);
      & svg {
        color: var(--sys-color-error-dark);
      }
    }
    a.result-button{
      &:hover {
        color: var(--sys-color-primary-main);
        background: none;
        text-decoration: underline;
      }
    }
  `;gt((()=>{Ie(n).then((e=>{s(e)}))}),[n]);return(0,e.jsx)("div",{className:"d-flex flex-column h-100 w-100 result-con",css:u},(0,e.jsx)(t.Button,{href:a?`${null==i?void 0:i.url}?token=${a}`:null==i?void 0:i.url,disabled:!(null==i?void 0:i.url),target:"_blank",size:"sm","aria-label":null==i?void 0:i.title,title:null==i?void 0:i.title,type:"tertiary",className:(0,e.classNames)("d-flex align-items-center",{"error-link":(null==i?void 0:i.state)===y.Error})},(()=>{switch(null==i?void 0:i.state){case y.Loading:return(0,e.jsx)(ft,null);case y.Success:return(0,e.jsx)(Qe,null);case y.Error:return(0,e.jsx)("span",{title:o("uploadImageError")},(0,e.jsx)(Ye,null))}})(),(0,e.jsx)("div",{className:"ml-2 flex-grow-1 text-left"},null==i?void 0:i.title)),(0,e.jsx)("div",{className:"flex-grow-1 d-flex align-items-end"},(0,e.jsx)("div",{className:"flex-grow-1"}),(0,e.jsx)(t.Button,{type:"primary",onClick:r},o("reset"))))};var wt=function(e,t,l,o){return new(l||(l=Promise))((function(i,n){function r(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}s((o=o.apply(e,t||[])).next())}))};const{useState:St,useRef:It,useEffect:Tt}=e.React,{useSelector:jt}=e.ReactRedux,Ot=o=>{var i,n;const{config:r,templateList:a,jimuMapView:s,errorTip:u,id:d,locale:c,useMapWidgetIds:p,outputDataSourceWarning:v,showPlaceholder:m,showUtilityErrorRemind:h,controllerWidgetId:f,toggleUtilityErrorRemind:g}=o,x=e.hooks.useTranslation(S,t.defaultMessages),b=It(null),w=jt((e=>{var t,l;return null===(l=null===(t=null==e?void 0:e.appConfig)||void 0===t?void 0:t.widgets)||void 0===l?void 0:l[d]})),I=e.css`
    .compact-con {
      padding: 0;
      svg {
        margin: 0 auto;
      }
      .compact-icon {
        color: ${null===(n=null===(i=null==w?void 0:w.icon)||void 0===i?void 0:i.properties)||void 0===n?void 0:n.color};
      }
    }
    .off-panel-con {
      min-height: 32px;
      min-width: 32px;
    }
    .operate-con-width-controller-widget {
      min-width: 295px;
      padding: 12px;
      .close-con button{
        padding: 0;
        svg {
          margin: 0 auto;
        }
      }
    }
  `,T=e.css`
    & {
      padding: ${e.polished.rem(12)};
      width: ${e.polished.rem(320)};
    }
    .select-con {
      min-height: ${e.polished.rem(107)};
    }
    .result-con {
      min-height: ${e.polished.rem(107)};
    }
    .close-con button{
      padding: 0;
      svg {
        margin: 0 auto;
      }
    }
    .result-list-con button {
      padding: 0;
    }
    .compact-preview-con {
      width: 0;
    }
  `,j=[{name:"preventOverflow",options:{altAxis:!0}},(0,t.getFallbackPlacementsModifier)(["left-start","left-end"],!0)],[O,C]=St(!1),[R,N]=St(!1),[M,L]=St(null),[E,P]=St(null);Tt((()=>{A(0)}),[]),Tt((()=>{if(E&&$(a,null==E?void 0:E.templateId)||A(0),E&&$(a,null==E?void 0:E.templateId)){const e=V(null==a?void 0:a.asMutable({deep:!0}),null==E?void 0:E.templateId);A(e)}}),[a,r]);const A=e=>{if(0===(null==a?void 0:a.length))return!1;let t=null==a?void 0:a[e];t=(null==t?void 0:t.overrideCommonSetting)?D(null==r?void 0:r.commonSetting,t):D(t,null==r?void 0:r.commonSetting),P(t)},k=(e,t)=>{C("clickOutside"!==t&&!O)},U=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,o=V(null==a?void 0:a.asMutable({deep:!0}),l);A(o)},z=()=>{L(null),N(!1)},F=e=>{const t=we(d,s.id),l=s.view.map.findLayerById(t);l&&(l.visible=e)},W=()=>wt(void 0,void 0,void 0,(function*(){var t;const o={resultId:null==E?void 0:E.templateId,url:null,title:null===(t=null==E?void 0:E.layoutOptions)||void 0===t?void 0:t.titleText,state:y.Loading},i=(null==r?void 0:r.supportCustomReport)||(null==r?void 0:r.supportReport);L((0,e.Immutable)(o)),N(!R),F(!1);const n={printTemplateProperties:E,mapView:s,locale:c,utility:r.useUtility,useMapWidgetIds:p,widgetId:d,isSupportReport:i},a=yield Oe(n);if(!a)return o.state=y.Error,void L((0,e.Immutable)(o));let u;i&&(u=l.MapViewManager.getInstance().getJimuMapViewById(s.id));const v=u||s;it({useUtility:null==r?void 0:r.useUtility,mapView:null==v?void 0:v.view,printTemplateProperties:a,toggleUtilityErrorRemind:g,jimuMapView:s,useMapWidgetIds:p,widgetId:d,isSupportReport:i,reportOptions:null==E?void 0:E.reportOptions}).then((t=>{o.url=null==t?void 0:t.url,o.state=y.Success,F(!0),L((0,e.Immutable)(o))}),(t=>{F(!0),o.state=y.Error,L((0,e.Immutable)(o))}))})),G=()=>{var l;return(0,e.jsx)("div",{className:(0,e.classNames)("w-100 h-100",{"operate-con-width-controller-widget":f})},!m&&(0,e.jsx)("div",{className:"d-flex flex-column w-100 h-100"},!f&&(0,e.jsx)("div",{className:"text-right close-con"},(0,e.jsx)(t.Button,{className:"print-button",type:"tertiary",title:x("closeTour"),onClick:k},(0,e.jsx)(Be,null))),(0,e.jsx)("div",{className:"flex-grow-1"},(0,e.jsx)("div",{className:(0,e.classNames)("w-100 h-100 select-con",{"sr-only":R})},(()=>{var l;return(0,e.jsx)("div",{className:"d-flex flex-column"},(0,e.jsx)(he,{flowWrap:!0,className:"flex-grow-1",label:x("template")},(0,e.jsx)(t.Select,{value:null==E?void 0:E.templateId,onChange:U,size:"sm",className:"scalebar-unit","aria-label":x("template")},null==a?void 0:a.map(((l,o)=>(0,e.jsx)(t.Option,{key:l.templateId,value:l.templateId,title:l.label},l.label))))),(0,e.jsx)(ke,{supportCustomReport:null==r?void 0:r.supportCustomReport,supportReport:null==r?void 0:r.supportReport,outputDataSourceWarning:v}),(0,e.jsx)("div",{className:"print-button-con d-flex align-items-center mt-2"},(null==r?void 0:r.enablePreview)&&(0,e.jsx)(Pe,{className:"flex-grow-1 compact-preview-con",id:d,config:r,jimuMapView:s,scale:null==E?void 0:E.outScale,selectedTemplate:E,scalebarUnit:null===(l=null==E?void 0:E.layoutOptions)||void 0===l?void 0:l.scalebarUnit,printExtentType:null==E?void 0:E.printExtentType}),(0,e.jsx)(t.Button,{className:"print-button text-truncate ml-1",type:"primary",onClick:W,title:x("_widgetLabel")},x("_widgetLabel"))))})()),R&&(0,e.jsx)(bt,{printResult:M,restPrint:z,useUtility:null==r?void 0:r.useUtility}))),m&&(0,e.jsx)("div",null,u),h&&(0,e.jsx)(st,{utilityId:null===(l=null==r?void 0:r.useUtility)||void 0===l?void 0:l.utilityId,toggleUtilityErrorRemind:g}))};return(0,e.jsx)("div",{className:"w-100 h-100",css:I},f&&(0,e.jsx)("div",{className:"w-100 h-100"},G()),!f&&(0,e.jsx)("div",{className:"w-100 h-100"},(0,e.jsx)(t.Button,{className:(0,e.classNames)("w-100 h-100 compact-con",{"off-panel-con":null==w?void 0:w.offPanel}),type:"tertiary",ref:b,title:x("_widgetLabel"),onClick:k},(()=>{const l=null==w?void 0:w.icon;return l?"string"==typeof l?(0,e.jsx)(t.SVG,{src:l}):(0,e.jsx)(t.Icon,{className:"compact-icon",icon:null==l?void 0:l.svg}):(0,e.jsx)(ht,null)})()),(0,e.jsx)(t.Popper,{open:O,disableResize:!0,placement:"bottom",reference:b,modifiers:j,showArrow:!0,toggle:k,trapFocus:!1,autoFocus:!1,css:T},G())))};var Ct=function(e,t,l,o){return new(l||(l=Promise))((function(i,n){function r(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}s((o=o.apply(e,t||[])).next())}))};class Rt extends e.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.10.0",description:"update layoutChoiceList of old print widget",upgrader:t=>Ct(this,void 0,void 0,(function*(){const l=null==t?void 0:t.useUtility,o=t=>{var l,o,i,n,r,a;let s=(0,e.Immutable)(t);if(null===(l=null==t?void 0:t.exportOptions)||void 0===l?void 0:l.dpi){const e=Number(null===(o=null==t?void 0:t.exportOptions)||void 0===o?void 0:o.dpi);e<0?s=s.setIn(["exportOptions","dpi"],1):parseInt(e)!==e&&(s=s.setIn(["exportOptions","dpi"],parseInt(e)))}if(null===(i=null==t?void 0:t.exportOptions)||void 0===i?void 0:i.width){Number(null===(n=null==t?void 0:t.exportOptions)||void 0===n?void 0:n.width)<1&&(s=s.setIn(["exportOptions","width"],800))}else(null==t?void 0:t.layout)&&F(null==t?void 0:t.layout)&&(s=s.setIn(["exportOptions","width"],800));if(null===(r=null==t?void 0:t.exportOptions)||void 0===r?void 0:r.height){Number(null===(a=null==t?void 0:t.exportOptions)||void 0===a?void 0:a.height)<1&&(s=s.setIn(["exportOptions","height"],1100))}else(null==t?void 0:t.layout)&&F(null==t?void 0:t.layout)&&(s=s.setIn(["exportOptions","height"],1100));return null==s?void 0:s.asMutable({deep:!0})};t=(e=>{var t,l;return(null===(l=null===(t=null==e?void 0:e.commonSetting)||void 0===t?void 0:t.exportOptions)||void 0===l?void 0:l.dpi)?e.setIn(["commonSetting"],o(e.commonSetting)):e})(t);if(l){const e=yield(i=l,n=t,I(void 0,void 0,void 0,(function*(){return W(i).then((e=>O(e,i,n)))})));if(null==e?void 0:e.layoutChoiceList){const l=((e,t)=>{var l;const i=(null===(l=null==e?void 0:e.printCustomTemplate)||void 0===l?void 0:l.asMutable({deep:!0}))||[];return i?null==i?void 0:i.map((e=>{var l;if(null==e?void 0:e.mapFrameSize)return o(e);{const i=null===(l=null==t?void 0:t.filter((t=>(null==t?void 0:t.layout)===(null==e?void 0:e.layout))))||void 0===l?void 0:l[0],n={mapFrameSize:null==i?void 0:i.mapFrameSize,mapFrameUnit:null==i?void 0:i.mapFrameUnit,hasAuthorText:null==i?void 0:i.hasAuthorText,hasCopyrightText:null==i?void 0:i.hasCopyrightText,hasLegend:null==i?void 0:i.hasLegend,hasTitleText:null==i?void 0:i.hasTitleText};return Object.assign(Object.assign({},o(e)),n)}})):i})(t,null==e?void 0:e.layoutChoiceList);return t.setIn(["layoutChoiceList"],null==e?void 0:e.layoutChoiceList).set("printCustomTemplate",l)}return t}return t;var i,n}))},{version:"1.13.0",description:"Add default print preview style for old print widget",upgrader:e=>Ct(this,void 0,void 0,(function*(){let t=e;return"boolean"!=typeof(null==e?void 0:e.enablePreview)&&(t=t.set("enablePreview",!0).set("previewBackgroundColor","rgba(0,216,237,1)").set("previewOutLine",i)),t}))},{version:"1.14.0",description:"Add default layout template or report template for old print widget",upgrader:e=>Ct(this,void 0,void 0,(function*(){var t,l,o;let i=e;if(i.useUtility){i=(yield(r=i,Ct(void 0,void 0,void 0,(function*(){let e=r;return W(e.useUtility).then((t=>te(t).then((l=>Ct(void 0,void 0,void 0,(function*(){var o,i;const{supportCustomLayout:n,defaultCustomLayoutItem:a,supportCustomReport:s,supportReport:u}=l;let d={layoutTypes:f.ServiceLayout},p={reportTypes:x.ServiceReport};if(n&&a&&(d=yield C(l,e.useUtility)),u||s){const o=(yield G(t,c.ReportTemplate))||[],i=N(o);e=e.set("reportTemplateChoiceList",i).set("defaultReportTemplate",null==l?void 0:l.defaultReportTemplate).set("defaultCustomReportItem",null==l?void 0:l.defaultCustomReportItem),p=yield R(o,l,e.useUtility)}const v=((null==e?void 0:e.printTemplateType)===m.Customize?null===(o=e.printCustomTemplate)||void 0===o?void 0:o.asMutable({deep:!0}):null===(i=e.printOrgTemplate)||void 0===i?void 0:i.asMutable({deep:!0})).map((e=>{if((u||s)&&(e.reportTypes=d.reportTypes,(null==p?void 0:p.customReportItem)&&(e.customReportItem=p.customReportItem),(null==p?void 0:p.report)&&(e.report=p.report),(null==p?void 0:p.reportOptions)&&(e.reportOptions=p.reportOptions)),e.layoutTypes=d.layoutTypes,n&&a){(null==d?void 0:d.customLayoutItem)&&(e.customLayoutItem=d.customLayoutItem);const t=null==d?void 0:d.templateInfo;t&&((null==t?void 0:t.layoutOptions)&&(e.layoutOptions=t.layoutOptions),(null==t?void 0:t.pageUnits)&&(e.mapFrameUnit=t.pageUnits),(null==t?void 0:t.webMapFrameSize)&&(e.mapFrameSize=t.webMapFrameSize))}return e}));return e=(null==r?void 0:r.printTemplateType)===m.Customize?e.set("printCustomTemplate",v):e.set("printOrgTemplate",v),Promise.resolve(e)}))),(t=>Promise.resolve(e)))))}))))||i;const e=(null==i?void 0:i.printTemplateType)===m.Customize?null===(t=i.printCustomTemplate)||void 0===t?void 0:t.asMutable({deep:!0}):null===(l=i.printOrgTemplate)||void 0===l?void 0:l.asMutable({deep:!0});if(e&&i.layoutChoiceList){const t=(n=e,(null===(o=i.layoutChoiceList)||void 0===o?void 0:o.asMutable({deep:!0})).map((e=>{const t=(null==n?void 0:n.filter((t=>t.layout===e.layout))[0])||{};return e.customTextElementEnableList=t.customTextElementEnableList||[],e.enableNorthArrow=t.enableNorthArrow,e.enableLegend=t.hasLegend,e.enableAuthor=t.hasAuthorText,e.enableCopyright=t.hasCopyrightText,e.enableScalebarUnit=!0,e})));i=i.set("layoutChoiceList",t)}}var n,r;return i}))}]}}const Nt=new Rt,{useState:Mt,useEffect:Lt,useRef:Et}=e.React,Pt=t=>{const l=Et({}),o=Et(null),{reportOptions:i,id:n,handleWarningLabelChange:r}=t,[a,s]=Mt(null),[u,d]=Mt(null);Lt((()=>{const e=(null==i?void 0:i.reportSectionOverrides)||{},t=[],n=[],a=[],u=[];Object.keys(e).forEach((l=>{var o;const i=e[l],r=null===(o=null==i?void 0:i.exbDatasource)||void 0===o?void 0:o[0],s=null==i?void 0:i.isDsOutputDs;r&&s&&!(null==n?void 0:n.includes(null==r?void 0:r.dataSourceId))&&(t.push(r),n.push(null==r?void 0:r.dataSourceId)),!r||s||(null==a?void 0:a.includes(null==r?void 0:r.dataSourceId))||(u.push(r),a.push(null==r?void 0:r.dataSourceId))})),function(e,t){if((null==e?void 0:e.length)!==(null==t?void 0:t.length)||!e||!t)return!1;const l=e.sort(),o=t.sort();let i=!0;return null==l||l.forEach(((e,t)=>{l[t]!==o[t]&&(i=!1)})),i}(n,o.current)||(r(null),l.current={}),o.current=n,s(t),d(u)}),[i]);const c=(t,o)=>{var i,n;const a=o.dataSourceId,s=l.current,u=(null===(i=(0,e.getAppStore)().getState().appConfig)||void 0===i?void 0:i.widgets)||{};if((null==s?void 0:s[a])!==t){s[a]=t,l.current=s;const o=[],i={};Object.keys(s).forEach((t=>{var l;if(!s[t]){const n=e.DataSourceManager.getInstance().getDataSource(t),r=null==n?void 0:n.getLabel(),a=p(n),s=null===e.appConfigUtils||void 0===e.appConfigUtils?void 0:e.appConfigUtils.getWidgetIdByOutputDataSource(a),d=null===(l=null==u?void 0:u[s])||void 0===l?void 0:l.label;s&&(o.push(r),i[s]=d)}}));let d=null,c=null;(null===(n=Object.keys(i))||void 0===n?void 0:n.length)>0&&(c=o.join(", "),d=Object.keys(i).map((e=>i[e])).join(", ")),r({label:c,widgets:d})}},p=e=>{var t;return e?{dataSourceId:e.id,mainDataSourceId:e.getMainDataSource().id,dataViewId:e.dataViewId,rootDataSourceId:null===(t=e.getRootDataSource())||void 0===t?void 0:t.id}:null};return(0,e.jsx)("div",null,null==a?void 0:a.map((t=>(0,e.jsx)(e.DataSourceComponent,{key:t.dataSourceId,query:null,useDataSource:t,onDataSourceCreated:()=>{(e=>{c(!0,e)})(t)},onCreateDataSourceFailed:e=>{((e,t)=>{c(!1,t)})(0,t)},widgetId:n,queryCount:!0,onDataSourceInfoChange:l=>{((t,l)=>{const o=null==t?void 0:t.status,i=o!==e.DataSourceStatus.NotCreated&&o!==e.DataSourceStatus.CreateError&&o!==e.DataSourceStatus.LoadError&&o!==e.DataSourceStatus.SaveError&&o!==e.DataSourceStatus.NotReady;c(i,l)})(l,t)}}))),null==u?void 0:u.map((t=>(0,e.jsx)(e.DataSourceComponent,{key:t.dataSourceId,query:null,useDataSource:t,widgetId:n,queryCount:!0}))))},{useState:At,useRef:kt,useEffect:Ut}=e.React,Dt=o=>{var i;const{id:n,config:r,dispatch:a,useMapWidgetIds:s,layoutId:u,layoutItemId:d,locale:c,controllerWidgetId:y}=o,h=e.hooks.useTranslation(S,t.defaultMessages),f=e.ReactRedux.useSelector((e=>{var t;const l=null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.selection;return!(!l||l.layoutId!==u||l.layoutItemId!==d)})),g=kt(!1),x=kt(null),[b,I]=At(null),[T,j]=At(h("printPlaceholder")),[O,C]=At(null),[R,N]=At(0),[M,L]=At(null),[E,P]=At(!1),[A,k]=At(!1),U=e.css`
    .jimu-widget-placeholder {
      border: none;
    }
    &.surface-1 {
      border: none !important;
    }
    .checkbox-con:hover {
      color: var(--ref-palette-neutral-1100);
    }
  `;Ut((()=>{V()}),[f]),Ut((()=>{D()}),[r]),Ut((()=>{G(b,O,r)}),[O,r,b]);const D=()=>{var e,t;let l=(e=null==r?void 0:r.printServiceType,t=null==r?void 0:r.printTemplateType,e===v.Customize||t===m.Customize)?null==r?void 0:r.printCustomTemplate:null==r?void 0:r.printOrgTemplate;if((null==r?void 0:r.supportCustomReport)||(null==r?void 0:r.supportReport)){const{defaultCustomReportItem:e,defaultReportTemplate:t,supportCustomReport:o,supportReport:i}=r;l=null==l?void 0:l.filter((l=>H({defaultCustomReportItem:e,defaultReportTemplate:t,supportCustomReport:o,supportReport:i,reportOptions:null==l?void 0:l.reportOptions,reportTypes:null==l?void 0:l.reportTypes})))}C(l)},V=()=>{u&&n&&d&&!g.current&&f&&(a(e.appActions.widgetStatePropChange(n,"layoutInfo",{layoutId:u,layoutItemId:d})),g.current=!0)},z=e=>null==e||"2d"!==e.view.type?(j(h("chooseMapTip")),void I(null)):(s&&0!==(null==s?void 0:s.length)||j(h("printPlaceholder")),void I(e)),F=e=>{},$=()=>{let e=T;return b&&!(null==r?void 0:r.useUtility)&&(e=""),e},W=(e=!1)=>{k(e),e&&(clearTimeout(x.current),x.current=setTimeout((()=>{k(!1)}),5e3))},G=e.hooks.useEventCallback(((e,t,l)=>{const{defaultCustomReportItem:o,defaultReportTemplate:i,supportCustomReport:n,supportReport:r}=l;let a=!1;if(!e||!(null==l?void 0:l.useUtility))return a=!0,void P(a);if(r||n){let e=!0;null==t||t.forEach((t=>{H({defaultCustomReportItem:o,defaultReportTemplate:i,supportCustomReport:n,supportReport:r,reportOptions:null==t?void 0:t.reportOptions,reportTypes:null==t?void 0:t.reportTypes})&&(e=!1)})),e&&(T&&j(h("reportTemplateRemind")),a=!0)}t&&0!==(null==t?void 0:t.length)||(a=!0,j(null)),P(a)}));return(0,e.jsx)("div",{className:(0,e.classNames)("w-100 h-100",{"surface-1":(null==r?void 0:r.modeType)===p.Classic}),css:U},(0,e.jsx)("div",{className:"map"},(0,e.jsx)("div",null,(0,e.jsx)(l.JimuMapViewComponent,{useMapWidgetId:null==s?void 0:s[0],onActiveViewChange:z,onViewGroupCreate:F}))),(null==r?void 0:r.modeType)===p.Classic&&(0,e.jsx)("div",{className:"w-100 h-100"},!E&&(0,e.jsx)(mt,{outputDataSourceWarning:M,handleSelectedTemplateIndexChange:e=>{N(e)},useMapWidgetIds:s,id:n,locale:c,config:r,jimuMapView:b,templateList:O,showUtilityErrorRemind:A,toggleUtilityErrorRemind:W}),E&&(0,e.jsx)(t.WidgetPlaceholder,{icon:w(),widgetId:n,message:$()})),(null==r?void 0:r.modeType)===p.Compact&&(0,e.jsx)("div",{className:"w-100 h-100"},(0,e.jsx)(Ot,{showPlaceholder:E,outputDataSourceWarning:M,useMapWidgetIds:s,id:n,config:r,locale:c,jimuMapView:b,templateList:O,controllerWidgetId:y,errorTip:$(),showUtilityErrorRemind:A,toggleUtilityErrorRemind:W})),((null==r?void 0:r.supportReport)||(null==r?void 0:r.supportCustomReport))&&(0,e.jsx)(Pt,{id:n,reportOptions:null===(i=null==O?void 0:O[R])||void 0===i?void 0:i.reportOptions,handleWarningLabelChange:e=>{L(e)}}))};Dt.versionManager=Nt;const Vt=Dt;function zt(e){r.p=e}})(),a})())}}}));